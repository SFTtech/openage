<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="game__control_8cpp" kind="file" language="C++">
    <compoundname>game_control.cpp</compoundname>
    <includes refid="game__control_8h" local="yes">game_control.h</includes>
    <includes refid="engine_8h" local="yes">engine.h</includes>
    <includes refid="error_2error_8h" local="yes">error/error.h</includes>
    <includes refid="game__spec_8h" local="yes">gamestate/game_spec.h</includes>
    <includes refid="log_8h" local="yes">log/log.h</includes>
    <includes refid="terrain__chunk_8h" local="yes">terrain/terrain_chunk.h</includes>
    <includes refid="strings_8h" local="yes">util/strings.h</includes>
    <incdepgraph>
      <node id="8353">
        <label>list</label>
      </node>
      <node id="8346">
        <label>atomic</label>
      </node>
      <node id="8438">
        <label>coord/coordmanager.h</label>
        <link refid="coordmanager_8h"/>
        <childnode refid="8398" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
        <childnode refid="8399" relation="include">
        </childnode>
      </node>
      <node id="8321">
        <label>../util/fixed_point.h</label>
        <link refid="fixed__point_8h"/>
        <childnode refid="8322" relation="include">
        </childnode>
        <childnode refid="8323" relation="include">
        </childnode>
        <childnode refid="8324" relation="include">
        </childnode>
        <childnode refid="8325" relation="include">
        </childnode>
        <childnode refid="8326" relation="include">
        </childnode>
        <childnode refid="8327" relation="include">
        </childnode>
        <childnode refid="8328" relation="include">
        </childnode>
        <childnode refid="8329" relation="include">
        </childnode>
      </node>
      <node id="8350">
        <label>functional</label>
      </node>
      <node id="8325">
        <label>iomanip</label>
      </node>
      <node id="8446">
        <label>queue</label>
      </node>
      <node id="8326">
        <label>limits</label>
      </node>
      <node id="8319">
        <label>declarations.h</label>
        <link refid="declarations_8h"/>
        <childnode refid="8320" relation="include">
        </childnode>
        <childnode refid="8321" relation="include">
        </childnode>
      </node>
      <node id="8443">
        <label>guisys/public/gui_singleton_items_info.h</label>
        <link refid="gui__singleton__items__info_8h"/>
      </node>
      <node id="8371">
        <label>game_spec.h</label>
        <link refid="game__spec_8h"/>
        <childnode refid="8372" relation="include">
        </childnode>
        <childnode refid="8380" relation="include">
        </childnode>
        <childnode refid="8381" relation="include">
        </childnode>
        <childnode refid="8382" relation="include">
        </childnode>
        <childnode refid="8406" relation="include">
        </childnode>
        <childnode refid="8407" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8316" relation="include">
        </childnode>
      </node>
      <node id="8433">
        <label>hash_functions.h</label>
        <link refid="hash__functions_8h"/>
        <childnode refid="8315" relation="include">
        </childnode>
        <childnode refid="8432" relation="include">
        </childnode>
      </node>
      <node id="8400">
        <label>../texture.h</label>
        <link refid="texture_8h"/>
        <childnode refid="8401" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8402" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
        <childnode refid="8399" relation="include">
        </childnode>
        <childnode refid="8403" relation="include">
        </childnode>
        <childnode refid="8404" relation="include">
        </childnode>
        <childnode refid="8385" relation="include">
        </childnode>
      </node>
      <node id="8391">
        <label>setup.h</label>
        <link refid="setup_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8338" relation="include">
        </childnode>
      </node>
      <node id="8316">
        <label>QObject</label>
      </node>
      <node id="8452">
        <label>input/input_manager.h</label>
        <link refid="input__manager_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8364" relation="include">
        </childnode>
        <childnode refid="8415" relation="include">
        </childnode>
        <childnode refid="8361" relation="include">
        </childnode>
        <childnode refid="8362" relation="include">
        </childnode>
        <childnode refid="8358" relation="include">
        </childnode>
      </node>
      <node id="8370">
        <label>civilisation.h</label>
        <link refid="civilisation_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8371" relation="include">
        </childnode>
      </node>
      <node id="8320">
        <label>cstdint</label>
      </node>
      <node id="8396">
        <label>coord_nese.gen.h</label>
      </node>
      <node id="8440">
        <label>stdlib.h</label>
      </node>
      <node id="8459">
        <label>screenshot.h</label>
        <link refid="screenshot_8h"/>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8460" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
      </node>
      <node id="8348">
        <label>strings.h</label>
        <link refid="strings_8h"/>
        <childnode refid="8349" relation="include">
        </childnode>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8325" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8351" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
      </node>
      <node id="8377">
        <label>job_aborted_exception.h</label>
        <link refid="job__aborted__exception_8h"/>
        <childnode refid="8337" relation="include">
        </childnode>
      </node>
      <node id="8448">
        <label>abortable_job_state.h</label>
        <link refid="abortable__job__state_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8377" relation="include">
        </childnode>
        <childnode refid="8374" relation="include">
        </childnode>
        <childnode refid="8379" relation="include">
        </childnode>
      </node>
      <node id="8390">
        <label>exctranslate.h</label>
        <link refid="exctranslate_8h"/>
        <childnode refid="8335" relation="include">
        </childnode>
      </node>
      <node id="8432">
        <label>category.h</label>
        <link refid="category_8h"/>
        <childnode refid="8336" relation="include">
        </childnode>
      </node>
      <node id="8324">
        <label>cmath</label>
      </node>
      <node id="8380">
        <label>../gamedata/gamedata.gen.h</label>
      </node>
      <node id="8337">
        <label>stdexcept</label>
      </node>
      <node id="8389">
        <label>../util/language.h</label>
        <link refid="language_8h"/>
      </node>
      <node id="8416">
        <label>../util/timing.h</label>
        <link refid="timing_8h"/>
        <childnode refid="8320" relation="include">
        </childnode>
      </node>
      <node id="8423">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
        <childnode refid="8424" relation="include">
        </childnode>
        <childnode refid="8425" relation="include">
        </childnode>
      </node>
      <node id="8384">
        <label>../assetmanager.h</label>
        <link refid="assetmanager_8h"/>
        <childnode refid="8342" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8385" relation="include">
        </childnode>
      </node>
      <node id="8418">
        <label>ability.h</label>
        <link refid="ability_8h"/>
        <childnode refid="8419" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8328" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8398" relation="include">
        </childnode>
        <childnode refid="8368" relation="include">
        </childnode>
      </node>
      <node id="8352">
        <label>logsink.h</label>
        <link refid="logsink_8h"/>
        <childnode refid="8353" relation="include">
        </childnode>
        <childnode refid="8354" relation="include">
        </childnode>
        <childnode refid="8355" relation="include">
        </childnode>
      </node>
      <node id="8349">
        <label>cstdarg</label>
      </node>
      <node id="8332">
        <label>string</label>
      </node>
      <node id="8341">
        <label>../log/message.h</label>
        <link refid="message_8h"/>
        <childnode refid="8320" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8342" relation="include">
        </childnode>
        <childnode refid="8343" relation="include">
        </childnode>
        <childnode refid="8345" relation="include">
        </childnode>
        <childnode refid="8352" relation="include">
        </childnode>
        <childnode refid="8355" relation="include">
        </childnode>
      </node>
      <node id="8365">
        <label>rng/rng.h</label>
        <link refid="rng_8h"/>
        <childnode refid="8336" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
      </node>
      <node id="8343">
        <label>../util/constexpr.h</label>
        <link refid="constexpr_8h"/>
        <childnode refid="8344" relation="include">
        </childnode>
      </node>
      <node id="8345">
        <label>../util/stringformatter.h</label>
        <link refid="stringformatter_8h"/>
        <childnode refid="8346" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8328" relation="include">
        </childnode>
        <childnode refid="8338" relation="include">
        </childnode>
        <childnode refid="8347" relation="include">
        </childnode>
        <childnode refid="8348" relation="include">
        </childnode>
      </node>
      <node id="8424">
        <label>map</label>
      </node>
      <node id="8413">
        <label>util/variable.h</label>
        <link refid="variable_8h"/>
      </node>
      <node id="8426">
        <label>../gamedata/unit.gen.h</label>
      </node>
      <node id="8363">
        <label>unordered_set</label>
      </node>
      <node id="8439">
        <label>cvar/cvar.h</label>
        <link refid="cvar_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8440" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8441" relation="include">
        </childnode>
        <childnode refid="8388" relation="include">
        </childnode>
        <childnode refid="8385" relation="include">
        </childnode>
      </node>
      <node id="8415">
        <label>../handlers.h</label>
        <link refid="handlers_8h"/>
        <childnode refid="8364" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
      </node>
      <node id="8373">
        <label>exception</label>
      </node>
      <node id="8376">
        <label>stddef.h</label>
      </node>
      <node id="8408">
        <label>fstream</label>
      </node>
      <node id="8327">
        <label>ostream</label>
      </node>
      <node id="8442">
        <label>gui/engine_info.h</label>
        <link refid="engine__info_8h"/>
        <childnode refid="8385" relation="include">
        </childnode>
        <childnode refid="8443" relation="include">
        </childnode>
      </node>
      <node id="8427">
        <label>../terrain/terrain_object.h</label>
        <link refid="terrain__object_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8376" relation="include">
        </childnode>
        <childnode refid="8399" relation="include">
        </childnode>
        <childnode refid="8398" relation="include">
        </childnode>
      </node>
      <node id="8444">
        <label>job/job_manager.h</label>
        <link refid="job__manager_8h"/>
        <childnode refid="8346" relation="include">
        </childnode>
        <childnode refid="8445" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8354" relation="include">
        </childnode>
        <childnode refid="8446" relation="include">
        </childnode>
        <childnode refid="8447" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8448" relation="include">
        </childnode>
        <childnode refid="8372" relation="include">
        </childnode>
        <childnode refid="8449" relation="include">
        </childnode>
        <childnode refid="8450" relation="include">
        </childnode>
        <childnode refid="8378" relation="include">
        </childnode>
        <childnode refid="8379" relation="include">
        </childnode>
      </node>
      <node id="8369">
        <label>player.h</label>
        <link refid="player_8h"/>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8370" relation="include">
        </childnode>
        <childnode refid="8409" relation="include">
        </childnode>
        <childnode refid="8368" relation="include">
        </childnode>
        <childnode refid="8410" relation="include">
        </childnode>
      </node>
      <node id="8386">
        <label>../pyinterface/pyobject.h</label>
        <link refid="pyobject_8h"/>
        <childnode refid="8320" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8387" relation="include">
        </childnode>
        <childnode refid="8388" relation="include">
        </childnode>
      </node>
      <node id="8330">
        <label>limits.h</label>
      </node>
      <node id="8435">
        <label>resource_def.h</label>
        <link refid="resource__def_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8385" relation="include">
        </childnode>
        <childnode refid="8432" relation="include">
        </childnode>
        <childnode refid="8436" relation="include">
        </childnode>
        <childnode refid="8437" relation="include">
        </childnode>
      </node>
      <node id="8314">
        <label>game_control.h</label>
        <link refid="game__control_8h"/>
        <childnode refid="8315" relation="include">
        </childnode>
        <childnode refid="8316" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
        <childnode refid="8358" relation="include">
        </childnode>
        <childnode refid="8365" relation="include">
        </childnode>
        <childnode refid="8366" relation="include">
        </childnode>
        <childnode refid="8417" relation="include">
        </childnode>
        <childnode refid="8420" relation="include">
        </childnode>
        <childnode refid="8421" relation="include">
        </childnode>
        <childnode refid="8415" relation="include">
        </childnode>
      </node>
      <node id="8335">
        <label>../error/error.h</label>
        <link refid="error_2error_8h"/>
        <childnode refid="8336" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8337" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8338" relation="include">
        </childnode>
        <childnode refid="8341" relation="include">
        </childnode>
      </node>
      <node id="8329">
        <label>misc.h</label>
        <link refid="misc_8h"/>
        <childnode refid="8322" relation="include">
        </childnode>
        <childnode refid="8330" relation="include">
        </childnode>
        <childnode refid="8324" relation="include">
        </childnode>
        <childnode refid="8331" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8335" relation="include">
        </childnode>
        <childnode refid="8338" relation="include">
        </childnode>
      </node>
      <node id="8407">
        <label>../util/csv.h</label>
        <link refid="csv_8h"/>
        <childnode refid="8344" relation="include">
        </childnode>
        <childnode refid="8331" relation="include">
        </childnode>
        <childnode refid="8408" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8335" relation="include">
        </childnode>
        <childnode refid="8338" relation="include">
        </childnode>
        <childnode refid="8394" relation="include">
        </childnode>
        <childnode refid="8385" relation="include">
        </childnode>
      </node>
      <node id="8358">
        <label>input/input_context.h</label>
        <link refid="input__context_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8359" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8361" relation="include">
        </childnode>
        <childnode refid="8362" relation="include">
        </childnode>
      </node>
      <node id="8397">
        <label>coord_neseup.gen.h</label>
      </node>
      <node id="8451">
        <label>worker.h</label>
        <link refid="worker_8h"/>
        <childnode refid="8346" relation="include">
        </childnode>
        <childnode refid="8445" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8446" relation="include">
        </childnode>
        <childnode refid="8447" relation="include">
        </childnode>
        <childnode refid="8378" relation="include">
        </childnode>
      </node>
      <node id="8364">
        <label>SDL2/SDL.h</label>
      </node>
      <node id="8453">
        <label>util/externalprofiler.h</label>
        <link refid="externalprofiler_8h"/>
      </node>
      <node id="8445">
        <label>condition_variable</label>
      </node>
      <node id="8417">
        <label>unit/command.h</label>
        <link refid="command_8h"/>
        <childnode refid="8363" relation="include">
        </childnode>
        <childnode refid="8398" relation="include">
        </childnode>
        <childnode refid="8418" relation="include">
        </childnode>
      </node>
      <node id="8357">
        <label>typeinfo</label>
      </node>
      <node id="8406">
        <label>../unit/unit_texture.h</label>
        <link refid="unit__texture_8h"/>
        <childnode refid="8320" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8398" relation="include">
        </childnode>
        <childnode refid="8381" relation="include">
        </childnode>
      </node>
      <node id="8431">
        <label>audio/audio_manager.h</label>
        <link refid="audio__manager_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8364" relation="include">
        </childnode>
        <childnode refid="8432" relation="include">
        </childnode>
        <childnode refid="8433" relation="include">
        </childnode>
        <childnode refid="8434" relation="include">
        </childnode>
        <childnode refid="8435" relation="include">
        </childnode>
      </node>
      <node id="8434">
        <label>sound.h</label>
        <link refid="sound_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8432" relation="include">
        </childnode>
      </node>
      <node id="8419">
        <label>bitset</label>
      </node>
      <node id="8449">
        <label>job_group.h</label>
        <link refid="job__group_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8335" relation="include">
        </childnode>
        <childnode refid="8448" relation="include">
        </childnode>
        <childnode refid="8372" relation="include">
        </childnode>
        <childnode refid="8450" relation="include">
        </childnode>
        <childnode refid="8379" relation="include">
        </childnode>
        <childnode refid="8451" relation="include">
        </childnode>
      </node>
      <node id="8410">
        <label>score.h</label>
        <link refid="score_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8368" relation="include">
        </childnode>
      </node>
      <node id="8318">
        <label>coord_xy.gen.h</label>
      </node>
      <node id="8315">
        <label>tuple</label>
      </node>
      <node id="8460">
        <label>ctime</label>
      </node>
      <node id="8428">
        <label>engine.h</label>
        <link refid="engine_8h"/>
        <childnode refid="8320" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8364" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8316" relation="include">
        </childnode>
        <childnode refid="8429" relation="include">
        </childnode>
        <childnode refid="8430" relation="include">
        </childnode>
        <childnode refid="8431" relation="include">
        </childnode>
        <childnode refid="8438" relation="include">
        </childnode>
        <childnode refid="8398" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
        <childnode refid="8439" relation="include">
        </childnode>
        <childnode refid="8442" relation="include">
        </childnode>
        <childnode refid="8415" relation="include">
        </childnode>
        <childnode refid="8444" relation="include">
        </childnode>
        <childnode refid="8452" relation="include">
        </childnode>
        <childnode refid="8361" relation="include">
        </childnode>
        <childnode refid="8412" relation="include">
        </childnode>
        <childnode refid="8453" relation="include">
        </childnode>
        <childnode refid="8454" relation="include">
        </childnode>
        <childnode refid="8385" relation="include">
        </childnode>
        <childnode refid="8456" relation="include">
        </childnode>
        <childnode refid="8420" relation="include">
        </childnode>
        <childnode refid="8348" relation="include">
        </childnode>
        <childnode refid="8459" relation="include">
        </childnode>
      </node>
      <node id="8461">
        <label>terrain/terrain_chunk.h</label>
        <link refid="terrain__chunk_8h"/>
        <childnode refid="8376" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
        <childnode refid="8399" relation="include">
        </childnode>
        <childnode refid="8400" relation="include">
        </childnode>
        <childnode refid="8392" relation="include">
        </childnode>
      </node>
      <node id="8436">
        <label>format.h</label>
        <link refid="format_8h"/>
        <childnode refid="8327" relation="include">
        </childnode>
      </node>
      <node id="8366">
        <label>gamestate/game_main.h</label>
        <link refid="game__main_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8364" relation="include">
        </childnode>
        <childnode refid="8316" relation="include">
        </childnode>
        <childnode refid="8367" relation="include">
        </childnode>
        <childnode refid="8369" relation="include">
        </childnode>
        <childnode refid="8411" relation="include">
        </childnode>
        <childnode refid="8412" relation="include">
        </childnode>
        <childnode refid="8382" relation="include">
        </childnode>
        <childnode refid="8414" relation="include">
        </childnode>
        <childnode refid="8416" relation="include">
        </childnode>
      </node>
      <node id="8414">
        <label>../unit/unit_container.h</label>
        <link refid="unit__container_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8399" relation="include">
        </childnode>
        <childnode refid="8415" relation="include">
        </childnode>
        <childnode refid="8416" relation="include">
        </childnode>
      </node>
      <node id="8379">
        <label>types.h</label>
        <link refid="job_2types_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
      </node>
      <node id="8359">
        <label>stack</label>
      </node>
      <node id="8333">
        <label>vector</label>
      </node>
      <node id="8429">
        <label>log/log.h</label>
        <link refid="log_8h"/>
        <childnode refid="8355" relation="include">
        </childnode>
        <childnode refid="8341" relation="include">
        </childnode>
      </node>
      <node id="8339">
        <label>ciso646</label>
      </node>
      <node id="8361">
        <label>action.h</label>
        <link refid="input_2action_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
        <childnode refid="8362" relation="include">
        </childnode>
      </node>
      <node id="8374">
        <label>typed_job_state_base.h</label>
        <link refid="typed__job__state__base_8h"/>
        <childnode refid="8346" relation="include">
        </childnode>
        <childnode refid="8373" relation="include">
        </childnode>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8375" relation="include">
        </childnode>
        <childnode refid="8335" relation="include">
        </childnode>
        <childnode refid="8377" relation="include">
        </childnode>
        <childnode refid="8378" relation="include">
        </childnode>
        <childnode refid="8379" relation="include">
        </childnode>
      </node>
      <node id="8441">
        <label>utility</label>
      </node>
      <node id="8457">
        <label>array</label>
      </node>
      <node id="8403">
        <label>shader/program.h</label>
        <link refid="program_8h"/>
        <childnode refid="8401" relation="include">
        </childnode>
      </node>
      <node id="8351">
        <label>sstream</label>
      </node>
      <node id="8338">
        <label>../util/compiler.h</label>
        <link refid="compiler_8h"/>
        <childnode refid="8339" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8340" relation="include">
        </childnode>
      </node>
      <node id="8392">
        <label>file.h</label>
        <link refid="file_8h"/>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8393" relation="include">
        </childnode>
        <childnode refid="8386" relation="include">
        </childnode>
      </node>
      <node id="8340">
        <label>signal.h</label>
        <link refid="signal_8h"/>
        <childnode refid="8340" relation="include">
        </childnode>
      </node>
      <node id="8401">
        <label>epoxy/gl.h</label>
      </node>
      <node id="8368">
        <label>resource.h</label>
        <link refid="gamestate_2resource_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
      </node>
      <node id="8347">
        <label>externalsstream.h</label>
        <link refid="externalsstream_8h"/>
        <childnode refid="8336" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
      </node>
      <node id="8355">
        <label>level.h</label>
        <link refid="level_8h"/>
        <childnode refid="8356" relation="include">
        </childnode>
      </node>
      <node id="8317">
        <label>coord/pixel.h</label>
        <link refid="pixel_8h"/>
        <childnode refid="8318" relation="include">
        </childnode>
        <childnode refid="8319" relation="include">
        </childnode>
      </node>
      <node id="8367">
        <label>market.h</label>
        <link refid="market_8h"/>
        <childnode refid="8368" relation="include">
        </childnode>
      </node>
      <node id="8394">
        <label>fslike/native.h</label>
        <link refid="fslike_2native_8h"/>
      </node>
      <node id="8402">
        <label>gamedata/texture.gen.h</label>
      </node>
      <node id="8393">
        <label>filelike/filelike.h</label>
        <link refid="filelike_8h"/>
        <childnode refid="8336" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8338" relation="include">
        </childnode>
      </node>
      <node id="8344">
        <label>cstdlib</label>
      </node>
      <node id="8336">
        <label>iostream</label>
      </node>
      <node id="8412">
        <label>../options.h</label>
        <link refid="options_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8413" relation="include">
        </childnode>
      </node>
      <node id="8420">
        <label>unit/selection.h</label>
        <link refid="selection_8h"/>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
        <childnode refid="8415" relation="include">
        </childnode>
        <childnode refid="8418" relation="include">
        </childnode>
        <childnode refid="8414" relation="include">
        </childnode>
      </node>
      <node id="8372">
        <label>../job/job.h</label>
        <link refid="job_8h"/>
        <childnode refid="8373" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8374" relation="include">
        </childnode>
      </node>
      <node id="8404">
        <label>shader/shader.h</label>
        <link refid="shader_2shader_8h"/>
        <childnode refid="8405" relation="include">
        </childnode>
        <childnode refid="8401" relation="include">
        </childnode>
      </node>
      <node id="8360">
        <label>unordered_map</label>
      </node>
      <node id="8450">
        <label>job_state.h</label>
        <link refid="job__state_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8374" relation="include">
        </childnode>
        <childnode refid="8379" relation="include">
        </childnode>
      </node>
      <node id="8388">
        <label>functional.h</label>
        <link refid="functional_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8354" relation="include">
        </childnode>
        <childnode refid="8338" relation="include">
        </childnode>
        <childnode refid="8389" relation="include">
        </childnode>
        <childnode refid="8390" relation="include">
        </childnode>
        <childnode refid="8391" relation="include">
        </childnode>
      </node>
      <node id="8323">
        <label>climits</label>
      </node>
      <node id="8425">
        <label>attribute.h</label>
        <link refid="attribute_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8424" relation="include">
        </childnode>
        <childnode refid="8322" relation="include">
        </childnode>
        <childnode refid="8399" relation="include">
        </childnode>
        <childnode refid="8426" relation="include">
        </childnode>
        <childnode refid="8427" relation="include">
        </childnode>
        <childnode refid="8368" relation="include">
        </childnode>
        <childnode refid="8414" relation="include">
        </childnode>
      </node>
      <node id="8354">
        <label>mutex</label>
      </node>
      <node id="8458">
        <label>chrono</label>
      </node>
      <node id="8395">
        <label>../coord/chunk.h</label>
        <link refid="chunk_8h"/>
        <childnode refid="8319" relation="include">
        </childnode>
        <childnode refid="8396" relation="include">
        </childnode>
        <childnode refid="8397" relation="include">
        </childnode>
      </node>
      <node id="8375">
        <label>../util/thread_id.h</label>
        <link refid="thread__id_8h"/>
        <childnode refid="8376" relation="include">
        </childnode>
      </node>
      <node id="8447">
        <label>thread</label>
      </node>
      <node id="8385">
        <label>util/path.h</label>
        <link refid="util_2path_8h"/>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8386" relation="include">
        </childnode>
        <childnode refid="8392" relation="include">
        </childnode>
        <childnode refid="8394" relation="include">
        </childnode>
      </node>
      <node id="8421">
        <label>unit/unit_type.h</label>
        <link refid="unit__type_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8398" relation="include">
        </childnode>
        <childnode refid="8422" relation="include">
        </childnode>
        <childnode refid="8423" relation="include">
        </childnode>
      </node>
      <node id="8362">
        <label>event.h</label>
        <link refid="input_2event_8h"/>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8363" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8364" relation="include">
        </childnode>
      </node>
      <node id="8399">
        <label>../coord/tile.h</label>
        <link refid="tile_8h"/>
        <childnode refid="8319" relation="include">
        </childnode>
        <childnode refid="8396" relation="include">
        </childnode>
        <childnode refid="8397" relation="include">
        </childnode>
        <childnode refid="8329" relation="include">
        </childnode>
      </node>
      <node id="8387">
        <label>defs.h</label>
        <link refid="defs_8h"/>
      </node>
      <node id="8409">
        <label>population_tracker.h</label>
        <link refid="population__tracker_8h"/>
      </node>
      <node id="8456">
        <label>util/profiler.h</label>
        <link refid="profiler_8h"/>
        <childnode refid="8457" relation="include">
        </childnode>
        <childnode refid="8458" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8332" relation="include">
        </childnode>
      </node>
      <node id="8328">
        <label>type_traits</label>
      </node>
      <node id="8383">
        <label>set</label>
      </node>
      <node id="8342">
        <label>config.h</label>
      </node>
      <node id="8411">
        <label>team.h</label>
        <link refid="team_8h"/>
        <childnode refid="8332" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8410" relation="include">
        </childnode>
      </node>
      <node id="8437">
        <label>loader_policy.h</label>
        <link refid="loader__policy_8h"/>
        <childnode refid="8327" relation="include">
        </childnode>
      </node>
      <node id="8322">
        <label>algorithm</label>
      </node>
      <node id="8378">
        <label>job_state_base.h</label>
        <link refid="job__state__base_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8379" relation="include">
        </childnode>
      </node>
      <node id="8398">
        <label>../coord/phys.h</label>
        <link refid="phys_8h"/>
        <childnode refid="8329" relation="include">
        </childnode>
        <childnode refid="8319" relation="include">
        </childnode>
        <childnode refid="8396" relation="include">
        </childnode>
        <childnode refid="8397" relation="include">
        </childnode>
      </node>
      <node id="8313">
        <label>libopenage/game_control.cpp</label>
        <link refid="game__control_8cpp"/>
        <childnode refid="8314" relation="include">
        </childnode>
        <childnode refid="8428" relation="include">
        </childnode>
        <childnode refid="8335" relation="include">
        </childnode>
        <childnode refid="8371" relation="include">
        </childnode>
        <childnode refid="8429" relation="include">
        </childnode>
        <childnode refid="8461" relation="include">
        </childnode>
        <childnode refid="8348" relation="include">
        </childnode>
      </node>
      <node id="8422">
        <label>../gamestate/cost.h</label>
        <link refid="cost_8h"/>
        <childnode refid="8368" relation="include">
        </childnode>
      </node>
      <node id="8331">
        <label>cstring</label>
      </node>
      <node id="8381">
        <label>../gamedata/graphic.gen.h</label>
      </node>
      <node id="8430">
        <label>log/file_logsink.h</label>
        <link refid="file__logsink_8h"/>
        <childnode refid="8336" relation="include">
        </childnode>
        <childnode refid="8408" relation="include">
        </childnode>
        <childnode refid="8352" relation="include">
        </childnode>
      </node>
      <node id="8382">
        <label>../terrain/terrain.h</label>
        <link refid="terrain_8h"/>
        <childnode refid="8350" relation="include">
        </childnode>
        <childnode refid="8334" relation="include">
        </childnode>
        <childnode refid="8376" relation="include">
        </childnode>
        <childnode refid="8383" relation="include">
        </childnode>
        <childnode refid="8360" relation="include">
        </childnode>
        <childnode refid="8333" relation="include">
        </childnode>
        <childnode refid="8384" relation="include">
        </childnode>
        <childnode refid="8395" relation="include">
        </childnode>
        <childnode refid="8398" relation="include">
        </childnode>
        <childnode refid="8317" relation="include">
        </childnode>
        <childnode refid="8399" relation="include">
        </childnode>
        <childnode refid="8400" relation="include">
        </childnode>
        <childnode refid="8329" relation="include">
        </childnode>
      </node>
      <node id="8455">
        <label>timer.h</label>
        <link refid="timer_8h"/>
        <childnode refid="8320" relation="include">
        </childnode>
        <childnode refid="8416" relation="include">
        </childnode>
      </node>
      <node id="8334">
        <label>memory</label>
      </node>
      <node id="8405">
        <label>initializer_list</label>
      </node>
      <node id="8454">
        <label>util/fps.h</label>
        <link refid="fps_8h"/>
        <childnode refid="8455" relation="include">
        </childnode>
      </node>
      <node id="8356">
        <label>../util/enum.h</label>
        <link refid="enum_8h"/>
        <childnode refid="8336" relation="include">
        </childnode>
        <childnode refid="8357" relation="include">
        </childnode>
        <childnode refid="8338" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <innernamespace refid="namespaceopenage">openage</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>2015-2018<sp/>the<sp/>openage<sp/>authors.<sp/>See<sp/>copying.md<sp/>for<sp/>legal<sp/>info.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="game__control_8h" kindref="compound">game_control.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="engine_8h" kindref="compound">engine.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="error_2error_8h" kindref="compound">error/error.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="game__spec_8h" kindref="compound">gamestate/game_spec.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="log_8h" kindref="compound">log/log.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="terrain__chunk_8h" kindref="compound">terrain/terrain_chunk.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="strings_8h" kindref="compound">util/strings.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="namespaceopenage" kindref="compound">openage</ref><sp/>{</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15" refid="classopenage_1_1_output_mode_1a03cfe09a12a5d825c2f346fd11d7572c" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_output_mode_1a03cfe09a12a5d825c2f346fd11d7572c" kindref="member">OutputMode::OutputMode</ref>(<ref refid="classqtsdl_1_1_gui_item_link" kindref="compound">qtsdl::GuiItemLink</ref><sp/>*gui_link)</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/>game_control{</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/>gui_link{gui_link}<sp/>{</highlight></codeline>
<codeline lineno="19"><highlight class="normal">}</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21" refid="classopenage_1_1_output_mode_1a6a91c7a40777e5fc02277f5b906dfd15" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_output_mode_1a6a91c7a40777e5fc02277f5b906dfd15" kindref="member">OutputMode::~OutputMode</ref>()<sp/>{</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>An<sp/>empty<sp/>deconstructor<sp/>prevents<sp/>our<sp/>clients<sp/>from<sp/>needing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>implement<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>deconstructor<sp/>is<sp/>needed<sp/>in<sp/>the<sp/>first<sp/>place<sp/>to<sp/>stop</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>compiler<sp/>from<sp/>generating<sp/>ud2<sp/>(undefined)<sp/>instructors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>the<sp/>body<sp/>of<sp/>this<sp/>method.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal">}</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30" refid="classopenage_1_1_output_mode_1aafb84951c6575c14b5517312c5cfe191" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_output_mode_1aafb84951c6575c14b5517312c5cfe191" kindref="member">OutputMode::announce</ref>()<sp/>{</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a56da997473c999c4040ec6559fdf2d82" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_output_mode_signals_1a5789bb37fcce9236340a67c62124efe4" kindref="member">announced</ref>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a088f019691b4233408a7d230b0a5604b" kindref="member">name</ref>());</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a56da997473c999c4040ec6559fdf2d82" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_output_mode_signals_1a6a7461c5308d407e9e2284efa3c7f90d" kindref="member">binds_changed</ref>(this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1ab79e2d06d4aab199d3fb9c5dc5b6ff3f" kindref="member">active_binds</ref>());</highlight></codeline>
<codeline lineno="34"><highlight class="normal">}</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36" refid="classopenage_1_1_output_mode_1a56daba2d7cbace8b99ca51015d2f76df" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_output_mode_1a56daba2d7cbace8b99ca51015d2f76df" kindref="member">OutputMode::set_game_control</ref>(<ref refid="classopenage_1_1_game_control" kindref="compound">GameControl</ref><sp/>*game_control)<sp/>{</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;game_control<sp/>=<sp/><ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1aa9737f66ac8869d475df2d22d073017e" kindref="member">on_game_control_set</ref>();</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1aafb84951c6575c14b5517312c5cfe191" kindref="member">announce</ref>();</highlight></codeline>
<codeline lineno="41"><highlight class="normal">}</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="43" refid="classopenage_1_1_create_mode_1af23600b4e11da9c3f782b7a2d010e2dc" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_create_mode_1af23600b4e11da9c3f782b7a2d010e2dc" kindref="member">CreateMode::CreateMode</ref>(<ref refid="classqtsdl_1_1_gui_item_link" kindref="compound">qtsdl::GuiItemLink</ref><sp/>*gui_link)</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_output_mode" kindref="compound">OutputMode</ref>{<ref refid="classopenage_1_1_output_mode_1a6d3ac16256d5213f0bd6a887d81de3a6" kindref="member">gui_link</ref>}<sp/>{}</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47" refid="classopenage_1_1_create_mode_1a9e6c33f217fb4d7dde01239c80b1c032" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_create_mode_1a9e6c33f217fb4d7dde01239c80b1c032" kindref="member">CreateMode::available</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="49"><highlight class="normal">}</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51" refid="classopenage_1_1_create_mode_1a09b69d7ea9d5f066ae802e5bfd60a69e" refkind="member"><highlight class="normal">std::string<sp/><ref refid="classopenage_1_1_create_mode_1a09b69d7ea9d5f066ae802e5bfd60a69e" kindref="member">CreateMode::name</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Creation<sp/>Mode&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="53"><highlight class="normal">}</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55" refid="classopenage_1_1_create_mode_1a9859d091f320e6626a75dccfb408ada4" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_create_mode_1a9859d091f320e6626a75dccfb408ada4" kindref="member">CreateMode::on_game_control_set</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57" refid="classopenage_1_1_create_mode_1a9ed1d6d73895ffa0fbb7f2d6f7056490" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_create_mode_1a9ed1d6d73895ffa0fbb7f2d6f7056490" kindref="member">CreateMode::on_enter</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59" refid="classopenage_1_1_create_mode_1a85c08dfe4c0e4f5d4d86b648de92fe85" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_create_mode_1a85c08dfe4c0e4f5d4d86b648de92fe85" kindref="member">CreateMode::on_exit</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61" refid="classopenage_1_1_create_mode_1a51b491407ce568c54d360d68904fc900" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_create_mode_1a51b491407ce568c54d360d68904fc900" kindref="member">CreateMode::render</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight></codeline>
<codeline lineno="64" refid="classopenage_1_1_action_mode_signals_1a051763b83f47cc8649c03d14d02d3bf0" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_action_mode_signals_1a051763b83f47cc8649c03d14d02d3bf0" kindref="member">ActionModeSignals::ActionModeSignals</ref>(<ref refid="classopenage_1_1_action_mode" kindref="compound">ActionMode</ref><sp/>*action_mode)</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>action_mode(action_mode)<sp/>{</highlight></codeline>
<codeline lineno="67"><highlight class="normal">}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69" refid="classopenage_1_1_action_mode_signals_1a400a4674187d1ce007a206c5074390da" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_signals_1a400a4674187d1ce007a206c5074390da" kindref="member">ActionModeSignals::on_action</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string<sp/>&amp;action_name)<sp/>{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_signals_1a9a179f321b0c4742e02f031290ce76cd" kindref="member">action_mode</ref>-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespaceopenage_1_1input_1afc78129c41b8dce77d2b9c52d7619d74" kindref="member">input::action_t</ref><sp/>&amp;action<sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1ab6233b0bf461be4bb1633cd9f7e7f08b" kindref="member">get_action_manager</ref>().<ref refid="classopenage_1_1input_1_1_action_manager_1a743f9d44332f84adb3eca195732ed09d" kindref="member">get</ref>(action_name);</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1input_1_1_input_context" kindref="compound">input::InputContext</ref><sp/>*top_ctxt<sp/>=<sp/>&amp;engine-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>().<ref refid="classopenage_1_1input_1_1_input_manager_1a9ccb8754431247dd05c56c445bda15bc" kindref="member">get_top_context</ref>();</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(top_ctxt<sp/>==<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_signals_1a9a179f321b0c4742e02f031290ce76cd" kindref="member">action_mode</ref><sp/>||</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top_ctxt<sp/>==<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_signals_1a9a179f321b0c4742e02f031290ce76cd" kindref="member">action_mode</ref>-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref><sp/>||</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top_ctxt<sp/>==<sp/>&amp;this-&gt;action_mode-&gt;build_menu_context<sp/>||</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top_ctxt<sp/>==<sp/>&amp;this-&gt;action_mode-&gt;build_menu_mil_context)<sp/>{</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>an<sp/>action<sp/>that<sp/>just<sp/>relays<sp/>the<sp/>action.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>action_arg{</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1input_1_1_event" kindref="compound">input::Event</ref>{<ref refid="namespaceopenage_1_1input_1a278a7af94e412aa285e58d870c64a849a8e1bde3c3d303163521522cf1d62f21f" kindref="member">input::event_class::ANY</ref>,<sp/>0,<sp/><ref refid="namespaceopenage_1_1input_1a35fb62561b5dee35b84bc9a228b04ab1" kindref="member">input::modset_t</ref>{}},</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structopenage_1_1coord_1_1input" kindref="compound">coord::input</ref>{0,<sp/>0},</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structopenage_1_1coord_1_1input__delta" kindref="compound">coord::input_delta</ref>{0,<sp/>0},</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{action}</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top_ctxt-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a97804df5309a2fd7773b02568c8ca461" kindref="member">execute_if_bound</ref>(action_arg);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="89"><highlight class="normal">}</highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91" refid="classopenage_1_1_action_mode_1ab7a28a2d45f303bcf0160ff65d0e1c52" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_action_mode_1ab7a28a2d45f303bcf0160ff65d0e1c52" kindref="member">ActionMode::ActionMode</ref>(<ref refid="classqtsdl_1_1_gui_item_link" kindref="compound">qtsdl::GuiItemLink</ref><sp/>*gui_link)</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_output_mode" kindref="compound">OutputMode</ref>{<ref refid="classopenage_1_1_output_mode_1a6d3ac16256d5213f0bd6a887d81de3a6" kindref="member">gui_link</ref>},</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>selection{</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>use_set_ability{</highlight><highlight class="keyword">false</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>type_focus{</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>selecting{</highlight><highlight class="keyword">false</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>rng{<ref refid="namespaceopenage_1_1rng_1a510f1a8aa7487e18b60b1844cd2af86a" kindref="member">rng::random_seed</ref>()},</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/>gui_signals{</highlight><highlight class="keyword">this</highlight><highlight class="normal">}<sp/>{}</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102" refid="classopenage_1_1_action_mode_1a43f98279255b857ee8fa9943117271e8" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1a43f98279255b857ee8fa9943117271e8" kindref="member">ActionMode::on_game_control_set</ref>()<sp/>{</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref><sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;no<sp/>control<sp/>was<sp/>actually<sp/>set&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(engine<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;engine<sp/>must<sp/>be<sp/>known!&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;action<sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1ab6233b0bf461be4bb1633cd9f7e7f08b" kindref="member">get_action_manager</ref>();</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>input<sp/>=<sp/>&amp;engine-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>();</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1coord_1_1_coord_manager" kindref="compound">coord::CoordManager</ref><sp/>&amp;<ref refid="namespaceopenage_1_1coord_1_1tests_1ab5f6aa805a24bd58eb365e5af294d807" kindref="member">coord</ref><sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>the<sp/>selection<sp/>should<sp/>not<sp/>be<sp/>used<sp/>in<sp/>here!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref><sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a993ef0abb641566f661a99d288ae8e11" kindref="member">get_unit_selection</ref>();</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref><sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;selection<sp/>must<sp/>be<sp/>fetched!&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;TRAIN_OBJECT&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>attempt<sp/>to<sp/>train<sp/>editor<sp/>selected<sp/>object</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>randomly<sp/>select<sp/>between<sp/>male<sp/>and<sp/>female<sp/>villagers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>();</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>type<sp/>=<sp/>player-&gt;<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a2343141ddc9aff4c17f8a45b935cad90" kindref="member">rng</ref>.<ref refid="classopenage_1_1rng_1_1_r_n_g_1ab24ce8fabde7df2ec900e3e1883281a4" kindref="member">probability</ref>(0.5)?<sp/>83<sp/>:<sp/>293);</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_command" kindref="compound">Command</ref><sp/>cmd(*player,<sp/>type);</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.<ref refid="classopenage_1_1_command_1a689de4092f9ae801d7f987dda153f0d8" kindref="member">add_flag</ref>(<ref refid="namespaceopenage_1a355391982e6c1257c3fc4de3b6402b3aa2414c252176310b2c04547257948c7b7" kindref="member">command_flag::interrupt</ref>);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a0ad857ab54207bdaa9719fc01410f101" kindref="member">all_invoke</ref>(cmd);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;ENABLE_BUILDING_PLACEMENT&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this-&gt;building_placement<sp/>=<sp/>true;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;DISABLE_SET_ABILITY&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;SET_ABILITY_MOVE&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref><sp/>=<sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a3734a903022249b3010be1897042568e" kindref="member">ability_type::move</ref>;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ae9bd7c070717c2a7b4ff21aeaeb7d7f4" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_action_mode_signals_1a01cb90fdc3c3530ffa273437d9f03048" kindref="member">ability_changed</ref>(<ref refid="namespacestd_1a26aa0f4be3a77ac5cc3ce0cabb545042" kindref="member">std::to_string</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref>));</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;SET_ABILITY_GATHER&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref><sp/>=<sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a76a79a1cdd981d7b73a1b7cf9cc6e0de" kindref="member">ability_type::gather</ref>;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ae9bd7c070717c2a7b4ff21aeaeb7d7f4" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_action_mode_signals_1a01cb90fdc3c3530ffa273437d9f03048" kindref="member">ability_changed</ref>(<ref refid="namespacestd_1a26aa0f4be3a77ac5cc3ce0cabb545042" kindref="member">std::to_string</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref>));</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;SET_ABILITY_GARRISON&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref><sp/>=<sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a2dc979d8571788e647e49a10223acae8" kindref="member">ability_type::garrison</ref>;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ae9bd7c070717c2a7b4ff21aeaeb7d7f4" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_action_mode_signals_1a01cb90fdc3c3530ffa273437d9f03048" kindref="member">ability_changed</ref>(<ref refid="namespacestd_1a26aa0f4be3a77ac5cc3ce0cabb545042" kindref="member">std::to_string</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref>));</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;SET_ABILITY_REPAIR&quot;</highlight><highlight class="normal">),<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref><sp/>=<sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a9ab776b93b3c6bbb67f4545371814423" kindref="member">ability_type::repair</ref>;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ae9bd7c070717c2a7b4ff21aeaeb7d7f4" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_action_mode_signals_1a01cb90fdc3c3530ffa273437d9f03048" kindref="member">ability_changed</ref>(<ref refid="namespacestd_1a26aa0f4be3a77ac5cc3ce0cabb545042" kindref="member">std::to_string</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref>));</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;SPAWN_VILLAGER&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>engine](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>();</highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(player-&gt;type_count()<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_type" kindref="compound">UnitType</ref><sp/>&amp;type<sp/>=<sp/>*player-&gt;get_type(590);</highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>tile<sp/>position</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>()-&gt;<ref refid="classopenage_1_1_game_main_1ac0651e2cfcbf6733dfe637b6b72eaefc" kindref="member">placed_units</ref>.<ref refid="classopenage_1_1_unit_container_1a39947500d16e9d67eb72458f3df7c796" kindref="member">new_unit</ref>(type,<sp/>*player,<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a6807ef371160b0d49b5d1154ec9c6701" kindref="member">mousepos_phys3</ref>);</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;KILL_UNIT&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a2cc48ccbea18ec579f9ad27a89b1d96a" kindref="member">kill_unit</ref>(*this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>());</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;BUILD_MENU&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(dbg)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Opening<sp/>build<sp/>menu&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;push_context(&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;BUILD_MENU_MIL&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(dbg)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Opening<sp/>military<sp/>build<sp/>menu&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;push_context(&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>.bind(action.get(</highlight><highlight class="stringliteral">&quot;CANCEL&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;remove_context(&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>.bind(action.get(</highlight><highlight class="stringliteral">&quot;CANCEL&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;remove_context(&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Villager<sp/>build<sp/>commands</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>bind_building_key<sp/>=<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input](<ref refid="namespaceopenage_1_1input_1afc78129c41b8dce77d2b9c52d7619d74" kindref="member">input::action_t</ref><sp/>action,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">building</ref>,<sp/><ref refid="classopenage_1_1input_1_1_input_context" kindref="compound">input::InputContext</ref><sp/>*ctxt)<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctxt-&gt;bind(action,<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/><ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">building</ref>,<sp/>ctxt,<sp/>input](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>();</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a641ba956ba51e5ec47130cec3ffe9085" kindref="member">contains_builders</ref>(*player))<sp/>{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>();</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref><sp/>=<sp/>player-&gt;get_type(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">building</ref>);</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(player-&gt;can_make(*this-&gt;type_focus))<sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(&amp;input-&gt;get_top_context()<sp/>!=<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref>)<sp/>{</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;remove_context(ctxt);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;push_context(&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref>);</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>show<sp/>in<sp/>game<sp/>error<sp/>message</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_HOUS&quot;</highlight><highlight class="normal">),<sp/><sp/>70,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>House</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_MILL&quot;</highlight><highlight class="normal">),<sp/><sp/>68,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Mill</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_MINE&quot;</highlight><highlight class="normal">),<sp/><sp/>584,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Mining<sp/>Camp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_SMIL&quot;</highlight><highlight class="normal">),<sp/><sp/>562,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Lumber<sp/>Camp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_DOCK&quot;</highlight><highlight class="normal">),<sp/><sp/>47,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Dock</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>Doesn&apos;t<sp/>show<sp/>until<sp/>it<sp/>is<sp/>placed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_FARM&quot;</highlight><highlight class="normal">),<sp/><sp/>50,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Farm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_BLAC&quot;</highlight><highlight class="normal">),<sp/><sp/>103,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Blacksmith</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_MRKT&quot;</highlight><highlight class="normal">),<sp/><sp/>84,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Market</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_CRCH&quot;</highlight><highlight class="normal">),<sp/><sp/>104,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Monastery</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_UNIV&quot;</highlight><highlight class="normal">),<sp/><sp/>209,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>University</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_RTWC&quot;</highlight><highlight class="normal">),<sp/><sp/>109,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Town<sp/>Center</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_WNDR&quot;</highlight><highlight class="normal">),<sp/><sp/>276,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Wonder</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_BRKS&quot;</highlight><highlight class="normal">),<sp/><sp/>12,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Barracks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_ARRG&quot;</highlight><highlight class="normal">),<sp/><sp/>87,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Archery<sp/>Range</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_STBL&quot;</highlight><highlight class="normal">),<sp/><sp/>101,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Stable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_SIWS&quot;</highlight><highlight class="normal">),<sp/><sp/>49,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Siege<sp/>Workshop</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_WCTWX&quot;</highlight><highlight class="normal">),<sp/>598,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Outpost</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>for<sp/>palisade<sp/>and<sp/>stone<sp/>wall:<sp/>Drag<sp/>walls,<sp/>automatically<sp/>adjust<sp/>orientation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>This<sp/>just<sp/>cycles<sp/>through<sp/>all<sp/>palisade<sp/>textures</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_WALL&quot;</highlight><highlight class="normal">),<sp/><sp/>72,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Palisade<sp/>Wall</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>Fortified<sp/>wall<sp/>has<sp/>a<sp/>different<sp/>ID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_WALL2&quot;</highlight><highlight class="normal">),<sp/>117,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Stone<sp/>Wall</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>Upgraded<sp/>versions<sp/>have<sp/>different<sp/>IDs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_WCTW&quot;</highlight><highlight class="normal">),<sp/><sp/>79,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Watch<sp/>Tower</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_WCTW4&quot;</highlight><highlight class="normal">),<sp/>236,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Bombard<sp/>Tower</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>Gate<sp/>placement<sp/>-<sp/>659<sp/>is<sp/>horizontal<sp/>closed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_GTCA2&quot;</highlight><highlight class="normal">),<sp/>659,<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Gate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_building_key(action.get(</highlight><highlight class="stringliteral">&quot;BUILDING_CSTL&quot;</highlight><highlight class="normal">),<sp/><sp/>82,<sp/><sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>);<sp/></highlight><highlight class="comment">//<sp/>Castle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref>.bind(action.get(</highlight><highlight class="stringliteral">&quot;CANCEL&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;remove_context(&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref>);</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref><sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>bind_build<sp/>=<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input,<sp/>&amp;<ref refid="namespaceopenage_1_1coord_1_1tests_1ab5f6aa805a24bd58eb365e5af294d807" kindref="member">coord</ref>](<ref refid="namespaceopenage_1_1input_1afc78129c41b8dce77d2b9c52d7619d74" kindref="member">input::action_t</ref><sp/>action,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>increase)<sp/>{</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref>.bind(action,<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>increase,<sp/>input,<sp/>&amp;<ref refid="namespaceopenage_1_1coord_1_1tests_1ab5f6aa805a24bd58eb365e5af294d807" kindref="member">coord</ref>](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;arg)<sp/>{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a6807ef371160b0d49b5d1154ec9c6701" kindref="member">mousepos_phys3</ref><sp/>=<sp/>arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1acb2429b802ec5c65f21c65a0181d3d14" kindref="member">mouse</ref>.<ref refid="structopenage_1_1coord_1_1input_1a9eba1358725d529a26f871308794ab36" kindref="member">to_phys3</ref>(<ref refid="namespaceopenage_1_1coord_1_1tests_1ab5f6aa805a24bd58eb365e5af294d807" kindref="member">coord</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ac3305c70dea2722696aa1fe5db2cd42b" kindref="member">mousepos_tile</ref><sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a6807ef371160b0d49b5d1154ec9c6701" kindref="member">mousepos_phys3</ref>.<ref refid="structopenage_1_1coord_1_1phys3_1aa8aa4b7a7a76ddb625b8770ba12484d6" kindref="member">to_tile</ref>();</highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465ea6ebb25b39f65cab5efa469977b9479e2" kindref="member">placed</ref><sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3865e557756044d8183a3d24cd5b8ab4" kindref="member">place_selection</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a6807ef371160b0d49b5d1154ec9c6701" kindref="member">mousepos_phys3</ref>);</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(placed<sp/>&amp;&amp;<sp/>!increase)<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref><sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;remove_context(&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref>);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_build(action.get(</highlight><highlight class="stringliteral">&quot;BUILD&quot;</highlight><highlight class="normal">),<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_build(action.get(</highlight><highlight class="stringliteral">&quot;KEEP_BUILDING&quot;</highlight><highlight class="normal">),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>bind_select<sp/>=<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input,<sp/>engine](<ref refid="namespaceopenage_1_1input_1afc78129c41b8dce77d2b9c52d7619d74" kindref="member">input::action_t</ref><sp/>action,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>increase)<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action,<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>increase,<sp/>input,<sp/>engine](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;arg)<sp/>{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>mousepos_camgame<sp/>=<sp/>arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1acb2429b802ec5c65f21c65a0181d3d14" kindref="member">mouse</ref>.<ref refid="structopenage_1_1coord_1_1input_1a36c619fe6d0f99917204848208285fef" kindref="member">to_camgame</ref>(engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain" kindref="compound">Terrain</ref><sp/>*terrain<sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>()-&gt;<ref refid="classopenage_1_1_game_main_1a0a2423176e649f9865eb97fc0f187b63" kindref="member">terrain</ref>.get();</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a35322bea7ad954fe4fefd8e2dfbac60f" kindref="member">drag_update</ref>(mousepos_camgame);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a6b4a0b9275c8ebf623d50a7509487623" kindref="member">drag_release</ref>(*this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>(),<sp/>terrain,<sp/>increase);</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1input_1_1_input_context_1a717f49ae6be59bee9eee3b2544156e10" kindref="member">InputContext</ref><sp/>*top_ctxt<sp/>=<sp/>&amp;input-&gt;get_top_context();</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1ab7bbbd3ae208b61e3fae02eca886e134" kindref="member">get_selection_type</ref>()<sp/>!=<sp/><ref refid="namespaceopenage_1a7174088e5b9a132b1bccacbee82a35cda05e717c9df8ba7e69bb8f3db541fcb7c" kindref="member">selection_type_t::own_units</ref><sp/>or</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a07df9837a02027bf139d1cecfb541b4d" kindref="member">contains_military</ref>(*this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>()))</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>and</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(top_ctxt<sp/>==<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref><sp/>||</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>top_ctxt<sp/>==<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>))<sp/>{</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;remove_context(top_ctxt);</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_select(action.get(</highlight><highlight class="stringliteral">&quot;SELECT&quot;</highlight><highlight class="normal">),<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>bind_select(action.get(</highlight><highlight class="stringliteral">&quot;INCREASE_SELECTION&quot;</highlight><highlight class="normal">),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;ORDER_SELECT&quot;</highlight><highlight class="normal">),<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>input,<sp/>&amp;<ref refid="namespaceopenage_1_1coord_1_1tests_1ab5f6aa805a24bd58eb365e5af294d807" kindref="member">coord</ref>](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;arg)<sp/>{</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref>)<sp/>{</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>right<sp/>click<sp/>can<sp/>cancel<sp/>building<sp/>placement</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref><sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input-&gt;remove_context(&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref>);</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="324"><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>cmd<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a7b0a0d95b032af2e9bf2ede80bca03c8" kindref="member">get_action</ref>(arg.mouse.to_phys3(<ref refid="namespaceopenage_1_1coord_1_1tests_1ab5f6aa805a24bd58eb365e5af294d807" kindref="member">coord</ref>));</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.<ref refid="classopenage_1_1_command_1a689de4092f9ae801d7f987dda153f0d8" kindref="member">add_flag</ref>(<ref refid="namespaceopenage_1a355391982e6c1257c3fc4de3b6402b3aa2414c252176310b2c04547257948c7b7" kindref="member">command_flag::interrupt</ref>);</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a0ad857ab54207bdaa9719fc01410f101" kindref="member">all_invoke</ref>(cmd);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;BEGIN_SELECTION&quot;</highlight><highlight class="normal">),<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a96ee042096ca3b85bf6f5a38cd18bc4d" kindref="member">selecting</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;END_SELECTION&quot;</highlight><highlight class="normal">),<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a96ee042096ca3b85bf6f5a38cd18bc4d" kindref="member">selecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(<ref refid="namespaceopenage_1_1input_1a278a7af94e412aa285e58d870c64a849a2ec2be318cc86a1224c0e9dcc71321e4" kindref="member">input::event_class::MOUSE</ref>,<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>&amp;coord](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;arg)<sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>mousepos_camgame<sp/>=<sp/>arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1acb2429b802ec5c65f21c65a0181d3d14" kindref="member">mouse</ref>.<ref refid="structopenage_1_1coord_1_1input_1a36c619fe6d0f99917204848208285fef" kindref="member">to_camgame</ref>(<ref refid="namespaceopenage_1_1coord_1_1tests_1ab5f6aa805a24bd58eb365e5af294d807" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a6807ef371160b0d49b5d1154ec9c6701" kindref="member">mousepos_phys3</ref><sp/>=<sp/>mousepos_camgame.to_phys3(<ref refid="namespaceopenage_1_1coord_1_1tests_1ab5f6aa805a24bd58eb365e5af294d807" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ac3305c70dea2722696aa1fe5db2cd42b" kindref="member">mousepos_tile</ref><sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a6807ef371160b0d49b5d1154ec9c6701" kindref="member">mousepos_phys3</ref>.<ref refid="structopenage_1_1coord_1_1phys3_1aa8aa4b7a7a76ddb625b8770ba12484d6" kindref="member">to_tile</ref>();</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>drag<sp/>selection<sp/>box</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1a75c7dda55a421ea33b2503f69fe2383a" kindref="member">e</ref>.<ref refid="classopenage_1_1input_1_1_event_1af6758c0f24529defde0e1a4788c86ff7" kindref="member">cc</ref><sp/>==<sp/><ref refid="classopenage_1_1input_1_1_class_code" kindref="compound">input::ClassCode</ref>(<ref refid="namespaceopenage_1_1input_1a278a7af94e412aa285e58d870c64a849a6a52684199a74ef0bd3415fe6a76da4f" kindref="member">input::event_class::MOUSE_MOTION</ref>,<sp/>0)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;selecting<sp/>&amp;&amp;<sp/>!this-&gt;type_focus)<sp/>{</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a35322bea7ad954fe4fefd8e2dfbac60f" kindref="member">drag_update</ref>(mousepos_camgame);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="353"><highlight class="normal">}</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355" refid="classopenage_1_1_action_mode_1afeb7fd105b03e822ff4ebe205cff3265" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1afeb7fd105b03e822ff4ebe205cff3265" kindref="member">ActionMode::available</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref><sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(warn)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;ActionMode::available()<sp/>queried<sp/>without<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;game<sp/>control<sp/>being<sp/>attached.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(engine-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>()<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(warn)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>enter<sp/>action<sp/>mode<sp/>without<sp/>a<sp/>game&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="370"><highlight class="normal">}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372" refid="classopenage_1_1_action_mode_1a46e7067671510d05f6d0d4c15ce2410c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1a46e7067671510d05f6d0d4c15ce2410c" kindref="member">ActionMode::on_enter</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight></codeline>
<codeline lineno="374" refid="classopenage_1_1_action_mode_1a9c7d1f16c862692b1172079402ac0f18" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1a9c7d1f16c862692b1172079402ac0f18" kindref="member">ActionMode::on_exit</ref>()<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>on_exit<sp/>is<sp/>called<sp/>after<sp/>removing<sp/>the<sp/>active<sp/>mode,<sp/>if<sp/>the<sp/>top<sp/>context<sp/>isn&apos;t<sp/>the<sp/>global<sp/>one<sp/>then<sp/>it<sp/>must</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>be<sp/>either<sp/>a<sp/>build<sp/>menu<sp/>or<sp/>the<sp/>building<sp/>context</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>*<ref refid="classopenage_1_1input_1_1_input_context_1af84dd2cdfe2d8655ed796b94e99ad199" kindref="member">input_manager</ref><sp/>=<sp/>&amp;engine-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>();</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1input_1_1_input_context_1a717f49ae6be59bee9eee3b2544156e10" kindref="member">InputContext</ref><sp/>*top_ctxt<sp/>=<sp/>&amp;<ref refid="classopenage_1_1input_1_1_input_context_1af84dd2cdfe2d8655ed796b94e99ad199" kindref="member">input_manager</ref>-&gt;<ref refid="classopenage_1_1input_1_1_input_manager_1a9ccb8754431247dd05c56c445bda15bc" kindref="member">get_top_context</ref>();</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(top_ctxt<sp/>!=<sp/>&amp;<ref refid="classopenage_1_1input_1_1_input_context_1af84dd2cdfe2d8655ed796b94e99ad199" kindref="member">input_manager</ref>-&gt;<ref refid="classopenage_1_1input_1_1_input_manager_1a06819b1b5f717d9fbf45bc098e7fd457" kindref="member">get_global_context</ref>())<sp/>{</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(top_ctxt<sp/>==<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref>)<sp/>{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref><sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1input_1_1_input_context_1af84dd2cdfe2d8655ed796b94e99ad199" kindref="member">input_manager</ref>-&gt;<ref refid="classopenage_1_1input_1_1_input_manager_1a469024c2b2ac7769e0fa578c73fde160" kindref="member">remove_context</ref>(top_ctxt);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">announce_buttons_type</ref>();</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a96ee042096ca3b85bf6f5a38cd18bc4d" kindref="member">selecting</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="388"><highlight class="normal">}</highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight></codeline>
<codeline lineno="390" refid="classopenage_1_1_action_mode_1a7b0a0d95b032af2e9bf2ede80bca03c8" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_command" kindref="compound">Command</ref><sp/><ref refid="classopenage_1_1_action_mode_1a7b0a0d95b032af2e9bf2ede80bca03c8" kindref="member">ActionMode::get_action</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;pos)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_game_main" kindref="compound">GameMain</ref><sp/>*game<sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>();</highlight></codeline>
<codeline lineno="393"><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>obj<sp/>=<sp/>game-&gt;<ref refid="classopenage_1_1_game_main_1a0a2423176e649f9865eb97fc0f187b63" kindref="member">terrain</ref>-&gt;obj_at_point(pos);</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(obj)<sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_command" kindref="compound">Command</ref><sp/>c(*this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>(),<sp/>&amp;obj-&gt;unit,<sp/>pos);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref>)<sp/>{</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c.<ref refid="classopenage_1_1_command_1a5783c26abcea9f286be58aa29de1e548" kindref="member">set_ability</ref>(<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref>);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>c;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_command" kindref="compound">Command</ref><sp/>c(*this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>(),<sp/>pos);</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref>)<sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c.<ref refid="classopenage_1_1_command_1a5783c26abcea9f286be58aa29de1e548" kindref="member">set_ability</ref>(<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref>);</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>c;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="409"><highlight class="normal">}</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411" refid="classopenage_1_1_action_mode_1a3865e557756044d8183a3d24cd5b8ab4" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1a3865e557756044d8183a3d24cd5b8ab4" kindref="member">ActionMode::place_selection</ref>(<ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>point)<sp/>{</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref>)<sp/>{</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>();</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(player-&gt;can_make(*this-&gt;type_focus))<sp/>{</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>confirm<sp/>building<sp/>placement<sp/>with<sp/>left<sp/>click</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>create<sp/>foundation<sp/>using<sp/>the<sp/>producer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="420"><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_container" kindref="compound">UnitContainer</ref><sp/>*<ref refid="namespaceopenage_1_1curve_1_1tests_1afc4e799a037edab37e1e35a74da593b7" kindref="member">container</ref><sp/>=<sp/>&amp;engine-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>()-&gt;<ref refid="classopenage_1_1_game_main_1ac0651e2cfcbf6733dfe637b6b72eaefc" kindref="member">placed_units</ref>;</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>new_building<sp/>=<sp/><ref refid="namespaceopenage_1_1curve_1_1tests_1afc4e799a037edab37e1e35a74da593b7" kindref="member">container</ref>-&gt;new_unit(*this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref>,<sp/>*player,<sp/>point);</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>task<sp/>all<sp/>selected<sp/>villagers<sp/>to<sp/>build</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>editor<sp/>placed<sp/>objects<sp/>are<sp/>completed<sp/>already</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(new_building.<ref refid="classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player-&gt;deduct(this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref>-&gt;<ref refid="classopenage_1_1_unit_type_1a19960affc865b0f5d5c9aab5524831ee" kindref="member">cost</ref>.<ref refid="classopenage_1_1_resource_cost_1a916923be9959f675aadb992258068e32" kindref="member">get</ref>(*player));<sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>change,<sp/>move<sp/>elsewheres</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_command" kindref="compound">Command</ref><sp/>cmd(*player,<sp/>new_building.<ref refid="classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>());</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.<ref refid="classopenage_1_1_command_1a5783c26abcea9f286be58aa29de1e548" kindref="member">set_ability</ref>(<ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828ab0da275520918e23dd615e2a747528f1" kindref="member">ability_type::build</ref>);</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.add_flag(<ref refid="namespaceopenage_1a355391982e6c1257c3fc4de3b6402b3aa2414c252176310b2c04547257948c7b7" kindref="member">command_flag::interrupt</ref>);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a0ad857ab54207bdaa9719fc01410f101" kindref="member">all_invoke</ref>(cmd);</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>show<sp/>in<sp/>game<sp/>error<sp/>message</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="443"><highlight class="normal">}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"></highlight></codeline>
<codeline lineno="445" refid="classopenage_1_1_action_mode_1aab55848d4a5495b982df54fe1d41865b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1aab55848d4a5495b982df54fe1d41865b" kindref="member">ActionMode::render</ref>()<sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref><sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;game_control<sp/>is<sp/>unset&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(engine<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;engine<sp/>is<sp/>needed<sp/>to<sp/>render<sp/>ActionMode&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classopenage_1_1_game_main" kindref="compound">GameMain</ref><sp/>*game<sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>())<sp/>{</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>*player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>();</highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a0c428b739f584f369deaa02914537814" kindref="member">announce_resources</ref>();</highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>when<sp/>a<sp/>building<sp/>is<sp/>being<sp/>placed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref>)<sp/>{</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>txt<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref>-&gt;<ref refid="classopenage_1_1_unit_type_1aa0d238ca5c0cb6b4b328e77dc12abc11" kindref="member">default_texture</ref>();</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>size<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ad2bac35b4c96122bf04b7e8c669a3c8f" kindref="member">type_focus</ref>-&gt;<ref refid="classopenage_1_1_unit_type_1a6cb4b86a37f31b2994d197f43da03ab5" kindref="member">foundation_size</ref>;</highlight></codeline>
<codeline lineno="460"><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structopenage_1_1tile__range" kindref="compound">tile_range</ref><sp/>center<sp/>=<sp/><ref refid="namespaceopenage_1a231617a72c3e699877ee6eacb76850de" kindref="member">building_center</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a6807ef371160b0d49b5d1154ec9c6701" kindref="member">mousepos_phys3</ref>,<sp/>size,<sp/>*game-&gt;terrain);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>txt-&gt;sample(engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>,<sp/>center.<ref refid="structopenage_1_1tile__range_1a66f28f55fc7cb96a713d76b15d855a0e" kindref="member">draw</ref>.<ref refid="structopenage_1_1coord_1_1phys3_1a851739e9304a9ed9f55f51ef99c814e7" kindref="member">to_camhud</ref>(engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>),<sp/>player-&gt;<ref refid="classopenage_1_1_player_1a4abf1f98ff6f6b42147646d13008475c" kindref="member">color</ref>);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1aa1639975d663d41b17b3fabf59d8e237" kindref="member">render_text</ref>({0,<sp/>140},<sp/>12,<sp/></highlight><highlight class="stringliteral">&quot;Action<sp/>Mode<sp/>requires<sp/>a<sp/>game&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref><sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;selection<sp/>not<sp/>set&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a0a21b9382975a037b94a1331628b320c" kindref="member">on_drawhud</ref>();</highlight></codeline>
<codeline lineno="472"><highlight class="normal">}</highlight></codeline>
<codeline lineno="473"><highlight class="normal"></highlight></codeline>
<codeline lineno="474" refid="classopenage_1_1_action_mode_1adfc392ec340fa406b3bebe296f07ec21" refkind="member"><highlight class="normal">std::string<sp/><ref refid="classopenage_1_1_action_mode_1adfc392ec340fa406b3bebe296f07ec21" kindref="member">ActionMode::name</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Action<sp/>Mode&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="476"><highlight class="normal">}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"></highlight></codeline>
<codeline lineno="478" refid="classopenage_1_1_action_mode_1a6288ce1c7b45e988f140ace30845bc69" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1a6288ce1c7b45e988f140ace30845bc69" kindref="member">ActionMode::announce</ref>()<sp/>{</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1aafb84951c6575c14b5517312c5cfe191" kindref="member">OutputMode::announce</ref>();</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a0c428b739f584f369deaa02914537814" kindref="member">announce_resources</ref>();</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ae9bd7c070717c2a7b4ff21aeaeb7d7f4" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_action_mode_signals_1a01cb90fdc3c3530ffa273437d9f03048" kindref="member">ability_changed</ref>(</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a52ce5a22e101153dd47febdd3095b63c" kindref="member">use_set_ability</ref><sp/>?<sp/><ref refid="namespacestd_1a26aa0f4be3a77ac5cc3ce0cabb545042" kindref="member">std::to_string</ref>(this-&gt;<ref refid="classopenage_1_1_action_mode_1aa6a8f83256bb967d095e34517e4d357b" kindref="member">ability</ref>)<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="484"><highlight class="normal">}</highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486" refid="classopenage_1_1_action_mode_1a0c428b739f584f369deaa02914537814" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1a0c428b739f584f369deaa02914537814" kindref="member">ActionMode::announce_resources</ref>()<sp/>{</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>)<sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>*player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>())<sp/>{</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>i<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">std::underlying_type&lt;game_resource&gt;::type</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da0e3189e54a778ef92b43939c27c234bb" kindref="member">game_resource::RESOURCE_TYPE_COUNT</ref>);<sp/>i<sp/>!=<sp/>0;<sp/>--i)<sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>resource_type<sp/>=<sp/>static_cast&lt;game_resource&gt;(i<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ae9bd7c070717c2a7b4ff21aeaeb7d7f4" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_action_mode_signals_1a5184e9ff66287616fc73fda928e7b762" kindref="member">resource_changed</ref>(</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resource_type,</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>static_cast&lt;int&gt;(player-&gt;amount(resource_type))</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ae9bd7c070717c2a7b4ff21aeaeb7d7f4" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_action_mode_signals_1af13facb512270e9d9c134aeabf4bd1a7" kindref="member">population_changed</ref>(player-&gt;population.get_demand(),<sp/>player-&gt;population.get_capacity(),</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player-&gt;population.get_space()<sp/>&lt;=<sp/>0<sp/>&amp;&amp;<sp/>!player-&gt;population.is_capacity_maxed());</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="501"><highlight class="normal">}</highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503" refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_action_mode_1a30654ed7b85fa4cf0a2728c447dfa652" kindref="member">ActionMode::announce_buttons_type</ref>()<sp/>{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1afdbe6bcd8b7f61f9654a9736d9414ee5" kindref="member">ActionButtonsType</ref><sp/><ref refid="classopenage_1_1_action_mode_1a4476d678af575bc6477e287b8ef498fb" kindref="member">buttons_type</ref>;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1input_1_1_input_context_1a717f49ae6be59bee9eee3b2544156e10" kindref="member">InputContext</ref><sp/>*top_ctxt<sp/>=<sp/>&amp;engine-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>().<ref refid="classopenage_1_1input_1_1_input_manager_1a9ccb8754431247dd05c56c445bda15bc" kindref="member">get_top_context</ref>();</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(top_ctxt<sp/>==<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a93a36ad5b169eb86d13b9e7744f2087e" kindref="member">build_menu_context</ref>)<sp/>{</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buttons_type<sp/>=<sp/><ref refid="namespaceopenage_1afdbe6bcd8b7f61f9654a9736d9414ee5a70e748773cd746ae58fc3e9cdd9d49d1" kindref="member">ActionButtonsType::BuildMenu</ref>;</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(top_ctxt<sp/>==<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a3a85a0b99795561711cb8dbda9a49a94" kindref="member">build_menu_mil_context</ref>)<sp/>{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buttons_type<sp/>=<sp/><ref refid="namespaceopenage_1afdbe6bcd8b7f61f9654a9736d9414ee5a408c62a4830f43cc283514da6fbe7acc" kindref="member">ActionButtonsType::MilBuildMenu</ref>;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(top_ctxt<sp/>==<sp/>&amp;this-&gt;<ref refid="classopenage_1_1_action_mode_1a99b700f4bb44395f8d1225d646925083" kindref="member">building_context</ref><sp/>||</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1ab7bbbd3ae208b61e3fae02eca886e134" kindref="member">get_selection_type</ref>()<sp/>!=<sp/><ref refid="namespaceopenage_1a7174088e5b9a132b1bccacbee82a35cda05e717c9df8ba7e69bb8f3db541fcb7c" kindref="member">selection_type_t::own_units</ref>)<sp/>{</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buttons_type<sp/>=<sp/><ref refid="namespaceopenage_1afdbe6bcd8b7f61f9654a9736d9414ee5a6adf97f83acf6453d4a6a4b1070f3754" kindref="member">ActionButtonsType::None</ref>;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_action_mode_1a3249c18e3bd6e2a4b38c3cd238aad6da" kindref="member">selection</ref>-&gt;<ref refid="classopenage_1_1_unit_selection_1a07df9837a02027bf139d1cecfb541b4d" kindref="member">contains_military</ref>(*this-&gt;game_control-&gt;get_current_player()))<sp/>{</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_action_mode_1a4476d678af575bc6477e287b8ef498fb" kindref="member">buttons_type</ref><sp/>=<sp/><ref refid="namespaceopenage_1afdbe6bcd8b7f61f9654a9736d9414ee5a4469cd896299cc6ea6ea2054d1e5a777" kindref="member">ActionButtonsType::MilitaryUnits</ref>;</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_action_mode_1a4476d678af575bc6477e287b8ef498fb" kindref="member">buttons_type</ref><sp/>=<sp/><ref refid="namespaceopenage_1afdbe6bcd8b7f61f9654a9736d9414ee5a0cdbc629c6d54902fa05c83a9d1694a3" kindref="member">ActionButtonsType::CivilianUnits</ref>;</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classopenage_1_1_action_mode_1a4476d678af575bc6477e287b8ef498fb" kindref="member">buttons_type</ref><sp/>!=<sp/>this-&gt;buttons_type)<sp/>{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;buttons_type<sp/>=<sp/><ref refid="classopenage_1_1_action_mode_1a4476d678af575bc6477e287b8ef498fb" kindref="member">buttons_type</ref>;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1ae9bd7c070717c2a7b4ff21aeaeb7d7f4" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_action_mode_signals_1ad7a3ad25de355b8fea260dca15f56323" kindref="member">buttons_type_changed</ref>(buttons_type);</highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>announce<sp/>the<sp/>changed<sp/>input<sp/>context</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_action_mode_1a6288ce1c7b45e988f140ace30845bc69" kindref="member">announce</ref>();</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="527"><highlight class="normal">}</highlight></codeline>
<codeline lineno="528"><highlight class="normal"></highlight></codeline>
<codeline lineno="529" refid="classopenage_1_1_editor_mode_signals_1a34eb344028991d6c4f40a0c968776cf5" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_editor_mode_signals_1a34eb344028991d6c4f40a0c968776cf5" kindref="member">EditorModeSignals::EditorModeSignals</ref>(<ref refid="classopenage_1_1_editor_mode" kindref="compound">EditorMode</ref><sp/>*editor_mode)</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/>editor_mode{<ref refid="classopenage_1_1_editor_mode_signals_1a4ec65d52b16303dc20c6caa2db2734ed" kindref="member">editor_mode</ref>}<sp/>{</highlight></codeline>
<codeline lineno="532"><highlight class="normal">}</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534" refid="classopenage_1_1_editor_mode_signals_1a99bfe9ca55710da4414986c20c41a05e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_signals_1a99bfe9ca55710da4414986c20c41a05e" kindref="member">EditorModeSignals::on_current_player_name_changed</ref>()<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_signals_1a4ec65d52b16303dc20c6caa2db2734ed" kindref="member">editor_mode</ref>-&gt;<ref refid="classopenage_1_1_editor_mode_1a360404d7810def66e59134ee6ea4d0d2" kindref="member">announce_categories</ref>();</highlight></codeline>
<codeline lineno="536"><highlight class="normal">}</highlight></codeline>
<codeline lineno="537"><highlight class="normal"></highlight></codeline>
<codeline lineno="538" refid="classopenage_1_1_editor_mode_1a4166995cca17f01efabfea1d5fd352ba" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_editor_mode_1a4166995cca17f01efabfea1d5fd352ba" kindref="member">EditorMode::EditorMode</ref>(<ref refid="classqtsdl_1_1_gui_item_link" kindref="compound">qtsdl::GuiItemLink</ref><sp/>*gui_link)</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_output_mode" kindref="compound">OutputMode</ref>{<ref refid="classopenage_1_1_output_mode_1a6d3ac16256d5213f0bd6a887d81de3a6" kindref="member">gui_link</ref>},</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/>editor_current_terrain{-1},</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/>current_type_id{-1},</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>paint_terrain{},</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>gui_signals{</highlight><highlight class="keyword">this</highlight><highlight class="normal">}<sp/>{}</highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547" refid="classopenage_1_1_editor_mode_1a29b4d3a8c32153ccdc566f60fcdacf7f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a29b4d3a8c32153ccdc566f60fcdacf7f" kindref="member">EditorMode::on_game_control_set</ref>()<sp/>{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;action<sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1ab6233b0bf461be4bb1633cd9f7e7f08b" kindref="member">get_action_manager</ref>();</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>bind<sp/>required<sp/>hotkeys</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;ENABLE_BUILDING_PLACEMENT&quot;</highlight><highlight class="normal">),<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(dbg)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;change<sp/>category&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a5d4a0f5dcb58dbfc34c9a09b64a8131f" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_editor_mode_signals_1a663e745b83c2a228943641a7643af15b" kindref="member">toggle</ref>();</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(<ref refid="namespaceopenage_1_1input_1a278a7af94e412aa285e58d870c64a849a2ec2be318cc86a1224c0e9dcc71321e4" kindref="member">input::event_class::MOUSE</ref>,<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>engine](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;arg)<sp/>{</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1a75c7dda55a421ea33b2503f69fe2383a" kindref="member">e</ref>.<ref refid="classopenage_1_1input_1_1_event_1af6758c0f24529defde0e1a4788c86ff7" kindref="member">cc</ref><sp/>==<sp/><ref refid="classopenage_1_1input_1_1_class_code" kindref="compound">input::ClassCode</ref>(<ref refid="namespaceopenage_1_1input_1a278a7af94e412aa285e58d870c64a849a3421ce503e9731d435babad896b7aef8" kindref="member">input::event_class::MOUSE_BUTTON</ref>,<sp/>1)<sp/>||</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>().<ref refid="classopenage_1_1input_1_1_input_manager_1a60531d6140e41fbff6d48d6811077aab" kindref="member">is_down</ref>(<ref refid="namespaceopenage_1_1input_1a278a7af94e412aa285e58d870c64a849a3421ce503e9731d435babad896b7aef8" kindref="member">input::event_class::MOUSE_BUTTON</ref>,<sp/>1))<sp/>{</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_editor_mode_1ab1d6a70c1dac9b55ce50040bc074324f" kindref="member">paint_terrain</ref>)<sp/>{</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a1f47d053e9c09aaf9bc6ec3a85f4a49e" kindref="member">paint_terrain_at</ref>(arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1acb2429b802ec5c65f21c65a0181d3d14" kindref="member">mouse</ref>.<ref refid="structopenage_1_1coord_1_1input_1a659ce906cbf0fb7a6224f71a199f2c83" kindref="member">to_viewport</ref>(engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>));</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a1430647b024d4c9e7021756a6fa9700d" kindref="member">paint_entity_at</ref>(arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1acb2429b802ec5c65f21c65a0181d3d14" kindref="member">mouse</ref>.<ref refid="structopenage_1_1coord_1_1input_1a659ce906cbf0fb7a6224f71a199f2c83" kindref="member">to_viewport</ref>(engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>),<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1a75c7dda55a421ea33b2503f69fe2383a" kindref="member">e</ref>.<ref refid="classopenage_1_1input_1_1_event_1af6758c0f24529defde0e1a4788c86ff7" kindref="member">cc</ref><sp/>==<sp/><ref refid="classopenage_1_1input_1_1_class_code" kindref="compound">input::ClassCode</ref>(<ref refid="namespaceopenage_1_1input_1a278a7af94e412aa285e58d870c64a849a3421ce503e9731d435babad896b7aef8" kindref="member">input::event_class::MOUSE_BUTTON</ref>,<sp/>3)<sp/>||</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>().<ref refid="classopenage_1_1input_1_1_input_manager_1a60531d6140e41fbff6d48d6811077aab" kindref="member">is_down</ref>(<ref refid="namespaceopenage_1_1input_1a278a7af94e412aa285e58d870c64a849a3421ce503e9731d435babad896b7aef8" kindref="member">input::event_class::MOUSE_BUTTON</ref>,<sp/>3))<sp/>{</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="classopenage_1_1_editor_mode_1ab1d6a70c1dac9b55ce50040bc074324f" kindref="member">paint_terrain</ref>)<sp/>{</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a1430647b024d4c9e7021756a6fa9700d" kindref="member">paint_entity_at</ref>(arg.<ref refid="structopenage_1_1input_1_1action__arg__t_1acb2429b802ec5c65f21c65a0181d3d14" kindref="member">mouse</ref>.<ref refid="structopenage_1_1coord_1_1input_1a659ce906cbf0fb7a6224f71a199f2c83" kindref="member">to_viewport</ref>(engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="577"><highlight class="normal">}</highlight></codeline>
<codeline lineno="578"><highlight class="normal"></highlight></codeline>
<codeline lineno="579" refid="classopenage_1_1_editor_mode_1a51ca65c9475aa6b8b94e217d08a03bab" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a51ca65c9475aa6b8b94e217d08a03bab" kindref="member">EditorMode::available</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref><sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(warn)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;game_control<sp/>not<sp/>yet<sp/>linked<sp/>to<sp/>EditorMode&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>()-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>()<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(warn)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>enter<sp/>editor<sp/>mode<sp/>without<sp/>a<sp/>game&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="591"><highlight class="normal">}</highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight></codeline>
<codeline lineno="593" refid="classopenage_1_1_editor_mode_1a916d57d8f109641c110929dcd3015eb5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a916d57d8f109641c110929dcd3015eb5" kindref="member">EditorMode::on_enter</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595" refid="classopenage_1_1_editor_mode_1a2da25d932915bc2c5423fa4ee7d849f6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a2da25d932915bc2c5423fa4ee7d849f6" kindref="member">EditorMode::on_exit</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597" refid="classopenage_1_1_editor_mode_1a53d8b41fde0cc0e5144d43c23318a0a5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a53d8b41fde0cc0e5144d43c23318a0a5" kindref="member">EditorMode::render</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599" refid="classopenage_1_1_editor_mode_1a194b8b0abaa8a8e908fcd170f0a5d382" refkind="member"><highlight class="normal">std::string<sp/><ref refid="classopenage_1_1_editor_mode_1a194b8b0abaa8a8e908fcd170f0a5d382" kindref="member">EditorMode::name</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Editor<sp/>mode&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="601"><highlight class="normal">}</highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603" refid="classopenage_1_1_editor_mode_1ab16652517893904d8b50797a5ff682fe" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1ab16652517893904d8b50797a5ff682fe" kindref="member">EditorMode::set_current_type_id</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>current_type_id)<sp/>{</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;current_type_id<sp/>=<sp/><ref refid="classopenage_1_1_editor_mode_1a6bff75a6816fc5bec01880d1a6df205c" kindref="member">current_type_id</ref>;</highlight></codeline>
<codeline lineno="605"><highlight class="normal">}</highlight></codeline>
<codeline lineno="606"><highlight class="normal"></highlight></codeline>
<codeline lineno="607" refid="classopenage_1_1_editor_mode_1aabfa26721a22c24907c806f9d827d157" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1aabfa26721a22c24907c806f9d827d157" kindref="member">EditorMode::set_current_terrain_id</ref>(<ref refid="namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>current_terrain_id)<sp/>{</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1ad6c01540c6bfd0d099794a9c14e3f42b" kindref="member">editor_current_terrain</ref><sp/>=<sp/>current_terrain_id;</highlight></codeline>
<codeline lineno="609"><highlight class="normal">}</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611" refid="classopenage_1_1_editor_mode_1a657003c6b544b788ad27669950b35237" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a657003c6b544b788ad27669950b35237" kindref="member">EditorMode::set_paint_terrain</ref>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>paint_terrain)<sp/>{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;paint_terrain<sp/>=<sp/><ref refid="classopenage_1_1_editor_mode_1ab1d6a70c1dac9b55ce50040bc074324f" kindref="member">paint_terrain</ref>;</highlight></codeline>
<codeline lineno="613"><highlight class="normal">}</highlight></codeline>
<codeline lineno="614"><highlight class="normal"></highlight></codeline>
<codeline lineno="615" refid="classopenage_1_1_editor_mode_1a1f47d053e9c09aaf9bc6ec3a85f4a49e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a1f47d053e9c09aaf9bc6ec3a85f4a49e" kindref="member">EditorMode::paint_terrain_at</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref><sp/>&amp;point)<sp/>{</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain" kindref="compound">Terrain</ref><sp/>*terrain<sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>()-&gt;<ref refid="classopenage_1_1_game_main_1a0a2423176e649f9865eb97fc0f187b63" kindref="member">terrain</ref>.get();</highlight></codeline>
<codeline lineno="618"><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>mousepos_tile<sp/>=<sp/>point.<ref refid="structopenage_1_1coord_1_1viewport_1ad78ba1b1f9b64caa7b6eda78aaf7513a" kindref="member">to_tile</ref>(engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="620"><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*chunk<sp/>=<sp/>terrain-&gt;<ref refid="classopenage_1_1_terrain_1a7837ff925b6c466824b2388e55c198f4" kindref="member">get_create_chunk</ref>(mousepos_tile);</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/>chunk-&gt;<ref refid="classopenage_1_1_terrain_chunk_1af163db3fba4ae99206de76666f8424df" kindref="member">get_data</ref>(mousepos_tile.get_pos_on_chunk())-&gt;terrain_id<sp/>=<sp/><ref refid="classopenage_1_1_editor_mode_1ad6c01540c6bfd0d099794a9c14e3f42b" kindref="member">editor_current_terrain</ref>;</highlight></codeline>
<codeline lineno="623"><highlight class="normal">}</highlight></codeline>
<codeline lineno="624"><highlight class="normal"></highlight></codeline>
<codeline lineno="625" refid="classopenage_1_1_editor_mode_1a1430647b024d4c9e7021756a6fa9700d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a1430647b024d4c9e7021756a6fa9700d" kindref="member">EditorMode::paint_entity_at</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref><sp/>&amp;point,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>del)<sp/>{</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">get_engine</ref>();</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_game_main" kindref="compound">GameMain</ref><sp/>*game<sp/>=<sp/>engine-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>();</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain" kindref="compound">Terrain</ref><sp/>*terrain<sp/>=<sp/>game-&gt;<ref refid="classopenage_1_1_game_main_1a0a2423176e649f9865eb97fc0f187b63" kindref="member">terrain</ref>.get();</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>mousepos_phys3<sp/>=<sp/>point.<ref refid="structopenage_1_1coord_1_1viewport_1ae8aa028a39351652937d97680ff11afd" kindref="member">to_phys3</ref>(engine-&gt;<ref refid="classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>mousepos_tile<sp/>=<sp/>mousepos_phys3.<ref refid="structopenage_1_1coord_1_1phys3_1aa8aa4b7a7a76ddb625b8770ba12484d6" kindref="member">to_tile</ref>();</highlight></codeline>
<codeline lineno="632"><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*chunk<sp/>=<sp/>terrain-&gt;<ref refid="classopenage_1_1_terrain_1a7837ff925b6c466824b2388e55c198f4" kindref="member">get_create_chunk</ref>(mousepos_tile);</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>:<sp/>better<sp/>detection<sp/>of<sp/>presence<sp/>of<sp/>unit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!chunk-&gt;<ref refid="classopenage_1_1_terrain_chunk_1af163db3fba4ae99206de76666f8424df" kindref="member">get_data</ref>(mousepos_tile.get_pos_on_chunk())-&gt;obj.empty())<sp/>{</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(del)<sp/>{</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>delete<sp/>first<sp/>object<sp/>currently<sp/>standing<sp/>at<sp/>the<sp/>clicked<sp/>position</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*obj<sp/>=<sp/>chunk-&gt;<ref refid="classopenage_1_1_terrain_chunk_1af163db3fba4ae99206de76666f8424df" kindref="member">get_data</ref>(mousepos_tile.get_pos_on_chunk())-&gt;obj[0];</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj-&gt;<ref refid="classopenage_1_1_terrain_object_1af24e842fc429a5dbb73c12abcb9c3378" kindref="member">remove</ref>();</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!del<sp/>&amp;&amp;<sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a6bff75a6816fc5bec01880d1a6df205c" kindref="member">current_type_id</ref><sp/>!=<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>*player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>();</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_type" kindref="compound">UnitType</ref><sp/>*selected_type<sp/>=<sp/>player-&gt;<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(this-&gt;<ref refid="classopenage_1_1_editor_mode_1a6bff75a6816fc5bec01880d1a6df205c" kindref="member">current_type_id</ref>);</highlight></codeline>
<codeline lineno="644"><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>tile<sp/>is<sp/>empty<sp/>so<sp/>try<sp/>creating<sp/>a<sp/>unit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_container" kindref="compound">UnitContainer</ref><sp/>*<ref refid="namespaceopenage_1_1curve_1_1tests_1afc4e799a037edab37e1e35a74da593b7" kindref="member">container</ref><sp/>=<sp/>&amp;game-&gt;<ref refid="classopenage_1_1_game_main_1ac0651e2cfcbf6733dfe637b6b72eaefc" kindref="member">placed_units</ref>;</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1curve_1_1tests_1afc4e799a037edab37e1e35a74da593b7" kindref="member">container</ref>-&gt;new_unit(*selected_type,<sp/>*this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>(),<sp/>mousepos_phys3);</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="649"><highlight class="normal">}</highlight></codeline>
<codeline lineno="650"><highlight class="normal"></highlight></codeline>
<codeline lineno="651" refid="classopenage_1_1_editor_mode_1a360404d7810def66e59134ee6ea4d0d2" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a360404d7810def66e59134ee6ea4d0d2" kindref="member">EditorMode::announce_categories</ref>()<sp/>{</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>)</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>())</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a5d4a0f5dcb58dbfc34c9a09b64a8131f" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_editor_mode_signals_1a30b7b704e3b67509ebe3b10cea2349ce" kindref="member">categories_changed</ref>(player-&gt;civ-&gt;get_type_categories());</highlight></codeline>
<codeline lineno="655"><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a5d4a0f5dcb58dbfc34c9a09b64a8131f" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_editor_mode_signals_1ac3f8204249d826965a77675f177fc7b3" kindref="member">categories_content_changed</ref>();</highlight></codeline>
<codeline lineno="657"><highlight class="normal">}</highlight></codeline>
<codeline lineno="658"><highlight class="normal"></highlight></codeline>
<codeline lineno="659" refid="classopenage_1_1_editor_mode_1a8bc3906c89a7ecceff2c24512c5be24b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a8bc3906c89a7ecceff2c24512c5be24b" kindref="member">EditorMode::announce_category_content</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::string<sp/>&amp;category_name)<sp/>{</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>)</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>())<sp/>{</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>inds<sp/>=<sp/>player-&gt;civ-&gt;get_category(category_name);</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;std::tuple&lt;index_t,<sp/>uint16_t&gt;&gt;<sp/>type_and_texture(inds.size());</highlight></codeline>
<codeline lineno="664"><highlight class="normal"></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/>std::begin(type_and_texture);</highlight></codeline>
<codeline lineno="666"><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1util_1ac6f34c002692bc844cd70de03e10bc5d" kindref="member">std::for_each</ref>(std::begin(inds),<sp/>std::end(inds),<sp/>[player,<sp/>&amp;it]<sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>index)<sp/>{</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*it++<sp/>=<sp/>std::make_tuple(index,<sp/>player-&gt;get_type(index)-&gt;default_texture()-&gt;id);</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="670"><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a5d4a0f5dcb58dbfc34c9a09b64a8131f" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_editor_mode_signals_1a110b7291745184bbd3b4363d92167985" kindref="member">category_content_changed</ref>(category_name,<sp/>type_and_texture);</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="673"><highlight class="normal">}</highlight></codeline>
<codeline lineno="674"><highlight class="normal"></highlight></codeline>
<codeline lineno="675" refid="classopenage_1_1_editor_mode_1aeac3794a1c9c6b6492413573d3670133" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1aeac3794a1c9c6b6492413573d3670133" kindref="member">EditorMode::announce</ref>()<sp/>{</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_output_mode_1aafb84951c6575c14b5517312c5cfe191" kindref="member">OutputMode::announce</ref>();</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a360404d7810def66e59134ee6ea4d0d2" kindref="member">announce_categories</ref>();</highlight></codeline>
<codeline lineno="678"><highlight class="normal">}</highlight></codeline>
<codeline lineno="679"><highlight class="normal"></highlight></codeline>
<codeline lineno="680" refid="classopenage_1_1_editor_mode_1a4c17017408bec2740f3653123bd17660" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_editor_mode_1a4c17017408bec2740f3653123bd17660" kindref="member">EditorMode::set_game_control</ref>(<ref refid="classopenage_1_1_game_control" kindref="compound">GameControl</ref><sp/>*game_control)<sp/>{</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;game_control<sp/>!=<sp/><ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>)<sp/>{</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;game_control)</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QObject::disconnect(</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;this-&gt;game_control-&gt;<ref refid="classopenage_1_1_game_control_1a8d395e91d09a84a64d370e5bac938433" kindref="member">gui_signals</ref>,</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="classopenage_1_1_game_control_signals_1a95762160cc28da841b21e75c6706d70f" kindref="member">GameControlSignals::current_player_name_changed</ref>,</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;this-&gt;gui_signals,</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="classopenage_1_1_editor_mode_signals_1a99bfe9ca55710da4414986c20c41a05e" kindref="member">EditorModeSignals::on_current_player_name_changed</ref></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>actually<sp/>set<sp/>the<sp/>control</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_output_mode_1a56daba2d7cbace8b99ca51015d2f76df" kindref="member">OutputMode::set_game_control</ref>(<ref refid="classopenage_1_1_output_mode_1a77d020596235f68a9650bdf7796b6834" kindref="member">game_control</ref>);</highlight></codeline>
<codeline lineno="692"><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;game_control)</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QObject::connect(</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;this-&gt;game_control-&gt;<ref refid="classopenage_1_1_game_control_1a8d395e91d09a84a64d370e5bac938433" kindref="member">gui_signals</ref>,</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="classopenage_1_1_game_control_signals_1a95762160cc28da841b21e75c6706d70f" kindref="member">GameControlSignals::current_player_name_changed</ref>,</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;this-&gt;gui_signals,</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="classopenage_1_1_editor_mode_signals_1a99bfe9ca55710da4414986c20c41a05e" kindref="member">EditorModeSignals::on_current_player_name_changed</ref></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="700"><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_editor_mode_1a360404d7810def66e59134ee6ea4d0d2" kindref="member">announce_categories</ref>();</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>just<sp/>set<sp/>the<sp/>control</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_output_mode_1a56daba2d7cbace8b99ca51015d2f76df" kindref="member">OutputMode::set_game_control</ref>(game_control);</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="707"><highlight class="normal">}</highlight></codeline>
<codeline lineno="708"><highlight class="normal"></highlight></codeline>
<codeline lineno="709" refid="classopenage_1_1_game_control_signals_1acf833f546a790aed3bc3781377d1dc83" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_game_control_signals_1acf833f546a790aed3bc3781377d1dc83" kindref="member">GameControlSignals::GameControlSignals</ref>(<ref refid="classopenage_1_1_game_control" kindref="compound">GameControl</ref><sp/>*game_control)</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/>game_control{<ref refid="classopenage_1_1_game_control_signals_1a73ff6cc218043d15a1b8cc070bcf1a9e" kindref="member">game_control</ref>}<sp/>{</highlight></codeline>
<codeline lineno="712"><highlight class="normal">}</highlight></codeline>
<codeline lineno="713"><highlight class="normal"></highlight></codeline>
<codeline lineno="714" refid="classopenage_1_1_game_control_signals_1acd3484cc1f7feb2163be431acfc88c96" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_signals_1acd3484cc1f7feb2163be431acfc88c96" kindref="member">GameControlSignals::on_game_running</ref>(</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>running)<sp/>{</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(running)</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_signals_1a73ff6cc218043d15a1b8cc070bcf1a9e" kindref="member">game_control</ref>-&gt;<ref refid="classopenage_1_1_game_control_1a3d4b9fbef261d19138ba87083e4083a5" kindref="member">announce_current_player_name</ref>();</highlight></codeline>
<codeline lineno="717"><highlight class="normal">}</highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight></codeline>
<codeline lineno="719" refid="classopenage_1_1_game_control_1a76e43bea79237a77d0ae231df386de6a" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_game_control_1a76e43bea79237a77d0ae231df386de6a" kindref="member">GameControl::GameControl</ref>(<ref refid="classqtsdl_1_1_gui_item_link" kindref="compound">qtsdl::GuiItemLink</ref><sp/>*gui_link)</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/>engine{</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/>game{</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/>active_mode{</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/>active_mode_index{-1},</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/>current_player{1},</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/>gui_signals{</highlight><highlight class="keyword">this</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/>gui_link{gui_link}<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal">}</highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight></codeline>
<codeline lineno="730" refid="classopenage_1_1_game_control_1ad7c9d48df33f8f56ab5686c36648bfa5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1ad7c9d48df33f8f56ab5686c36648bfa5" kindref="member">GameControl::set_engine</ref>(<ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*engine)<sp/>{</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>decide<sp/>to<sp/>either<sp/>go<sp/>for<sp/>a<sp/>full<sp/>Engine<sp/>QML-singleton<sp/>or<sp/>for<sp/>a<sp/>regular<sp/>object</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(!this-&gt;engine<sp/>||<sp/>this-&gt;engine<sp/>==<sp/><ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref>,<sp/></highlight><highlight class="stringliteral">&quot;relinking<sp/>GameControl<sp/>to<sp/>another<sp/>engine<sp/>is<sp/>not<sp/>supported<sp/>and<sp/>not<sp/>caught<sp/>properly&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="733"><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>this-&gt;engine)<sp/>{</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;engine<sp/>=<sp/><ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref>;</highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>handlers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;engine-&gt;<ref refid="classopenage_1_1_engine_1a28cf66f139dbd94097277d64984154db" kindref="member">register_drawhud_action</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;action<sp/>=<sp/>this-&gt;engine-&gt;get_action_manager();</highlight></codeline>
<codeline lineno="741"><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;global_input_context<sp/>=<sp/><ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref>-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>().<ref refid="classopenage_1_1input_1_1_input_manager_1a06819b1b5f717d9fbf45bc098e7fd457" kindref="member">get_global_context</ref>();</highlight></codeline>
<codeline lineno="743"><highlight class="normal"></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>advance<sp/>the<sp/>active<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global_input_context.<ref refid="classopenage_1_1input_1_1_input_context_1a32c669bab23aa04b6d17309b21486ffa" kindref="member">bind</ref>(action.get(</highlight><highlight class="stringliteral">&quot;TOGGLE_CONSTRUCT_MODE&quot;</highlight><highlight class="normal">),<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a1d0f073f844955000861e4c0d08b20e0" kindref="member">set_mode</ref>((this-&gt;<ref refid="classopenage_1_1_game_control_1a56a4b875fe0d5b2bad9013fd112118d6" kindref="member">active_mode_index</ref><sp/>+<sp/>1)<sp/>%<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a3f7a5093f8773643b39a95e5bd47a9ef" kindref="member">modes</ref>.size());</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="748"><highlight class="normal"></highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Switching<sp/>between<sp/>players<sp/>with<sp/>the<sp/>1-8<sp/>keys</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>bind_player_switch<sp/>=<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>&amp;global_input_context](<ref refid="namespaceopenage_1_1input_1afc78129c41b8dce77d2b9c52d7619d74" kindref="member">input::action_t</ref><sp/>action,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>player_index)<sp/>{</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global_input_context.bind(action,<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>player_index](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1input_1_1action__arg__t" kindref="compound">input::action_arg_t</ref><sp/>&amp;)<sp/>{</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_game_control_1a42b20faac77a98d70096946a53f64bcc" kindref="member">current_player</ref><sp/>!=<sp/>player_index)</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1ac109fc6d1666c406f7f260f88053c947" kindref="member">game</ref><sp/>=<sp/>this-&gt;engine-&gt;<ref refid="classopenage_1_1_game_main_handle_1a8d01ae4e890d5a889f45c06182f9bdc3" kindref="member">get_game</ref>())</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(player_index<sp/>&lt;<sp/>game-&gt;player_count())<sp/>{</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a42b20faac77a98d70096946a53f64bcc" kindref="member">current_player</ref><sp/>=<sp/>player_index;</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a3d4b9fbef261d19138ba87083e4083a5" kindref="member">announce_current_player_name</ref>();</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="759"><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bind_player_switch(action.get(</highlight><highlight class="stringliteral">&quot;SWITCH_TO_PLAYER_1&quot;</highlight><highlight class="normal">),<sp/>0);</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bind_player_switch(action.get(</highlight><highlight class="stringliteral">&quot;SWITCH_TO_PLAYER_2&quot;</highlight><highlight class="normal">),<sp/>1);</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bind_player_switch(action.get(</highlight><highlight class="stringliteral">&quot;SWITCH_TO_PLAYER_3&quot;</highlight><highlight class="normal">),<sp/>2);</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bind_player_switch(action.get(</highlight><highlight class="stringliteral">&quot;SWITCH_TO_PLAYER_4&quot;</highlight><highlight class="normal">),<sp/>3);</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bind_player_switch(action.get(</highlight><highlight class="stringliteral">&quot;SWITCH_TO_PLAYER_5&quot;</highlight><highlight class="normal">),<sp/>4);</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bind_player_switch(action.get(</highlight><highlight class="stringliteral">&quot;SWITCH_TO_PLAYER_6&quot;</highlight><highlight class="normal">),<sp/>5);</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bind_player_switch(action.get(</highlight><highlight class="stringliteral">&quot;SWITCH_TO_PLAYER_7&quot;</highlight><highlight class="normal">),<sp/>6);</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bind_player_switch(action.get(</highlight><highlight class="stringliteral">&quot;SWITCH_TO_PLAYER_8&quot;</highlight><highlight class="normal">),<sp/>7);</highlight></codeline>
<codeline lineno="770"><highlight class="normal"></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;engine-&gt;announce_global_binds();</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="773"><highlight class="normal">}</highlight></codeline>
<codeline lineno="774"><highlight class="normal"></highlight></codeline>
<codeline lineno="775" refid="classopenage_1_1_game_control_1ae6ce3ec10ca18afc9cb7235c88ac7113" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1ae6ce3ec10ca18afc9cb7235c88ac7113" kindref="member">GameControl::set_game</ref>(<ref refid="classopenage_1_1_game_main_handle" kindref="compound">GameMainHandle</ref><sp/>*game)<sp/>{</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;game<sp/>!=<sp/><ref refid="classopenage_1_1_game_control_1ac109fc6d1666c406f7f260f88053c947" kindref="member">game</ref>)<sp/>{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;game)</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QObject::disconnect(&amp;this-&gt;game-&gt;<ref refid="classopenage_1_1_game_main_handle_1a655876099f3ef7ab5ee0aee5b08b9a9c" kindref="member">gui_signals</ref>,</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="classopenage_1_1_game_main_signals_1a9394777bfabb0220f14b18173e32fb5e" kindref="member">GameMainSignals::game_running</ref>,</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;this-&gt;gui_signals,</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="classopenage_1_1_game_control_signals_1acd3484cc1f7feb2163be431acfc88c96" kindref="member">GameControlSignals::on_game_running</ref>);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"></highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;game<sp/>=<sp/><ref refid="classopenage_1_1_game_control_1ac109fc6d1666c406f7f260f88053c947" kindref="member">game</ref>;</highlight></codeline>
<codeline lineno="784"><highlight class="normal"></highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;game)</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QObject::connect(&amp;this-&gt;game-&gt;<ref refid="classopenage_1_1_game_main_handle_1a655876099f3ef7ab5ee0aee5b08b9a9c" kindref="member">gui_signals</ref>,</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="classopenage_1_1_game_main_signals_1a9394777bfabb0220f14b18173e32fb5e" kindref="member">GameMainSignals::game_running</ref>,</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;this-&gt;gui_signals,</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="classopenage_1_1_game_control_signals_1acd3484cc1f7feb2163be431acfc88c96" kindref="member">GameControlSignals::on_game_running</ref>);</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="791"><highlight class="normal">}</highlight></codeline>
<codeline lineno="792"><highlight class="normal"></highlight></codeline>
<codeline lineno="793" refid="classopenage_1_1_game_control_1aa44a60840b738c202e328902943d8162" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1aa44a60840b738c202e328902943d8162" kindref="member">GameControl::set_modes</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;OutputMode*&gt;<sp/>&amp;modes)<sp/>{</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>old_mode_index<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a56a4b875fe0d5b2bad9013fd112118d6" kindref="member">active_mode_index</ref>;</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a1d0f073f844955000861e4c0d08b20e0" kindref="member">set_mode</ref>(-1);</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;modes<sp/>=<sp/><ref refid="classopenage_1_1_game_control_1a3f7a5093f8773643b39a95e5bd47a9ef" kindref="member">modes</ref>;</highlight></codeline>
<codeline lineno="798"><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>mode<sp/>:<sp/>this-&gt;modes)<sp/>{</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>link<sp/>the<sp/>controller<sp/>to<sp/>the<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mode-&gt;set_game_control(</highlight><highlight class="keyword">this</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="803"><highlight class="normal"></highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>announce<sp/>the<sp/>newly<sp/>set<sp/>modes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a8d395e91d09a84a64d370e5bac938433" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_game_control_signals_1a8a1d1930de8dacf259c1190f49e62b2b" kindref="member">modes_changed</ref>(this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>,</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a56a4b875fe0d5b2bad9013fd112118d6" kindref="member">active_mode_index</ref>);</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>try<sp/>to<sp/>enter<sp/>the<sp/>mode<sp/>we<sp/>were<sp/>in<sp/>before</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>assuming<sp/>its<sp/>index<sp/>didn&apos;t<sp/>change.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(old_mode_index<sp/>!=<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(old_mode_index<sp/>&lt;<sp/>std::distance(std::begin(this-&gt;modes),</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::end(this-&gt;modes)))<sp/>{</highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a1d0f073f844955000861e4c0d08b20e0" kindref="member">set_mode</ref>(old_mode_index,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(warn)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;couldn&apos;t<sp/>enter<sp/>previous<sp/>gui<sp/>mode<sp/>#&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;&lt;<sp/>old_mode_index<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>as<sp/>it<sp/>vanished.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="821"><highlight class="normal">}</highlight></codeline>
<codeline lineno="822"><highlight class="normal"></highlight></codeline>
<codeline lineno="823" refid="classopenage_1_1_game_control_1a8c867441262580369ff7c66ba6bd0e4b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1a8c867441262580369ff7c66ba6bd0e4b" kindref="member">GameControl::announce_mode</ref>()<sp/>{</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a8d395e91d09a84a64d370e5bac938433" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_game_control_signals_1a0455b47d2bf50224596f85e397a9c6ff" kindref="member">mode_changed</ref>(this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>,</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a56a4b875fe0d5b2bad9013fd112118d6" kindref="member">active_mode_index</ref>);</highlight></codeline>
<codeline lineno="826"><highlight class="normal"></highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref><sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>-&gt;<ref refid="classopenage_1_1_output_mode_1aafb84951c6575c14b5517312c5cfe191" kindref="member">announce</ref>();</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="830"><highlight class="normal">}</highlight></codeline>
<codeline lineno="831"><highlight class="normal"></highlight></codeline>
<codeline lineno="832" refid="classopenage_1_1_game_control_1a3d4b9fbef261d19138ba87083e4083a5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1a3d4b9fbef261d19138ba87083e4083a5" kindref="member">GameControl::announce_current_player_name</ref>()<sp/>{</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>*player<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">get_current_player</ref>())<sp/>{</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a8d395e91d09a84a64d370e5bac938433" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_game_control_signals_1a95762160cc28da841b21e75c6706d70f" kindref="member">current_player_name_changed</ref>(</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="namespacestd_1a26aa0f4be3a77ac5cc3ce0cabb545042" kindref="member">std::to_string</ref>(player-&gt;color)<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;]<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>player-&gt;name);</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>emit<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a8d395e91d09a84a64d370e5bac938433" kindref="member">gui_signals</ref>.<ref refid="classopenage_1_1_game_control_signals_1a17501d8252313b0da13baee552034f6e" kindref="member">current_civ_index_changed</ref>(player-&gt;civ-&gt;civ_id);</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="838"><highlight class="normal">}</highlight></codeline>
<codeline lineno="839"><highlight class="normal"></highlight></codeline>
<codeline lineno="840" refid="classopenage_1_1_game_control_1a56eadb260ee512fa9034f25f67308e61" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1a56eadb260ee512fa9034f25f67308e61" kindref="member">GameControl::on_drawhud</ref>()<sp/>{</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>render<sp/>the<sp/>active<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>)</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>-&gt;<ref refid="classopenage_1_1_output_mode_1a3ee7e90a18de82e81b02e429fb392694" kindref="member">render</ref>();</highlight></codeline>
<codeline lineno="844"><highlight class="normal"></highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="846"><highlight class="normal">}</highlight></codeline>
<codeline lineno="847"><highlight class="normal"></highlight></codeline>
<codeline lineno="848" refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_player" kindref="compound">Player</ref>*<sp/><ref refid="classopenage_1_1_game_control_1aa7c61c3caafc810355005e83c8f234e2" kindref="member">GameControl::get_current_player</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1ac109fc6d1666c406f7f260f88053c947" kindref="member">game</ref><sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref>-&gt;<ref refid="classopenage_1_1_engine_1a3e79c3919abbc3cab0716e4807f7c93e" kindref="member">get_game</ref>())<sp/>{</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>number<sp/>=<sp/><ref refid="classopenage_1_1_game_control_1ac109fc6d1666c406f7f260f88053c947" kindref="member">game</ref>-&gt;player_count();</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1ac109fc6d1666c406f7f260f88053c947" kindref="member">game</ref>-&gt;get_player(this-&gt;<ref refid="classopenage_1_1_game_control_1a42b20faac77a98d70096946a53f64bcc" kindref="member">current_player</ref><sp/>%<sp/>number);</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="854"><highlight class="normal">}</highlight></codeline>
<codeline lineno="855"><highlight class="normal"></highlight></codeline>
<codeline lineno="856" refid="classopenage_1_1_game_control_1a1d0f073f844955000861e4c0d08b20e0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_control_1a1d0f073f844955000861e4c0d08b20e0" kindref="member">GameControl::set_mode</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mode_index,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>signal_if_unchanged)<sp/>{</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>need_to_signal<sp/>=<sp/>signal_if_unchanged;</highlight></codeline>
<codeline lineno="858"><highlight class="normal"></highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>we<sp/>wanna<sp/>set<sp/>a<sp/>new<sp/>mode?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mode_index<sp/>!=<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="861"><highlight class="normal"></highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>new<sp/>mode<sp/>is<sp/>valid,<sp/>available<sp/>and<sp/>not<sp/>active<sp/>at<sp/>the<sp/>moment</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mode_index<sp/>&lt;<sp/>std::distance(std::begin(this-&gt;<ref refid="classopenage_1_1_game_control_1a3f7a5093f8773643b39a95e5bd47a9ef" kindref="member">modes</ref>),</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::end(this-&gt;<ref refid="classopenage_1_1_game_control_1a3f7a5093f8773643b39a95e5bd47a9ef" kindref="member">modes</ref>))</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a3f7a5093f8773643b39a95e5bd47a9ef" kindref="member">modes</ref>[mode_index]-&gt;available()</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a56a4b875fe0d5b2bad9013fd112118d6" kindref="member">active_mode_index</ref><sp/>!=<sp/>mode_index)<sp/>{</highlight></codeline>
<codeline lineno="867"><highlight class="normal"></highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(!this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref><sp/>==<sp/>(this-&gt;<ref refid="classopenage_1_1_game_control_1a56a4b875fe0d5b2bad9013fd112118d6" kindref="member">active_mode_index</ref><sp/>==<sp/>-1),</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;inconsistency<sp/>between<sp/>the<sp/>active<sp/>mode<sp/>index<sp/>and<sp/>pointer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="870"><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>exit<sp/>from<sp/>the<sp/>old<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>)<sp/>{</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref>-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>().<ref refid="classopenage_1_1input_1_1_input_manager_1a469024c2b2ac7769e0fa578c73fde160" kindref="member">remove_context</ref>(</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref></highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="876"><highlight class="normal"></highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>trigger<sp/>the<sp/>exit<sp/>callback<sp/>of<sp/>the<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>)<sp/>{</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>-&gt;<ref refid="classopenage_1_1_output_mode_1ac4731437d730c75e214f7fda4c218da1" kindref="member">on_exit</ref>();</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="882"><highlight class="normal"></highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>new<sp/>active<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a56a4b875fe0d5b2bad9013fd112118d6" kindref="member">active_mode_index</ref><sp/>=<sp/>mode_index;</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref><sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a3f7a5093f8773643b39a95e5bd47a9ef" kindref="member">modes</ref>[mode_index];</highlight></codeline>
<codeline lineno="886"><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>trigger<sp/>the<sp/>entry<sp/>callback</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>-&gt;<ref refid="classopenage_1_1_output_mode_1a84beca51250156148fe4af178ed87c22" kindref="member">on_enter</ref>();</highlight></codeline>
<codeline lineno="889"><highlight class="normal"></highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>mode-local<sp/>input<sp/>context</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref>-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>().<ref refid="classopenage_1_1input_1_1_input_manager_1a2ece2b2ad4a08c15fb00a39b0f553d3c" kindref="member">push_context</ref>(</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref></highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="894"><highlight class="normal"></highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>need_to_signal<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>unassign<sp/>the<sp/>active<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref>)<sp/>{</highlight></codeline>
<codeline lineno="901"><highlight class="normal"></highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>the<sp/>input<sp/>context</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref>-&gt;<ref refid="classopenage_1_1_engine_1a248149eac4678d70fe55d6ba5cdc695a" kindref="member">get_input_manager</ref>().<ref refid="classopenage_1_1input_1_1_input_manager_1a469024c2b2ac7769e0fa578c73fde160" kindref="member">remove_context</ref>(</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref></highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="906"><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a56a4b875fe0d5b2bad9013fd112118d6" kindref="member">active_mode_index</ref><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1ab8ab8bdeb304d66b75541b1fd1b9695c" kindref="member">active_mode</ref><sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="909"><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>need_to_signal<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="913"><highlight class="normal"></highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(need_to_signal)<sp/>{</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a8c867441262580369ff7c66ba6bd0e4b" kindref="member">announce_mode</ref>();</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="917"><highlight class="normal">}</highlight></codeline>
<codeline lineno="918"><highlight class="normal"></highlight></codeline>
<codeline lineno="919" refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*<ref refid="classopenage_1_1_game_control_1aed1e983dee9b075a3343b72aed5678bd" kindref="member">GameControl::get_engine</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref><sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1error_1_1_error" kindref="compound">Error</ref>{<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(err)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;game<sp/>control<sp/>doesn&apos;t<sp/>have<sp/>a<sp/>valid<sp/>engine<sp/>pointer<sp/>yet&quot;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="923"><highlight class="normal"></highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_game_control_1a91ef234e4c49b19b716ebd05f7bda0a7" kindref="member">engine</ref>;</highlight></codeline>
<codeline lineno="925"><highlight class="normal">}</highlight></codeline>
<codeline lineno="926"><highlight class="normal"></highlight></codeline>
<codeline lineno="927"><highlight class="normal"></highlight></codeline>
<codeline lineno="928"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>openage</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="libopenage/game_control.cpp"/>
  </compounddef>
</doxygen>
