<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="producer_8cpp" kind="file" language="C++">
    <compoundname>producer.cpp</compoundname>
    <includes local="no">initializer_list</includes>
    <includes refid="engine_8h" local="yes">../engine.h</includes>
    <includes refid="log_8h" local="yes">../log/log.h</includes>
    <includes local="yes">../gamedata/unit.gen.h</includes>
    <includes refid="terrain_8h" local="yes">../terrain/terrain.h</includes>
    <includes refid="terrain__object_8h" local="yes">../terrain/terrain_object.h</includes>
    <includes refid="terrain__outline_8h" local="yes">../terrain/terrain_outline.h</includes>
    <includes refid="strings_8h" local="yes">../util/strings.h</includes>
    <includes refid="ability_8h" local="yes">ability.h</includes>
    <includes refid="unit_2action_8h" local="yes">action.h</includes>
    <includes refid="producer_8h" local="yes">producer.h</includes>
    <includes refid="unit_8h" local="yes">unit.h</includes>
    <includes refid="unit__texture_8h" local="yes">unit_texture.h</includes>
    <incdepgraph>
      <node id="25844">
        <label>list</label>
      </node>
      <node id="25835">
        <label>atomic</label>
      </node>
      <node id="25869">
        <label>coord/coordmanager.h</label>
        <link refid="coordmanager_8h"/>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25882" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
      </node>
      <node id="25877">
        <label>../util/fixed_point.h</label>
        <link refid="fixed__point_8h"/>
        <childnode refid="25872" relation="include">
        </childnode>
        <childnode refid="25878" relation="include">
        </childnode>
        <childnode refid="25874" relation="include">
        </childnode>
        <childnode refid="25841" relation="include">
        </childnode>
        <childnode refid="25879" relation="include">
        </childnode>
        <childnode refid="25867" relation="include">
        </childnode>
        <childnode refid="25836" relation="include">
        </childnode>
        <childnode refid="25871" relation="include">
        </childnode>
      </node>
      <node id="25841">
        <label>iomanip</label>
      </node>
      <node id="25840">
        <label>functional</label>
      </node>
      <node id="25893">
        <label>queue</label>
      </node>
      <node id="25879">
        <label>limits</label>
      </node>
      <node id="25942">
        <label>../pathfinding/path.h</label>
        <link refid="pathfinding_2path_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
        <childnode refid="25943" relation="include">
        </childnode>
        <childnode refid="25871" relation="include">
        </childnode>
      </node>
      <node id="25876">
        <label>declarations.h</label>
        <link refid="declarations_8h"/>
        <childnode refid="25815" relation="include">
        </childnode>
        <childnode refid="25877" relation="include">
        </childnode>
      </node>
      <node id="25889">
        <label>guisys/public/gui_singleton_items_info.h</label>
        <link refid="gui__singleton__items__info_8h"/>
      </node>
      <node id="25956">
        <label>game_spec.h</label>
        <link refid="game__spec_8h"/>
        <childnode refid="25903" relation="include">
        </childnode>
        <childnode refid="25952" relation="include">
        </childnode>
        <childnode refid="25953" relation="include">
        </childnode>
        <childnode refid="25930" relation="include">
        </childnode>
        <childnode refid="25957" relation="include">
        </childnode>
        <childnode refid="25958" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25820" relation="include">
        </childnode>
      </node>
      <node id="25850">
        <label>hash_functions.h</label>
        <link refid="hash__functions_8h"/>
        <childnode refid="25851" relation="include">
        </childnode>
        <childnode refid="25849" relation="include">
        </childnode>
      </node>
      <node id="25934">
        <label>../texture.h</label>
        <link refid="texture_8h"/>
        <childnode refid="25935" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25936" relation="include">
        </childnode>
        <childnode refid="25882" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
        <childnode refid="25937" relation="include">
        </childnode>
        <childnode refid="25938" relation="include">
        </childnode>
        <childnode refid="25854" relation="include">
        </childnode>
      </node>
      <node id="25862">
        <label>setup.h</label>
        <link refid="setup_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
      </node>
      <node id="25820">
        <label>QObject</label>
      </node>
      <node id="25907">
        <label>input/input_manager.h</label>
        <link refid="input__manager_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25817" relation="include">
        </childnode>
        <childnode refid="25890" relation="include">
        </childnode>
        <childnode refid="25908" relation="include">
        </childnode>
        <childnode refid="25909" relation="include">
        </childnode>
        <childnode refid="25911" relation="include">
        </childnode>
      </node>
      <node id="25955">
        <label>civilisation.h</label>
        <link refid="civilisation_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25956" relation="include">
        </childnode>
      </node>
      <node id="25815">
        <label>cstdint</label>
      </node>
      <node id="25948">
        <label>../log/logsource.h</label>
        <link refid="logsource_8h"/>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25830" relation="include">
        </childnode>
      </node>
      <node id="25880">
        <label>coord_nese.gen.h</label>
      </node>
      <node id="25886">
        <label>stdlib.h</label>
      </node>
      <node id="25927">
        <label>screenshot.h</label>
        <link refid="screenshot_8h"/>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25928" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25882" relation="include">
        </childnode>
      </node>
      <node id="25838">
        <label>strings.h</label>
        <link refid="strings_8h"/>
        <childnode refid="25839" relation="include">
        </childnode>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25841" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25842" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
      </node>
      <node id="25896">
        <label>job_aborted_exception.h</label>
        <link refid="job__aborted__exception_8h"/>
        <childnode refid="25861" relation="include">
        </childnode>
      </node>
      <node id="25812">
        <label>libopenage/unit/producer.cpp</label>
        <link refid="producer_8cpp"/>
        <childnode refid="25813" relation="include">
        </childnode>
        <childnode refid="25814" relation="include">
        </childnode>
        <childnode refid="25821" relation="include">
        </childnode>
        <childnode refid="25929" relation="include">
        </childnode>
        <childnode refid="25930" relation="include">
        </childnode>
        <childnode refid="25939" relation="include">
        </childnode>
        <childnode refid="25940" relation="include">
        </childnode>
        <childnode refid="25838" relation="include">
        </childnode>
        <childnode refid="25923" relation="include">
        </childnode>
        <childnode refid="25941" relation="include">
        </childnode>
        <childnode refid="25951" relation="include">
        </childnode>
        <childnode refid="25947" relation="include">
        </childnode>
        <childnode refid="25957" relation="include">
        </childnode>
      </node>
      <node id="25895">
        <label>abortable_job_state.h</label>
        <link refid="abortable__job__state_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25896" relation="include">
        </childnode>
        <childnode refid="25897" relation="include">
        </childnode>
        <childnode refid="25902" relation="include">
        </childnode>
      </node>
      <node id="25859">
        <label>exctranslate.h</label>
        <link refid="exctranslate_8h"/>
        <childnode refid="25860" relation="include">
        </childnode>
      </node>
      <node id="25849">
        <label>category.h</label>
        <link refid="category_8h"/>
        <childnode refid="25824" relation="include">
        </childnode>
      </node>
      <node id="25874">
        <label>cmath</label>
      </node>
      <node id="25952">
        <label>../gamedata/gamedata.gen.h</label>
      </node>
      <node id="25861">
        <label>stdexcept</label>
      </node>
      <node id="25858">
        <label>../util/language.h</label>
        <link refid="language_8h"/>
      </node>
      <node id="25918">
        <label>timing.h</label>
        <link refid="timing_8h"/>
        <childnode refid="25815" relation="include">
        </childnode>
      </node>
      <node id="25949">
        <label>attributes.h</label>
        <link refid="attributes_8h"/>
        <childnode refid="25945" relation="include">
        </childnode>
        <childnode refid="25944" relation="include">
        </childnode>
      </node>
      <node id="25932">
        <label>../assetmanager.h</label>
        <link refid="assetmanager_8h"/>
        <childnode refid="25831" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25854" relation="include">
        </childnode>
      </node>
      <node id="25923">
        <label>ability.h</label>
        <link refid="ability_8h"/>
        <childnode refid="25924" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25836" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25925" relation="include">
        </childnode>
      </node>
      <node id="25940">
        <label>../terrain/terrain_outline.h</label>
        <link refid="terrain__outline_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
      </node>
      <node id="25843">
        <label>logsink.h</label>
        <link refid="logsink_8h"/>
        <childnode refid="25844" relation="include">
        </childnode>
        <childnode refid="25845" relation="include">
        </childnode>
        <childnode refid="25822" relation="include">
        </childnode>
      </node>
      <node id="25839">
        <label>cstdarg</label>
      </node>
      <node id="25828">
        <label>string</label>
      </node>
      <node id="25830">
        <label>message.h</label>
        <link refid="message_8h"/>
        <childnode refid="25815" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25831" relation="include">
        </childnode>
        <childnode refid="25832" relation="include">
        </childnode>
        <childnode refid="25834" relation="include">
        </childnode>
        <childnode refid="25843" relation="include">
        </childnode>
        <childnode refid="25822" relation="include">
        </childnode>
      </node>
      <node id="25832">
        <label>../util/constexpr.h</label>
        <link refid="constexpr_8h"/>
        <childnode refid="25833" relation="include">
        </childnode>
      </node>
      <node id="25834">
        <label>../util/stringformatter.h</label>
        <link refid="stringformatter_8h"/>
        <childnode refid="25835" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25836" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
        <childnode refid="25837" relation="include">
        </childnode>
        <childnode refid="25838" relation="include">
        </childnode>
      </node>
      <node id="25945">
        <label>map</label>
      </node>
      <node id="25946">
        <label>research.h</label>
        <link refid="research_8h"/>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
      </node>
      <node id="25914">
        <label>util/variable.h</label>
        <link refid="variable_8h"/>
      </node>
      <node id="25929">
        <label>../gamedata/unit.gen.h</label>
      </node>
      <node id="25910">
        <label>unordered_set</label>
      </node>
      <node id="25885">
        <label>cvar/cvar.h</label>
        <link refid="cvar_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25886" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25887" relation="include">
        </childnode>
        <childnode refid="25857" relation="include">
        </childnode>
        <childnode refid="25854" relation="include">
        </childnode>
      </node>
      <node id="25890">
        <label>handlers.h</label>
        <link refid="handlers_8h"/>
        <childnode refid="25817" relation="include">
        </childnode>
        <childnode refid="25882" relation="include">
        </childnode>
      </node>
      <node id="25898">
        <label>exception</label>
      </node>
      <node id="25900">
        <label>stddef.h</label>
      </node>
      <node id="25847">
        <label>fstream</label>
      </node>
      <node id="25867">
        <label>ostream</label>
      </node>
      <node id="25888">
        <label>gui/engine_info.h</label>
        <link refid="engine__info_8h"/>
        <childnode refid="25854" relation="include">
        </childnode>
        <childnode refid="25889" relation="include">
        </childnode>
      </node>
      <node id="25939">
        <label>../terrain/terrain_object.h</label>
        <link refid="terrain__object_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25900" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
      </node>
      <node id="25891">
        <label>job/job_manager.h</label>
        <link refid="job__manager_8h"/>
        <childnode refid="25835" relation="include">
        </childnode>
        <childnode refid="25892" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25845" relation="include">
        </childnode>
        <childnode refid="25893" relation="include">
        </childnode>
        <childnode refid="25894" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25895" relation="include">
        </childnode>
        <childnode refid="25903" relation="include">
        </childnode>
        <childnode refid="25904" relation="include">
        </childnode>
        <childnode refid="25905" relation="include">
        </childnode>
        <childnode refid="25901" relation="include">
        </childnode>
        <childnode refid="25902" relation="include">
        </childnode>
      </node>
      <node id="25954">
        <label>../gamestate/player.h</label>
        <link refid="player_8h"/>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25955" relation="include">
        </childnode>
        <childnode refid="25959" relation="include">
        </childnode>
        <childnode refid="25925" relation="include">
        </childnode>
        <childnode refid="25960" relation="include">
        </childnode>
      </node>
      <node id="25855">
        <label>../pyinterface/pyobject.h</label>
        <link refid="pyobject_8h"/>
        <childnode refid="25815" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25856" relation="include">
        </childnode>
        <childnode refid="25857" relation="include">
        </childnode>
      </node>
      <node id="25873">
        <label>limits.h</label>
      </node>
      <node id="25853">
        <label>resource_def.h</label>
        <link refid="resource__def_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25854" relation="include">
        </childnode>
        <childnode refid="25849" relation="include">
        </childnode>
        <childnode refid="25866" relation="include">
        </childnode>
        <childnode refid="25868" relation="include">
        </childnode>
      </node>
      <node id="25951">
        <label>producer.h</label>
        <link refid="producer_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
        <childnode refid="25952" relation="include">
        </childnode>
        <childnode refid="25953" relation="include">
        </childnode>
        <childnode refid="25954" relation="include">
        </childnode>
        <childnode refid="25947" relation="include">
        </childnode>
        <childnode refid="25961" relation="include">
        </childnode>
      </node>
      <node id="25860">
        <label>../error/error.h</label>
        <link refid="error_2error_8h"/>
        <childnode refid="25824" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25861" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
        <childnode refid="25830" relation="include">
        </childnode>
      </node>
      <node id="25871">
        <label>../util/misc.h</label>
        <link refid="misc_8h"/>
        <childnode refid="25872" relation="include">
        </childnode>
        <childnode refid="25873" relation="include">
        </childnode>
        <childnode refid="25874" relation="include">
        </childnode>
        <childnode refid="25875" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25860" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
      </node>
      <node id="25958">
        <label>../util/csv.h</label>
        <link refid="csv_8h"/>
        <childnode refid="25833" relation="include">
        </childnode>
        <childnode refid="25875" relation="include">
        </childnode>
        <childnode refid="25847" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25860" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
        <childnode refid="25865" relation="include">
        </childnode>
        <childnode refid="25854" relation="include">
        </childnode>
      </node>
      <node id="25911">
        <label>input_context.h</label>
        <link refid="input__context_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25912" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25908" relation="include">
        </childnode>
        <childnode refid="25909" relation="include">
        </childnode>
      </node>
      <node id="25881">
        <label>coord_neseup.gen.h</label>
      </node>
      <node id="25906">
        <label>worker.h</label>
        <link refid="worker_8h"/>
        <childnode refid="25835" relation="include">
        </childnode>
        <childnode refid="25892" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25893" relation="include">
        </childnode>
        <childnode refid="25894" relation="include">
        </childnode>
        <childnode refid="25901" relation="include">
        </childnode>
      </node>
      <node id="25817">
        <label>SDL2/SDL.h</label>
      </node>
      <node id="25915">
        <label>util/externalprofiler.h</label>
        <link refid="externalprofiler_8h"/>
      </node>
      <node id="25892">
        <label>condition_variable</label>
      </node>
      <node id="25950">
        <label>command.h</label>
        <link refid="command_8h"/>
        <childnode refid="25910" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25923" relation="include">
        </childnode>
      </node>
      <node id="25825">
        <label>typeinfo</label>
      </node>
      <node id="25957">
        <label>../unit/unit_texture.h</label>
        <link refid="unit__texture_8h"/>
        <childnode refid="25815" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25953" relation="include">
        </childnode>
      </node>
      <node id="25848">
        <label>audio/audio_manager.h</label>
        <link refid="audio__manager_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25817" relation="include">
        </childnode>
        <childnode refid="25849" relation="include">
        </childnode>
        <childnode refid="25850" relation="include">
        </childnode>
        <childnode refid="25852" relation="include">
        </childnode>
        <childnode refid="25853" relation="include">
        </childnode>
      </node>
      <node id="25852">
        <label>sound.h</label>
        <link refid="sound_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25849" relation="include">
        </childnode>
      </node>
      <node id="25924">
        <label>bitset</label>
      </node>
      <node id="25960">
        <label>score.h</label>
        <link refid="score_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25925" relation="include">
        </childnode>
      </node>
      <node id="25904">
        <label>job_group.h</label>
        <link refid="job__group_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25860" relation="include">
        </childnode>
        <childnode refid="25895" relation="include">
        </childnode>
        <childnode refid="25903" relation="include">
        </childnode>
        <childnode refid="25905" relation="include">
        </childnode>
        <childnode refid="25902" relation="include">
        </childnode>
        <childnode refid="25906" relation="include">
        </childnode>
      </node>
      <node id="25883">
        <label>coord_xy.gen.h</label>
      </node>
      <node id="25851">
        <label>tuple</label>
      </node>
      <node id="25928">
        <label>ctime</label>
      </node>
      <node id="25814">
        <label>../engine.h</label>
        <link refid="engine_8h"/>
        <childnode refid="25815" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25817" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25820" relation="include">
        </childnode>
        <childnode refid="25821" relation="include">
        </childnode>
        <childnode refid="25846" relation="include">
        </childnode>
        <childnode refid="25848" relation="include">
        </childnode>
        <childnode refid="25869" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25882" relation="include">
        </childnode>
        <childnode refid="25885" relation="include">
        </childnode>
        <childnode refid="25888" relation="include">
        </childnode>
        <childnode refid="25890" relation="include">
        </childnode>
        <childnode refid="25891" relation="include">
        </childnode>
        <childnode refid="25907" relation="include">
        </childnode>
        <childnode refid="25908" relation="include">
        </childnode>
        <childnode refid="25913" relation="include">
        </childnode>
        <childnode refid="25915" relation="include">
        </childnode>
        <childnode refid="25916" relation="include">
        </childnode>
        <childnode refid="25854" relation="include">
        </childnode>
        <childnode refid="25919" relation="include">
        </childnode>
        <childnode refid="25922" relation="include">
        </childnode>
        <childnode refid="25838" relation="include">
        </childnode>
        <childnode refid="25927" relation="include">
        </childnode>
      </node>
      <node id="25866">
        <label>format.h</label>
        <link refid="format_8h"/>
        <childnode refid="25867" relation="include">
        </childnode>
      </node>
      <node id="25926">
        <label>unit_container.h</label>
        <link refid="unit__container_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
        <childnode refid="25890" relation="include">
        </childnode>
        <childnode refid="25918" relation="include">
        </childnode>
      </node>
      <node id="25902">
        <label>types.h</label>
        <link refid="job_2types_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
      </node>
      <node id="25912">
        <label>stack</label>
      </node>
      <node id="25819">
        <label>vector</label>
      </node>
      <node id="25821">
        <label>log/log.h</label>
        <link refid="log_8h"/>
        <childnode refid="25822" relation="include">
        </childnode>
        <childnode refid="25830" relation="include">
        </childnode>
      </node>
      <node id="25827">
        <label>ciso646</label>
      </node>
      <node id="25908">
        <label>action.h</label>
        <link refid="input_2action_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25882" relation="include">
        </childnode>
        <childnode refid="25909" relation="include">
        </childnode>
      </node>
      <node id="25897">
        <label>typed_job_state_base.h</label>
        <link refid="typed__job__state__base_8h"/>
        <childnode refid="25835" relation="include">
        </childnode>
        <childnode refid="25898" relation="include">
        </childnode>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25899" relation="include">
        </childnode>
        <childnode refid="25860" relation="include">
        </childnode>
        <childnode refid="25896" relation="include">
        </childnode>
        <childnode refid="25901" relation="include">
        </childnode>
        <childnode refid="25902" relation="include">
        </childnode>
      </node>
      <node id="25887">
        <label>utility</label>
      </node>
      <node id="25920">
        <label>array</label>
      </node>
      <node id="25937">
        <label>shader/program.h</label>
        <link refid="program_8h"/>
        <childnode refid="25935" relation="include">
        </childnode>
      </node>
      <node id="25842">
        <label>sstream</label>
      </node>
      <node id="25826">
        <label>compiler.h</label>
        <link refid="compiler_8h"/>
        <childnode refid="25827" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25829" relation="include">
        </childnode>
      </node>
      <node id="25863">
        <label>file.h</label>
        <link refid="file_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25864" relation="include">
        </childnode>
        <childnode refid="25855" relation="include">
        </childnode>
      </node>
      <node id="25829">
        <label>signal.h</label>
        <link refid="signal_8h"/>
        <childnode refid="25829" relation="include">
        </childnode>
      </node>
      <node id="25935">
        <label>epoxy/gl.h</label>
      </node>
      <node id="25925">
        <label>../gamestate/resource.h</label>
        <link refid="gamestate_2resource_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
      </node>
      <node id="25837">
        <label>externalsstream.h</label>
        <link refid="externalsstream_8h"/>
        <childnode refid="25824" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
      </node>
      <node id="25822">
        <label>level.h</label>
        <link refid="level_8h"/>
        <childnode refid="25823" relation="include">
        </childnode>
      </node>
      <node id="25882">
        <label>pixel.h</label>
        <link refid="pixel_8h"/>
        <childnode refid="25883" relation="include">
        </childnode>
        <childnode refid="25876" relation="include">
        </childnode>
      </node>
      <node id="25865">
        <label>fslike/native.h</label>
        <link refid="fslike_2native_8h"/>
      </node>
      <node id="25936">
        <label>gamedata/texture.gen.h</label>
      </node>
      <node id="25864">
        <label>filelike/filelike.h</label>
        <link refid="filelike_8h"/>
        <childnode refid="25824" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
      </node>
      <node id="25833">
        <label>cstdlib</label>
      </node>
      <node id="25824">
        <label>iostream</label>
      </node>
      <node id="25913">
        <label>options.h</label>
        <link refid="options_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25914" relation="include">
        </childnode>
      </node>
      <node id="25922">
        <label>unit/selection.h</label>
        <link refid="selection_8h"/>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25882" relation="include">
        </childnode>
        <childnode refid="25890" relation="include">
        </childnode>
        <childnode refid="25923" relation="include">
        </childnode>
        <childnode refid="25926" relation="include">
        </childnode>
      </node>
      <node id="25903">
        <label>job.h</label>
        <link refid="job_8h"/>
        <childnode refid="25898" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25897" relation="include">
        </childnode>
      </node>
      <node id="25938">
        <label>shader/shader.h</label>
        <link refid="shader_2shader_8h"/>
        <childnode refid="25813" relation="include">
        </childnode>
        <childnode refid="25935" relation="include">
        </childnode>
      </node>
      <node id="25943">
        <label>../datastructure/pairing_heap.h</label>
        <link refid="pairing__heap_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25836" relation="include">
        </childnode>
        <childnode refid="25910" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
        <childnode refid="25860" relation="include">
        </childnode>
      </node>
      <node id="25818">
        <label>unordered_map</label>
      </node>
      <node id="25905">
        <label>job_state.h</label>
        <link refid="job__state_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25897" relation="include">
        </childnode>
        <childnode refid="25902" relation="include">
        </childnode>
      </node>
      <node id="25947">
        <label>unit.h</label>
        <link refid="unit_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25845" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25893" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25890" relation="include">
        </childnode>
        <childnode refid="25948" relation="include">
        </childnode>
        <childnode refid="25939" relation="include">
        </childnode>
        <childnode refid="25918" relation="include">
        </childnode>
        <childnode refid="25923" relation="include">
        </childnode>
        <childnode refid="25944" relation="include">
        </childnode>
        <childnode refid="25949" relation="include">
        </childnode>
        <childnode refid="25950" relation="include">
        </childnode>
        <childnode refid="25926" relation="include">
        </childnode>
      </node>
      <node id="25857">
        <label>functional.h</label>
        <link refid="functional_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25845" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
        <childnode refid="25858" relation="include">
        </childnode>
        <childnode refid="25859" relation="include">
        </childnode>
        <childnode refid="25862" relation="include">
        </childnode>
      </node>
      <node id="25878">
        <label>climits</label>
      </node>
      <node id="25944">
        <label>attribute.h</label>
        <link refid="attribute_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25945" relation="include">
        </childnode>
        <childnode refid="25872" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
        <childnode refid="25929" relation="include">
        </childnode>
        <childnode refid="25939" relation="include">
        </childnode>
        <childnode refid="25925" relation="include">
        </childnode>
        <childnode refid="25926" relation="include">
        </childnode>
      </node>
      <node id="25845">
        <label>mutex</label>
      </node>
      <node id="25921">
        <label>chrono</label>
      </node>
      <node id="25933">
        <label>../coord/chunk.h</label>
        <link refid="chunk_8h"/>
        <childnode refid="25876" relation="include">
        </childnode>
        <childnode refid="25880" relation="include">
        </childnode>
        <childnode refid="25881" relation="include">
        </childnode>
      </node>
      <node id="25899">
        <label>../util/thread_id.h</label>
        <link refid="thread__id_8h"/>
        <childnode refid="25900" relation="include">
        </childnode>
      </node>
      <node id="25894">
        <label>thread</label>
      </node>
      <node id="25854">
        <label>../util/path.h</label>
        <link refid="util_2path_8h"/>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25855" relation="include">
        </childnode>
        <childnode refid="25863" relation="include">
        </childnode>
        <childnode refid="25865" relation="include">
        </childnode>
      </node>
      <node id="25961">
        <label>unit_type.h</label>
        <link refid="unit__type_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25962" relation="include">
        </childnode>
        <childnode refid="25949" relation="include">
        </childnode>
      </node>
      <node id="25909">
        <label>event.h</label>
        <link refid="input_2event_8h"/>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25910" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
        <childnode refid="25817" relation="include">
        </childnode>
      </node>
      <node id="25884">
        <label>tile.h</label>
        <link refid="tile_8h"/>
        <childnode refid="25876" relation="include">
        </childnode>
        <childnode refid="25880" relation="include">
        </childnode>
        <childnode refid="25881" relation="include">
        </childnode>
        <childnode refid="25871" relation="include">
        </childnode>
      </node>
      <node id="25856">
        <label>defs.h</label>
        <link refid="defs_8h"/>
      </node>
      <node id="25959">
        <label>population_tracker.h</label>
        <link refid="population__tracker_8h"/>
      </node>
      <node id="25919">
        <label>util/profiler.h</label>
        <link refid="profiler_8h"/>
        <childnode refid="25920" relation="include">
        </childnode>
        <childnode refid="25921" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25828" relation="include">
        </childnode>
      </node>
      <node id="25836">
        <label>type_traits</label>
      </node>
      <node id="25931">
        <label>set</label>
      </node>
      <node id="25831">
        <label>config.h</label>
      </node>
      <node id="25868">
        <label>loader_policy.h</label>
        <link refid="loader__policy_8h"/>
        <childnode refid="25867" relation="include">
        </childnode>
      </node>
      <node id="25872">
        <label>algorithm</label>
      </node>
      <node id="25901">
        <label>job_state_base.h</label>
        <link refid="job__state__base_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25902" relation="include">
        </childnode>
      </node>
      <node id="25870">
        <label>phys.h</label>
        <link refid="phys_8h"/>
        <childnode refid="25871" relation="include">
        </childnode>
        <childnode refid="25876" relation="include">
        </childnode>
        <childnode refid="25880" relation="include">
        </childnode>
        <childnode refid="25881" relation="include">
        </childnode>
      </node>
      <node id="25962">
        <label>../gamestate/cost.h</label>
        <link refid="cost_8h"/>
        <childnode refid="25925" relation="include">
        </childnode>
      </node>
      <node id="25875">
        <label>cstring</label>
      </node>
      <node id="25953">
        <label>../gamedata/graphic.gen.h</label>
      </node>
      <node id="25846">
        <label>log/file_logsink.h</label>
        <link refid="file__logsink_8h"/>
        <childnode refid="25824" relation="include">
        </childnode>
        <childnode refid="25847" relation="include">
        </childnode>
        <childnode refid="25843" relation="include">
        </childnode>
      </node>
      <node id="25930">
        <label>../terrain/terrain.h</label>
        <link refid="terrain_8h"/>
        <childnode refid="25840" relation="include">
        </childnode>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25900" relation="include">
        </childnode>
        <childnode refid="25931" relation="include">
        </childnode>
        <childnode refid="25818" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25932" relation="include">
        </childnode>
        <childnode refid="25933" relation="include">
        </childnode>
        <childnode refid="25870" relation="include">
        </childnode>
        <childnode refid="25882" relation="include">
        </childnode>
        <childnode refid="25884" relation="include">
        </childnode>
        <childnode refid="25934" relation="include">
        </childnode>
        <childnode refid="25871" relation="include">
        </childnode>
      </node>
      <node id="25917">
        <label>timer.h</label>
        <link refid="timer_8h"/>
        <childnode refid="25815" relation="include">
        </childnode>
        <childnode refid="25918" relation="include">
        </childnode>
      </node>
      <node id="25816">
        <label>memory</label>
      </node>
      <node id="25941">
        <label>action.h</label>
        <link refid="unit_2action_8h"/>
        <childnode refid="25816" relation="include">
        </childnode>
        <childnode refid="25819" relation="include">
        </childnode>
        <childnode refid="25942" relation="include">
        </childnode>
        <childnode refid="25925" relation="include">
        </childnode>
        <childnode refid="25944" relation="include">
        </childnode>
        <childnode refid="25946" relation="include">
        </childnode>
        <childnode refid="25947" relation="include">
        </childnode>
        <childnode refid="25926" relation="include">
        </childnode>
      </node>
      <node id="25813">
        <label>initializer_list</label>
      </node>
      <node id="25916">
        <label>util/fps.h</label>
        <link refid="fps_8h"/>
        <childnode refid="25917" relation="include">
        </childnode>
      </node>
      <node id="25823">
        <label>../util/enum.h</label>
        <link refid="enum_8h"/>
        <childnode refid="25824" relation="include">
        </childnode>
        <childnode refid="25825" relation="include">
        </childnode>
        <childnode refid="25826" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <innernamespace refid="namespaceopenage">openage</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Many values in this file are hardcoded, due to limited understanding of how the original game files work <ndash/> as more becomes known these will be removed.</para>
<para>It is likely the conversion from gamedata to openage units will be done by the nyan system in future </para>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>2014-2018<sp/>the<sp/>openage<sp/>authors.<sp/>See<sp/>copying.md<sp/>for<sp/>legal<sp/>info.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;initializer_list&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../engine.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../log/log.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../gamedata/unit.gen.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../terrain/terrain.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../terrain/terrain_object.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../terrain/terrain_outline.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../util/strings.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ability_8h" kindref="compound">ability.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="unit_2action_8h" kindref="compound">action.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="producer_8h" kindref="compound">producer.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="unit_8h" kindref="compound">unit.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="unit__texture_8h" kindref="compound">unit_texture.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="namespaceopenage" kindref="compound">openage</ref><sp/>{</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28" refid="namespaceopenage_1a012c2c0bdd9534a3d648ada6c608ebf2" refkind="member"><highlight class="normal">std::unordered_set&lt;terrain_t&gt;<sp/><ref refid="namespaceopenage_1a012c2c0bdd9534a3d648ada6c608ebf2" kindref="member">allowed_terrains</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>gamedata::ground_type<sp/>&amp;restriction)<sp/>{</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>returns<sp/>a<sp/>terrain<sp/>whitelist<sp/>for<sp/>a<sp/>given<sp/>restriction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>you<sp/>can<sp/>also<sp/>define<sp/>a<sp/>blacklist<sp/>for<sp/>brevity,<sp/>it<sp/>will<sp/>be<sp/>converted<sp/>and<sp/>returned</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/>std::unordered_set&lt;terrain_t&gt;<sp/>whitelist;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/>std::unordered_set&lt;terrain_t&gt;<sp/>blacklist;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1,<sp/>14,<sp/>and<sp/>15<sp/>are<sp/>water,<sp/>2<sp/>is<sp/>shore</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(restriction<sp/>==<sp/>gamedata::ground_type::WATER<sp/>||</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>restriction<sp/>==<sp/>gamedata::ground_type::WATER_0x0D<sp/>||</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>restriction<sp/>==<sp/>gamedata::ground_type::WATER_SHIP_0x03<sp/>||</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>restriction<sp/>==<sp/>gamedata::ground_type::WATER_SHIP_0x0F)<sp/>{</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>whitelist.insert(1);<sp/></highlight><highlight class="comment">//<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>whitelist.insert(2);<sp/></highlight><highlight class="comment">//<sp/>shore</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>whitelist.insert(4);<sp/></highlight><highlight class="comment">//<sp/>shallows</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>whitelist.insert(14);<sp/></highlight><highlight class="comment">//<sp/>medium<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>whitelist.insert(15);<sp/></highlight><highlight class="comment">//<sp/>deep<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(restriction<sp/>==<sp/>gamedata::ground_type::SOLID)<sp/>{</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(1);<sp/></highlight><highlight class="comment">//<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(4);<sp/></highlight><highlight class="comment">//<sp/>shallows</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(14);<sp/></highlight><highlight class="comment">//<sp/>medium<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(15);<sp/></highlight><highlight class="comment">//<sp/>deep<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(restriction<sp/>==<sp/>gamedata::ground_type::FOUNDATION<sp/>||</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>restriction<sp/>==<sp/>gamedata::ground_type::NO_ICE_0x08<sp/>||</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>restriction<sp/>==<sp/>gamedata::ground_type::FOREST)<sp/>{</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(1);<sp/></highlight><highlight class="comment">//<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(4);<sp/></highlight><highlight class="comment">//<sp/>shallows</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(14);<sp/></highlight><highlight class="comment">//<sp/>medium<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(15);<sp/></highlight><highlight class="comment">//<sp/>deep<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(18);<sp/></highlight><highlight class="comment">//<sp/>ice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(warn)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;undefined<sp/>terrain<sp/>restriction,<sp/>assuming<sp/>solid&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(1);<sp/></highlight><highlight class="comment">//<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(4);<sp/></highlight><highlight class="comment">//<sp/>shallows</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(14);<sp/></highlight><highlight class="comment">//<sp/>medium<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blacklist.insert(15);<sp/></highlight><highlight class="comment">//<sp/>deep<sp/>water</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we&apos;re<sp/>using<sp/>a<sp/>blacklist,<sp/>fill<sp/>out<sp/>a<sp/>whitelist<sp/>with<sp/>everything<sp/>not<sp/>on<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(blacklist.size()<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>all<sp/>terrains<sp/>that<sp/>are<sp/>not<sp/>on<sp/>blacklist</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>32;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(blacklist.count(i)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>whitelist.insert(i);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>whitelist;</highlight></codeline>
<codeline lineno="81"><highlight class="normal">}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83" refid="namespaceopenage_1a51da621433dabf064cd41efc49641d51" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_resource_bundle" kindref="compound">ResourceBundle</ref><sp/><ref refid="namespaceopenage_1a51da621433dabf064cd41efc49641d51" kindref="member">create_resource_cost</ref>(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328d" kindref="member">game_resource</ref><sp/>resource,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>amount)<sp/>{</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_resource_bundle" kindref="compound">ResourceBundle</ref><sp/>resources<sp/>=<sp/><ref refid="classopenage_1_1_resource_bundle" kindref="compound">ResourceBundle</ref>();</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>resources[<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">resource</ref>]<sp/>=<sp/>amount;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>resources;</highlight></codeline>
<codeline lineno="87"><highlight class="normal">}</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89" refid="classopenage_1_1_object_producer_1ac48ac7bb1028265411af4f2b34f6ddf7" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_object_producer_1ac48ac7bb1028265411af4f2b34f6ddf7" kindref="member">ObjectProducer::ObjectProducer</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;owner,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_spec" kindref="compound">GameSpec</ref><sp/>&amp;spec,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>gamedata::unit_object<sp/>*ud)</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_type" kindref="compound">UnitType</ref>(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>),</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>dataspec(spec),</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_data(*ud),</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>terrain_outline{</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>default_tex{spec.get_unit_texture(ud-&gt;graphic_standing0)},</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>dead_unit_id{ud-&gt;dead_unit_id}<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>copy<sp/>the<sp/>class<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;unit_class<sp/>=<sp/>this-&gt;unit_data.<ref refid="classopenage_1_1_unit_type_1a8f429cad1b7e5c9daedf836bdc8cd1a7" kindref="member">unit_class</ref>;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>now<sp/>just<sp/>look<sp/>for<sp/>type<sp/>names<sp/>ending<sp/>with<sp/>&quot;_D&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba63faabca234a29640f3344e74c0672da" kindref="member">decay</ref><sp/>=<sp/>unit_data.name.substr(unit_data.name.length()<sp/>-<sp/>2)<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;_D&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>suitable<sp/>sounds</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>creation_sound<sp/>=<sp/>this-&gt;unit_data.train_sound;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>dying_sound<sp/>=<sp/>this-&gt;unit_data.sound_dying;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(creation_sound<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>creation_sound<sp/>=<sp/>this-&gt;unit_data.damage_sound;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(creation_sound<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>creation_sound<sp/>=<sp/>this-&gt;unit_data.sound_selection;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dying_sound<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dying_sound<sp/>=<sp/>323;<sp/></highlight><highlight class="comment">//generic<sp/>explosion<sp/>sound</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>on_create<sp/>=<sp/>spec.get_sound(creation_sound);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>on_destroy<sp/>=<sp/>spec.get_sound(dying_sound);</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>convert<sp/>the<sp/>float<sp/>to<sp/>the<sp/>discrete<sp/>foundation<sp/>size...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;foundation_size<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>static_cast&lt;int&gt;(this-&gt;unit_data.radius_x<sp/>*<sp/>2),</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>static_cast&lt;int&gt;(this-&gt;unit_data.radius_y<sp/>*<sp/>2),</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>shape<sp/>of<sp/>the<sp/>outline</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;unit_data.selection_shape<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;terrain_outline<sp/>=<sp/><ref refid="namespaceopenage_1ae2e68c0049a3b6c5671c8006c6a74f84" kindref="member">radial_outline</ref>(this-&gt;unit_data.radius_x);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;terrain_outline<sp/>=<sp/><ref refid="namespaceopenage_1a8f7c4c46ae7b03cd0cc8ceae47ae7139" kindref="member">square_outline</ref>(this-&gt;foundation_size);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>graphic<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">standing</ref><sp/>=<sp/>spec.get_unit_texture(this-&gt;unit_data.graphic_standing0);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!standing)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>indicates<sp/>problems<sp/>with<sp/>data<sp/>converion</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>Error(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(err)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Unit<sp/>id<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>this-&gt;unit_data.id0</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>has<sp/>invalid<sp/>graphic<sp/>data,<sp/>try<sp/>reconverting<sp/>the<sp/>data&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>]<sp/>=<sp/><ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">standing</ref>;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>dying_tex<sp/>=<sp/>spec.get_unit_texture(this-&gt;unit_data.dying_graphic);</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dying_tex)<sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba564202d4005974a8279609ef0f95d43b" kindref="member">graphic_type::dying</ref>]<sp/>=<sp/>dying_tex;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>extra<sp/>graphics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bafc7e987f23de5bd6562b7c0063cad659" kindref="member">graphic_type::attack</ref>]<sp/>=<sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>];</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba67e92c8765a9bc7fb2d335c459de9eb5" kindref="member">graphic_type::work</ref>]<sp/>=<sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>];</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>pull<sp/>extra<sp/>graphics<sp/>from<sp/>unit<sp/>commands</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>cmds<sp/>=<sp/>spec.get_command_data(this-&gt;unit_data.id0);</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>cmd<sp/>:<sp/>cmds)<sp/>{</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>same<sp/>attack<sp/>/<sp/>work<sp/>graphic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cmd-&gt;work_sprite_id<sp/>==<sp/>-1<sp/>&amp;&amp;<sp/>cmd-&gt;proceed_sprite_id<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>task<sp/>=<sp/>spec.get_unit_texture(cmd-&gt;proceed_sprite_id);</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(task)<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba67e92c8765a9bc7fb2d335c459de9eb5" kindref="member">graphic_type::work</ref>]<sp/>=<sp/>task;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bafc7e987f23de5bd6562b7c0063cad659" kindref="member">graphic_type::attack</ref>]<sp/>=<sp/>task;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>separate<sp/>work<sp/>and<sp/>attack<sp/>graphics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cmd-&gt;work_sprite_id<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>cmd-&gt;proceed_sprite_id<sp/>&gt;<sp/>0<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">attack</ref><sp/>=<sp/>spec.get_unit_texture(cmd-&gt;proceed_sprite_id);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba67e92c8765a9bc7fb2d335c459de9eb5" kindref="member">work</ref><sp/>=<sp/>spec.get_unit_texture(cmd-&gt;work_sprite_id);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attack)<sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bafc7e987f23de5bd6562b7c0063cad659" kindref="member">graphic_type::attack</ref>]<sp/>=<sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">attack</ref>;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(work)<sp/>{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba67e92c8765a9bc7fb2d335c459de9eb5" kindref="member">graphic_type::work</ref>]<sp/>=<sp/><ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba67e92c8765a9bc7fb2d335c459de9eb5" kindref="member">work</ref>;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>villager<sp/>carrying<sp/>resources<sp/>graphics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cmd-&gt;carry_sprite_id<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>carry<sp/>=<sp/>spec.get_unit_texture(cmd-&gt;carry_sprite_id);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baa771e1fd1a582e9cf05f5213586f1965" kindref="member">graphic_type::carrying</ref>]<sp/>=<sp/>carry;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>get<sp/>cost,<sp/>temp<sp/>fixed<sp/>cost<sp/>of<sp/>50<sp/>food</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;cost.set(<ref refid="namespaceopenage_1abda3971a8397f9204b2ad873b645251ca617ac08757d38a5a7ed91c224f0e90a0" kindref="member">cost_type::constant</ref>,<sp/><ref refid="namespaceopenage_1a51da621433dabf064cd41efc49641d51" kindref="member">create_resource_cost</ref>(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref>,<sp/>50));</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal">}</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188" refid="classopenage_1_1_object_producer_1ab29ad5d532bf09e463761c7997f04e33" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_object_producer_1ab29ad5d532bf09e463761c7997f04e33" kindref="member">ObjectProducer::~ObjectProducer</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190" refid="classopenage_1_1_object_producer_1a66b6b1d9646e72d79338e2db10c9bc1c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_object_producer_1a66b6b1d9646e72d79338e2db10c9bc1c" kindref="member">ObjectProducer::id</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.id0;</highlight></codeline>
<codeline lineno="192"><highlight class="normal">}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194" refid="classopenage_1_1_object_producer_1af27e32c01dc789879de5207b39ebf405" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_object_producer_1af27e32c01dc789879de5207b39ebf405" kindref="member">ObjectProducer::parent_id</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>uid<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.id0;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>male<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(uid<sp/>==<sp/>156<sp/>||<sp/>uid<sp/>==<sp/>120<sp/>||<sp/>uid<sp/>==<sp/>592<sp/>||<sp/>uid<sp/>==<sp/>123<sp/>||<sp/>uid<sp/>==<sp/>579<sp/>||<sp/>uid<sp/>==<sp/>124)<sp/>{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>83;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>female<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(uid<sp/>==<sp/>222<sp/>||<sp/>uid<sp/>==<sp/>354<sp/>||<sp/>uid<sp/>==<sp/>590<sp/>||<sp/>uid<sp/>==<sp/>218<sp/>||<sp/>uid<sp/>==<sp/>581<sp/>||<sp/>uid<sp/>==<sp/>220)<sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>293;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>uid;</highlight></codeline>
<codeline lineno="207"><highlight class="normal">}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209" refid="classopenage_1_1_object_producer_1a117c84d489aab55d5bf5e91915f1fe65" refkind="member"><highlight class="normal">std::string<sp/><ref refid="classopenage_1_1_object_producer_1a117c84d489aab55d5bf5e91915f1fe65" kindref="member">ObjectProducer::name</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.name;</highlight></codeline>
<codeline lineno="211"><highlight class="normal">}</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213" refid="classopenage_1_1_object_producer_1aee34f7883059625ffd3fb4bd5a43371f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_object_producer_1aee34f7883059625ffd3fb4bd5a43371f" kindref="member">ObjectProducer::initialise</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*unit,<sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;player)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref><sp/>==<sp/>player,<sp/></highlight><highlight class="stringliteral">&quot;unit<sp/>init<sp/>from<sp/>a<sp/>UnitType<sp/>of<sp/>a<sp/>wrong<sp/>player<sp/>which<sp/>breaks<sp/>tech<sp/>levels&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>log<sp/>attributes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(dbg)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;setting<sp/>unit<sp/>type<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.id0<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;unit_data.name);</highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>reset<sp/>existing<sp/>attributes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a24ad46b827d50be1c5af4eccc5111929" kindref="member">reset</ref>();</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>initialise<sp/>unit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a2d7da7c7ccd95557e10d54a58a033187" kindref="member">unit_type</ref><sp/>=<sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>colour</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1owner_01_4" kindref="compound">Attribute&lt;attr_type::owner&gt;</ref>&gt;(player));</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>hitpoints<sp/>if<sp/>available</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.hit_points<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1hitpoints_01_4" kindref="compound">Attribute&lt;attr_type::hitpoints&gt;</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.hit_points));</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1damaged_01_4" kindref="compound">Attribute&lt;attr_type::damaged&gt;</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.hit_points));</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>collectable<sp/>resources</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::TREES)<sp/>{</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da22811dd94d65037ef86535740b98dec8" kindref="member">game_resource::wood</ref>,<sp/>125));</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::BERRY_BUSH)<sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref>,<sp/>100));</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::SEA_FISH)<sp/>{</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref>,<sp/>200));</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::PREY_ANIMAL)<sp/>{</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref>,<sp/>140));</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::SHEEP)<sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref>,<sp/>100,<sp/>0.1));</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::GOLD_MINE)<sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328dae07e81c20cf5935f5225765f0af81755" kindref="member">game_resource::gold</ref>,<sp/>800));</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::STONE_MINE)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da0a840ef45467fb3932dbf2c2896c5cbf" kindref="member">game_resource::stone</ref>,<sp/>350));</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>decaying<sp/>units<sp/>have<sp/>a<sp/>timed<sp/>lifespan</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classopenage_1_1_object_producer_1a7dcbafb4d73948b8efb7db71260ac01c" kindref="member">decay</ref>)<sp/>{</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1aecd686fafc67487f4df4d3637f2621f4" kindref="member">push_action</ref>(std::make_unique&lt;DecayAction&gt;(unit),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>destruction<sp/>graphic<sp/>is<sp/>available</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1aafb76a99049cc691cd33fe647ba5b8d5" kindref="member">dead_unit_id</ref>)<sp/>{</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1aecd686fafc67487f4df4d3637f2621f4" kindref="member">push_action</ref>(</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::make_unique&lt;DeadAction&gt;(</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit,</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>unit,<sp/>&amp;player]()<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>modify<sp/>unit<sp/>to<sp/>have<sp/><sp/>dead<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_type" kindref="compound">UnitType</ref><sp/>*t<sp/>=<sp/>player.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(this-&gt;<ref refid="classopenage_1_1_object_producer_1aafb76a99049cc691cd33fe647ba5b8d5" kindref="member">dead_unit_id</ref>);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(t)<sp/>{</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>t-&gt;<ref refid="classopenage_1_1_unit_type_1a810c763e421cd95a9c64ab4c3e351140" kindref="member">initialise</ref>(unit,<sp/>player);</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_unit_type_1aaf36044630d13a601a4245e34419df90" kindref="member">graphics</ref>.count(<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba564202d4005974a8279609ef0f95d43b" kindref="member">graphic_type::dying</ref>)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1aecd686fafc67487f4df4d3637f2621f4" kindref="member">push_action</ref>(std::make_unique&lt;DeadAction&gt;(unit),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>default<sp/>action</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1aecd686fafc67487f4df4d3637f2621f4" kindref="member">push_action</ref>(std::make_unique&lt;IdleAction&gt;(unit),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>give<sp/>required<sp/>abilitys</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;a<sp/>:<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a1585d5b6235d2d90cf2de4736f1a7e54" kindref="member">type_abilities</ref>)<sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(a);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="292"><highlight class="normal">}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294" refid="classopenage_1_1_object_producer_1a6063c50f0e551a3a5a1a4c08f555bf0e" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*<ref refid="classopenage_1_1_object_producer_1a6063c50f0e551a3a5a1a4c08f555bf0e" kindref="member">ObjectProducer::place</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u,<sp/>std::shared_ptr&lt;Terrain&gt;<sp/>terrain,<sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>init_pos)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>new<sp/>object<sp/>with<sp/>correct<sp/>base<sp/>shape</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.selection_shape<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a76a10b9ab26e62d7b712a6c796052ee3" kindref="member">make_location</ref>&lt;<ref refid="classopenage_1_1_radial_object" kindref="compound">RadialObject</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.radius_x,<sp/>this-&gt;<ref refid="classopenage_1_1_object_producer_1aa508e7a9e264606b26676c76b5946e95" kindref="member">terrain_outline</ref>);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a76a10b9ab26e62d7b712a6c796052ee3" kindref="member">make_location</ref>&lt;<ref refid="classopenage_1_1_square_object" kindref="compound">SquareObject</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_unit_type_1a6cb4b86a37f31b2994d197f43da03ab5" kindref="member">foundation_size</ref>,<sp/>this-&gt;<ref refid="classopenage_1_1_object_producer_1aa508e7a9e264606b26676c76b5946e95" kindref="member">terrain_outline</ref>);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>set<sp/>of<sp/>allowed<sp/>terrains</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/>std::unordered_set&lt;terrain_t&gt;<sp/>terrains<sp/>=<sp/><ref refid="namespaceopenage_1a012c2c0bdd9534a3d648ada6c608ebf2" kindref="member">allowed_terrains</ref>(this-&gt;<ref refid="classopenage_1_1_object_producer_1a78e78cafc675a2ea42f7464a2b670313" kindref="member">unit_data</ref>.terrain_restriction);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="308"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>decide<sp/>what<sp/>terrain<sp/>is<sp/>passable<sp/>using<sp/>this<sp/>lambda</highlight></codeline>
<codeline lineno="309"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>currently<sp/>unit<sp/>avoids<sp/>water<sp/>and<sp/>tiles<sp/>with<sp/>another<sp/>unit</highlight></codeline>
<codeline lineno="310"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>this<sp/>function<sp/>should<sp/>be<sp/>true<sp/>if<sp/>pos<sp/>is<sp/>a<sp/>valid<sp/>position<sp/>of<sp/>the<sp/>object</highlight></codeline>
<codeline lineno="311"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*obj_ptr<sp/>=<sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get();</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/>std::weak_ptr&lt;Terrain&gt;<sp/>terrain_ptr<sp/>=<sp/>terrain;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;passable<sp/>=<sp/>[obj_ptr,<sp/>terrain_ptr,<sp/>terrains](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;pos)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>location<sp/>is<sp/>deleted,<sp/>then<sp/>so<sp/>is<sp/>this<sp/>lambda<sp/>(deleting<sp/>terrain<sp/>implies<sp/>location<sp/>is<sp/>deleted)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>locking<sp/>objects<sp/>here<sp/>will<sp/>not<sp/>return<sp/>null</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>terrain<sp/>=<sp/>terrain_ptr.lock();</highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>look<sp/>at<sp/>all<sp/>tiles<sp/>in<sp/>the<sp/>bases<sp/>range</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>check_pos<sp/>:<sp/><ref refid="namespaceopenage_1a3a0d4d7c2bc234c442c13758d306f60c" kindref="member">tile_list</ref>(obj_ptr-&gt;<ref refid="classopenage_1_1_terrain_object_1a1fc44d40095260aca43dd9582c61de97" kindref="member">get_range</ref>(pos,<sp/>*terrain)))<sp/>{</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*tc<sp/>=<sp/>terrain-&gt;get_data(check_pos);</highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>invalid<sp/>tile<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tc<sp/>||<sp/>terrains.count(tc-&gt;<ref refid="classopenage_1_1_tile_content_1ac370821023f0c2e78ef4ab0c27c7bf09" kindref="member">terrain_id</ref>)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>compare<sp/>with<sp/>objects<sp/>intersecting<sp/>the<sp/>units<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ensure<sp/>no<sp/>intersections<sp/>with<sp/>other<sp/>objects</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>obj_cmp<sp/>:<sp/>tc-&gt;<ref refid="classopenage_1_1_tile_content_1aaeff054a61d61cc0c65cfefcc78de233" kindref="member">obj</ref>)<sp/>{</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(obj_ptr<sp/>!=<sp/>obj_cmp<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj_cmp-&gt;<ref refid="classopenage_1_1_terrain_object_1a9ca18bc39c074f2172f12b4903ba0bb0" kindref="member">check_collisions</ref>()<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj_ptr-&gt;<ref refid="classopenage_1_1_terrain_object_1ac5837451def43e3c3774e1ea1ba64d02" kindref="member">intersects</ref>(*obj_cmp,<sp/>pos))<sp/>{</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;draw<sp/>=<sp/>[u,<sp/>obj_ptr](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>&amp;e)<sp/>{</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(u-&gt;<ref refid="classopenage_1_1_unit_1a00fd6387097ed12ae6f6b6ec2ab2939e" kindref="member">selected</ref>)<sp/>{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj_ptr-&gt;<ref refid="classopenage_1_1_terrain_object_1a95d5633a7448be10a5e6274351aac959" kindref="member">draw_outline</ref>(e.coord);</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1ae422123ecc6a2e930ba86e45bf8a5a37" kindref="member">draw</ref>(e);</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>try<sp/>to<sp/>place<sp/>the<sp/>obj,<sp/>it<sp/>knows<sp/>best<sp/>whether<sp/>it<sp/>will<sp/>fit.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>state<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_object_producer_1a7dcbafb4d73948b8efb7db71260ac01c" kindref="member">decay</ref>?<sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465eac693ee9f8e776555e9625dd624ad5fa3" kindref="member">object_state::placed_no_collision</ref><sp/>:<sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465ea6ebb25b39f65cab5efa469977b9479e2" kindref="member">object_state::placed</ref>;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;place(terrain,<sp/>init_pos,<sp/>state))<sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1ac753c019451a2908913e26dda7ed87b2" kindref="member">on_create</ref>)<sp/>{</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_object_producer_1ac753c019451a2908913e26dda7ed87b2" kindref="member">on_create</ref>-&gt;<ref refid="classopenage_1_1_sound_1a526acd600cd69f6f421a253fc169398b" kindref="member">play</ref>();</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get();</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>placing<sp/>at<sp/>the<sp/>given<sp/>position<sp/>failed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(dbg)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>place<sp/>object&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="361"><highlight class="normal">}</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363" refid="classopenage_1_1_movable_producer_1ad4f66cd3cb729ceb9c15d7d9f8e00764" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_movable_producer_1ad4f66cd3cb729ceb9c15d7d9f8e00764" kindref="member">MovableProducer::MovableProducer</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;owner,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_spec" kindref="compound">GameSpec</ref><sp/>&amp;spec,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>gamedata::projectile_unit<sp/>*um)</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_object_producer" kindref="compound">ObjectProducer</ref>(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>,<sp/>spec,<sp/>um),</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_data(*um),</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/>on_move{spec.<ref refid="classopenage_1_1_game_spec_1a1b83c8dcc455fd32056c418a993eb506" kindref="member">get_sound</ref>(this-&gt;<ref refid="classopenage_1_1_movable_producer_1aa6f827a9be53bf8945202bdec83c0e5b" kindref="member">unit_data</ref>.command_sound_id)},</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/>on_attack{spec.get_sound(this-&gt;unit_data.command_sound_id)},</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/>projectile{this-&gt;unit_data.missile_unit_id}<sp/>{</highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>extra<sp/>graphics<sp/>if<sp/>available</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>villagers<sp/>have<sp/>invalid<sp/>attack<sp/>and<sp/>walk<sp/>graphics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>seems<sp/>these<sp/>come<sp/>from<sp/>the<sp/>command<sp/>data<sp/>instead</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>walk<sp/>=<sp/>spec.get_unit_texture(this-&gt;unit_data.walking_graphics0);</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!walk)<sp/>{</highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>use<sp/>standing<sp/>instead</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>walk<sp/>=<sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>];</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba099410f601830a2873dd98ea0acf711d" kindref="member">graphic_type::walking</ref>]<sp/>=<sp/>walk;</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>reuse<sp/>as<sp/>carry<sp/>graphic<sp/>if<sp/>not<sp/>already<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;graphics.count(<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baa771e1fd1a582e9cf05f5213586f1965" kindref="member">graphic_type::carrying</ref>)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baa771e1fd1a582e9cf05f5213586f1965" kindref="member">graphic_type::carrying</ref>]<sp/>=<sp/>walk;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">attack</ref><sp/>=<sp/>spec.get_unit_texture(this-&gt;unit_data.fight_sprite_id);</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(attack<sp/>&amp;&amp;<sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">attack</ref>-&gt;is_valid())<sp/>{</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bafc7e987f23de5bd6562b7c0063cad659" kindref="member">graphic_type::attack</ref>]<sp/>=<sp/><ref refid="namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">attack</ref>;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>extra<sp/>abilities</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;type_abilities.emplace_back(std::make_shared&lt;MoveAbility&gt;(this-&gt;on_move));</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;type_abilities.emplace_back(std::make_shared&lt;AttackAbility&gt;(this-&gt;on_attack));</highlight></codeline>
<codeline lineno="395"><highlight class="normal">}</highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight></codeline>
<codeline lineno="397" refid="classopenage_1_1_movable_producer_1aa25aab6e944220e9d882f94eee7a966d" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_movable_producer_1aa25aab6e944220e9d882f94eee7a966d" kindref="member">MovableProducer::~MovableProducer</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"></highlight></codeline>
<codeline lineno="399" refid="classopenage_1_1_movable_producer_1a3fc2ee02406d37a4106d51fee9d3c1c0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_movable_producer_1a3fc2ee02406d37a4106d51fee9d3c1c0" kindref="member">MovableProducer::initialise</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*unit,<sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;player)<sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="402"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>call<sp/>base<sp/>function</highlight></codeline>
<codeline lineno="403"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_object_producer_1aee34f7883059625ffd3fb4bd5a43371f" kindref="member">ObjectProducer::initialise</ref>(unit,<sp/>player);</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="407"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>basic<sp/>attributes</highlight></codeline>
<codeline lineno="408"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!unit-&gt;<ref refid="classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36aef72c37be9d1b9e6e5bbd6ef09448abe" kindref="member">attr_type::direction</ref>))<sp/>{</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1direction_01_4" kindref="compound">Attribute&lt;attr_type::direction&gt;</ref>&gt;(<ref refid="structopenage_1_1coord_1_1phys3__delta" kindref="compound">coord::phys3_delta</ref>{<sp/>1,<sp/>0,<sp/>0<sp/>}));</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="414"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>distance<sp/>per<sp/>millisecond<sp/>--<sp/>consider<sp/>original<sp/>game<sp/>speed</highlight></codeline>
<codeline lineno="415"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>where<sp/>1.5<sp/>in<sp/>game<sp/>seconds<sp/>pass<sp/>in<sp/>1<sp/>real<sp/>second</highlight></codeline>
<codeline lineno="416"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>sp<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_movable_producer_1aa6f827a9be53bf8945202bdec83c0e5b" kindref="member">unit_data</ref>.speed<sp/>/<sp/>666;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1speed_01_4" kindref="compound">Attribute&lt;attr_type::speed&gt;</ref>&gt;(sp));</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>projectile<sp/>of<sp/>melee<sp/>attacks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_type" kindref="compound">UnitType</ref><sp/>*proj_type<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(this-&gt;<ref refid="classopenage_1_1_movable_producer_1afcb26ef8a79336668528088fee8ec2e9" kindref="member">projectile</ref>);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_movable_producer_1aa6f827a9be53bf8945202bdec83c0e5b" kindref="member">unit_data</ref>.missile_unit_id<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>proj_type)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>calculate<sp/>requirements<sp/>for<sp/>ranged<sp/>attacks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>range_phys<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_movable_producer_1aa6f827a9be53bf8945202bdec83c0e5b" kindref="member">unit_data</ref>.weapon_range_max;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1attack_01_4" kindref="compound">Attribute&lt;attr_type::attack&gt;</ref>&gt;(proj_type,<sp/>range_phys,<sp/>48000,<sp/>1));</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1attack_01_4" kindref="compound">Attribute&lt;attr_type::attack&gt;</ref>&gt;(</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>0,<sp/>0,<sp/>1));</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1formation_01_4" kindref="compound">Attribute&lt;attr_type::formation&gt;</ref>&gt;());</highlight></codeline>
<codeline lineno="432"><highlight class="normal">}</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight></codeline>
<codeline lineno="434" refid="classopenage_1_1_movable_producer_1ace952d53d7717d9db843391f49fbf76b" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*<ref refid="classopenage_1_1_movable_producer_1ace952d53d7717d9db843391f49fbf76b" kindref="member">MovableProducer::place</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*unit,<sp/>std::shared_ptr&lt;Terrain&gt;<sp/>terrain,<sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>init_pos)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_object_producer_1a6063c50f0e551a3a5a1a4c08f555bf0e" kindref="member">ObjectProducer::place</ref>(unit,<sp/>terrain,<sp/>init_pos);</highlight></codeline>
<codeline lineno="436"><highlight class="normal">}</highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438" refid="classopenage_1_1_living_producer_1aecea48fcba32740492d9ca55dfdb594c" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_living_producer_1aecea48fcba32740492d9ca55dfdb594c" kindref="member">LivingProducer::LivingProducer</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;owner,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_spec" kindref="compound">GameSpec</ref><sp/>&amp;spec,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>gamedata::living_unit<sp/>*ud)</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_movable_producer" kindref="compound">MovableProducer</ref>(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>,<sp/>spec,<sp/>ud),</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_data(*ud)<sp/>{</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>extra<sp/>abilities</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a1585d5b6235d2d90cf2de4736f1a7e54" kindref="member">type_abilities</ref>.emplace_back(std::make_shared&lt;GarrisonAbility&gt;(this-&gt;<ref refid="classopenage_1_1_movable_producer_1ad9617a17ae9d50175440828f98004289" kindref="member">on_move</ref>));</highlight></codeline>
<codeline lineno="445"><highlight class="normal">}</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447" refid="classopenage_1_1_living_producer_1a1de25db9a8f25ebb9df8df86092010a6" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_living_producer_1a1de25db9a8f25ebb9df8df86092010a6" kindref="member">LivingProducer::~LivingProducer</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449" refid="classopenage_1_1_living_producer_1ab1a0ef8e72b2db575f6c7b4fcdc09466" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_living_producer_1ab1a0ef8e72b2db575f6c7b4fcdc09466" kindref="member">LivingProducer::initialise</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*unit,<sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;player)<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="452"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>call<sp/>base<sp/>function</highlight></codeline>
<codeline lineno="453"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_movable_producer_1a3fc2ee02406d37a4106d51fee9d3c1c0" kindref="member">MovableProducer::initialise</ref>(unit,<sp/>player);</highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>population<sp/>of<sp/>1<sp/>for<sp/>all<sp/>movable<sp/>units</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_living_producer_1af26719e779e11d9187203e97bf503660" kindref="member">unit_data</ref>.unit_class<sp/>!=<sp/>gamedata::unit_classes::SHEEP)<sp/>{</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1population_01_4" kindref="compound">Attribute&lt;attr_type::population&gt;</ref>&gt;(1,<sp/>0));</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="460"><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>worker<sp/>attributes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_living_producer_1af26719e779e11d9187203e97bf503660" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::CIVILIAN)<sp/>{</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1worker_01_4" kindref="compound">Attribute&lt;attr_type::worker&gt;</ref>&gt;());</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;());</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1multitype_01_4" kindref="compound">Attribute&lt;attr_type::multitype&gt;</ref>&gt;());</highlight></codeline>
<codeline lineno="466"><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>graphic<sp/>ids<sp/>for<sp/>resource<sp/>actions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;worker_attr<sp/>=<sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">attr_type::worker</ref>&gt;();</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_attr.capacity<sp/>=<sp/>10.0;</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_attr.gather_rate[<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da22811dd94d65037ef86535740b98dec8" kindref="member">game_resource::wood</ref>]<sp/>=<sp/>0.002;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_attr.gather_rate[<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref>]<sp/>=<sp/>0.002;</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_attr.gather_rate[<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328dae07e81c20cf5935f5225765f0af81755" kindref="member">game_resource::gold</ref>]<sp/>=<sp/>0.002;</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_attr.gather_rate[<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da0a840ef45467fb3932dbf2c2896c5cbf" kindref="member">game_resource::stone</ref>]<sp/>=<sp/>0.002;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;multitype_attr<sp/>=<sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a360fa717125a1d694d8218ce0af98a51" kindref="member">attr_type::multitype</ref>&gt;();</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>currently<sp/>not<sp/>sure<sp/>where<sp/>the<sp/>game<sp/>data<sp/>keeps<sp/>these<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>todo<sp/>PREY_ANIMAL<sp/>SEA_FISH</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_object_producer_1af27e32c01dc789879de5207b39ebf405" kindref="member">parent_id</ref>()<sp/>==<sp/>83)<sp/>{</highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>male<sp/>graphics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::CIVILIAN]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a31d2ff66a69c6fb5d2f1cd699abd63a7" kindref="member">parent_type</ref>();<sp/></highlight><highlight class="comment">//<sp/>get<sp/>default<sp/>villager</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::BUILDING]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(156);<sp/></highlight><highlight class="comment">//<sp/>builder<sp/>118</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::BERRY_BUSH]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(120);<sp/></highlight><highlight class="comment">//<sp/>forager</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::SHEEP]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(592);<sp/></highlight><highlight class="comment">//<sp/>sheperd</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::TREES]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(123);<sp/></highlight><highlight class="comment">//<sp/>woodcutter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::GOLD_MINE]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(579);<sp/></highlight><highlight class="comment">//<sp/>gold<sp/>miner</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::STONE_MINE]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(124);<sp/></highlight><highlight class="comment">//<sp/>stone<sp/>miner</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>female<sp/>graphics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::CIVILIAN]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a31d2ff66a69c6fb5d2f1cd699abd63a7" kindref="member">parent_type</ref>();<sp/></highlight><highlight class="comment">//<sp/>get<sp/>default<sp/>villager</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::BUILDING]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(222);<sp/></highlight><highlight class="comment">//<sp/>builder<sp/>212</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::BERRY_BUSH]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(354);<sp/></highlight><highlight class="comment">//<sp/>forager</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::SHEEP]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(590);<sp/></highlight><highlight class="comment">//<sp/>sheperd</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::TREES]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(218);<sp/></highlight><highlight class="comment">//<sp/>woodcutter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::GOLD_MINE]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(581);<sp/></highlight><highlight class="comment">//<sp/>gold<sp/>miner</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multitype_attr.types[gamedata::unit_classes::STONE_MINE]<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(220);<sp/></highlight><highlight class="comment">//<sp/>stone<sp/>miner</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(std::make_shared&lt;GatherAbility&gt;(this-&gt;<ref refid="classopenage_1_1_movable_producer_1ab0b1193ba9f64b5a55a86c4dd51336a8" kindref="member">on_attack</ref>));</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(std::make_shared&lt;BuildAbility&gt;(this-&gt;<ref refid="classopenage_1_1_movable_producer_1ab0b1193ba9f64b5a55a86c4dd51336a8" kindref="member">on_attack</ref>));</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(std::make_shared&lt;RepairAbility&gt;(this-&gt;<ref refid="classopenage_1_1_movable_producer_1ab0b1193ba9f64b5a55a86c4dd51336a8" kindref="member">on_attack</ref>));</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_living_producer_1af26719e779e11d9187203e97bf503660" kindref="member">unit_data</ref>.unit_class<sp/>==<sp/>gamedata::unit_classes::FISHING_BOAT)<sp/>{</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1worker_01_4" kindref="compound">Attribute&lt;attr_type::worker&gt;</ref>&gt;());</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1resource_01_4" kindref="compound">Attribute&lt;attr_type::resource&gt;</ref>&gt;());</highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>fishing<sp/>abilites</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;worker_attr<sp/>=<sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">attr_type::worker</ref>&gt;();</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_attr.capacity<sp/>=<sp/>15.0;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_attr.gather_rate[<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref>]<sp/>=<sp/>0.002;</highlight></codeline>
<codeline lineno="513"><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(std::make_shared&lt;GatherAbility&gt;(this-&gt;<ref refid="classopenage_1_1_movable_producer_1ab0b1193ba9f64b5a55a86c4dd51336a8" kindref="member">on_attack</ref>));</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="516"><highlight class="normal">}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518" refid="classopenage_1_1_living_producer_1af454fa0fd996b30d44590a2e00a4380b" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*<ref refid="classopenage_1_1_living_producer_1af454fa0fd996b30d44590a2e00a4380b" kindref="member">LivingProducer::place</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*unit,<sp/>std::shared_ptr&lt;Terrain&gt;<sp/>terrain,<sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>init_pos)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_movable_producer_1ace952d53d7717d9db843391f49fbf76b" kindref="member">MovableProducer::place</ref>(unit,<sp/>terrain,<sp/>init_pos);</highlight></codeline>
<codeline lineno="520"><highlight class="normal">}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522" refid="classopenage_1_1_building_producer_1a6d0dd9c83e5908300c7c4cad09c43555" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_building_producer_1a6d0dd9c83e5908300c7c4cad09c43555" kindref="member">BuildingProducer::BuildingProducer</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;owner,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_spec" kindref="compound">GameSpec</ref><sp/>&amp;spec,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>gamedata::building_unit<sp/>*ud)</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_type" kindref="compound">UnitType</ref>(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>),</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_data{*ud},</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1_1texturefont__shader_1a80b2cb1e92b294620d32e9378f795083" kindref="member">texture</ref>{spec.get_unit_texture(ud-&gt;graphic_standing0)},</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>destroyed{spec.get_unit_texture(ud-&gt;dying_graphic)},</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">projectile</ref>{this-&gt;unit_data.missile_unit_id},</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/>foundation_terrain{ud-&gt;foundation_terrain_id},</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>enable_collisions{this-&gt;unit_data.id0<sp/>!=<sp/>109}<sp/>{<sp/></highlight><highlight class="comment">//<sp/>109<sp/>=<sp/>town<sp/>center</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>copy<sp/>the<sp/>class<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;unit_class<sp/>=<sp/>this-&gt;unit_data.unit_class;</highlight></codeline>
<codeline lineno="534"><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>suitable<sp/>sounds</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>creation_sound<sp/>=<sp/>this-&gt;unit_data.train_sound;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>dying_sound<sp/>=<sp/>this-&gt;unit_data.sound_dying;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(creation_sound<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>creation_sound<sp/>=<sp/>this-&gt;unit_data.damage_sound;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(creation_sound<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>creation_sound<sp/>=<sp/>this-&gt;unit_data.sound_selection;</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dying_sound<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dying_sound<sp/>=<sp/>323;<sp/></highlight><highlight class="comment">//generic<sp/>explosion<sp/>sound</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/>on_create<sp/>=<sp/>spec.get_sound(creation_sound);</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/>on_destroy<sp/>=<sp/>spec.get_sound(dying_sound);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>convert<sp/>the<sp/>float<sp/>to<sp/>the<sp/>discrete<sp/>foundation<sp/>size...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;foundation_size<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>static_cast&lt;int&gt;(this-&gt;unit_data.radius_x<sp/>*<sp/>2),</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>static_cast&lt;int&gt;(this-&gt;unit_data.radius_y<sp/>*<sp/>2),</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>graphic<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bae62068a633874d298459a25f8868d306" kindref="member">graphic_type::construct</ref>]<sp/>=<sp/>spec.get_unit_texture(ud-&gt;construction_graphic_id);</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>]<sp/>=<sp/>spec.get_unit_texture(ud-&gt;graphic_standing0);</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bafc7e987f23de5bd6562b7c0063cad659" kindref="member">graphic_type::attack</ref>]<sp/>=<sp/>spec.get_unit_texture(ud-&gt;graphic_standing0);</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>dying_tex<sp/>=<sp/>spec.get_unit_texture(ud-&gt;dying_graphic);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dying_tex)<sp/>{</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba564202d4005974a8279609ef0f95d43b" kindref="member">graphic_type::dying</ref>]<sp/>=<sp/>dying_tex;</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;terrain_outline<sp/>=<sp/><ref refid="namespaceopenage_1a8f7c4c46ae7b03cd0cc8ceae47ae7139" kindref="member">square_outline</ref>(this-&gt;foundation_size);</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>get<sp/>cost,<sp/>temp<sp/>fixed<sp/>cost<sp/>of<sp/>100<sp/>wood</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;cost.set(<ref refid="namespaceopenage_1abda3971a8397f9204b2ad873b645251ca617ac08757d38a5a7ed91c224f0e90a0" kindref="member">cost_type::constant</ref>,<sp/><ref refid="namespaceopenage_1a51da621433dabf064cd41efc49641d51" kindref="member">create_resource_cost</ref>(<ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da22811dd94d65037ef86535740b98dec8" kindref="member">game_resource::wood</ref>,<sp/>100));</highlight></codeline>
<codeline lineno="569"><highlight class="normal">}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="571" refid="classopenage_1_1_building_producer_1ae8bf91ccebb02c4fe4c861f9b5f53c69" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_building_producer_1ae8bf91ccebb02c4fe4c861f9b5f53c69" kindref="member">BuildingProducer::~BuildingProducer</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="572"><highlight class="normal"></highlight></codeline>
<codeline lineno="573" refid="classopenage_1_1_building_producer_1a98e04052b3c7522684bf1cd2e9c7e56f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_building_producer_1a98e04052b3c7522684bf1cd2e9c7e56f" kindref="member">BuildingProducer::id</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.id0;</highlight></codeline>
<codeline lineno="575"><highlight class="normal">}</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577" refid="classopenage_1_1_building_producer_1abedd0698d6855aad38be7f795956c813" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_building_producer_1abedd0698d6855aad38be7f795956c813" kindref="member">BuildingProducer::parent_id</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.id0;</highlight></codeline>
<codeline lineno="579"><highlight class="normal">}</highlight></codeline>
<codeline lineno="580"><highlight class="normal"></highlight></codeline>
<codeline lineno="581" refid="classopenage_1_1_building_producer_1a34118b90f3c4558ae8e783b3d8c84e33" refkind="member"><highlight class="normal">std::string<sp/><ref refid="classopenage_1_1_building_producer_1a34118b90f3c4558ae8e783b3d8c84e33" kindref="member">BuildingProducer::name</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.name;</highlight></codeline>
<codeline lineno="583"><highlight class="normal">}</highlight></codeline>
<codeline lineno="584"><highlight class="normal"></highlight></codeline>
<codeline lineno="585" refid="classopenage_1_1_building_producer_1a8ee32ab40420fb82cea96603d01fc553" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_building_producer_1a8ee32ab40420fb82cea96603d01fc553" kindref="member">BuildingProducer::initialise</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*unit,<sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;player)<sp/>{</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref><sp/>==<sp/>player,<sp/></highlight><highlight class="stringliteral">&quot;unit<sp/>init<sp/>from<sp/>a<sp/>UnitType<sp/>of<sp/>a<sp/>wrong<sp/>player<sp/>which<sp/>breaks<sp/>tech<sp/>levels&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>log<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(dbg)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;setting<sp/>unit<sp/>type<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.id0<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;unit_data.name);</highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>initialize<sp/>graphic<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a2d7da7c7ccd95557e10d54a58a033187" kindref="member">unit_type</ref><sp/>=<sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="595"><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player_attr<sp/>=<sp/>std::make_shared&lt;Attribute&lt;attr_type::owner&gt;&gt;(player);</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(player_attr);</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>building<sp/>specific<sp/>attribute</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>build_attr<sp/>=<sp/>std::make_shared&lt;Attribute&lt;attr_type::building&gt;&gt;(</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a697a54a387f09052cc7a2c9c291ec20f" kindref="member">foundation_terrain</ref>,</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(293),<sp/></highlight><highlight class="comment">//<sp/>fem_villager,<sp/>male<sp/>is<sp/>83</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/>build_attr-&gt;completion_state<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a80e45994ab1985daac98f86b12f9cba9" kindref="member">enable_collisions</ref><sp/>?<sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465ea6ebb25b39f65cab5efa469977b9479e2" kindref="member">object_state::placed</ref><sp/>:<sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465eac693ee9f8e776555e9625dd624ad5fa3" kindref="member">object_state::placed_no_collision</ref>;</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(build_attr);</highlight></codeline>
<codeline lineno="607"><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>garrison<sp/>and<sp/>hp<sp/>for<sp/>all<sp/>buildings</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1garrison_01_4" kindref="compound">Attribute&lt;attr_type::garrison&gt;</ref>&gt;());</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1hitpoints_01_4" kindref="compound">Attribute&lt;attr_type::hitpoints&gt;</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.hit_points));</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1damaged_01_4" kindref="compound">Attribute&lt;attr_type::damaged&gt;</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.hit_points));</highlight></codeline>
<codeline lineno="612"><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>population</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">()<sp/>==<sp/>109<sp/>||<sp/>this-&gt;</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">()<sp/>==<sp/>70)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>Town<sp/>center,<sp/>House</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1population_01_4" kindref="compound">Attribute&lt;attr_type::population&gt;</ref>&gt;(0,<sp/>5));</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">()<sp/>==<sp/>82)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>Castle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1population_01_4" kindref="compound">Attribute&lt;attr_type::population&gt;</ref>&gt;(0,<sp/>20));</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="620"><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>limits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">()<sp/>==<sp/>109<sp/>||<sp/>this-&gt;</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">()<sp/>==<sp/>276)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>Town<sp/>center,<sp/>Wonder</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a5ba08dd8da748f9a303a0f9f1266c112" kindref="member">have_limit</ref><sp/>=<sp/>2;<sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>change<sp/>to<sp/>1,<sp/>2<sp/>is<sp/>for<sp/>testing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>has_destruct_graphic<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1ac320243a0ec29d1f5252b6e49dbcd790" kindref="member">destroyed</ref><sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1aecd686fafc67487f4df4d3637f2621f4" kindref="member">push_action</ref>(std::make_unique&lt;FoundationAction&gt;(unit,<sp/>has_destruct_graphic),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_type" kindref="compound">UnitType</ref><sp/>*proj_type<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(this-&gt;<ref refid="classopenage_1_1_building_producer_1aff44c9bc453ea934240587c2a743dc04" kindref="member">projectile</ref>);</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.missile_unit_id<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>proj_type)<sp/>{</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>range_phys<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.weapon_range_max;</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1attack_01_4" kindref="compound">Attribute&lt;attr_type::attack&gt;</ref>&gt;(proj_type,<sp/>range_phys,<sp/>350000,<sp/>1));</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>formation<sp/>is<sp/>used<sp/>only<sp/>for<sp/>the<sp/>attack_stance</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1formation_01_4" kindref="compound">Attribute&lt;attr_type::formation&gt;</ref>&gt;(<ref refid="namespaceopenage_1a54fa9238a7f977d8d12d4b8422f3c6eda7daca46098eec28a63e877c18451ce30" kindref="member">attack_stance::aggressive</ref>));</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(std::make_shared&lt;AttackAbility&gt;());</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="637"><highlight class="normal"></highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>dropsite<sp/>attribute</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;game_resource&gt;<sp/>accepted_resources<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a3b9addd50944e9d3537b815b1a12a12d" kindref="member">get_accepted_resources</ref>();</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(accepted_resources.size()<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1dropsite_01_4" kindref="compound">Attribute&lt;attr_type::dropsite&gt;</ref>&gt;(accepted_resources));</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>building<sp/>can<sp/>train<sp/>new<sp/>units<sp/>and<sp/>ungarrison</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(std::make_shared&lt;SetPointAbility&gt;());</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(std::make_shared&lt;TrainAbility&gt;());</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a37f35cd78b09fea32514ed2b2dd87b64" kindref="member">give_ability</ref>(std::make_shared&lt;UngarrisonAbility&gt;());</highlight></codeline>
<codeline lineno="648"><highlight class="normal">}</highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="650" refid="classopenage_1_1_building_producer_1a3b9addd50944e9d3537b815b1a12a12d" refkind="member"><highlight class="normal">std::vector&lt;game_resource&gt;<sp/><ref refid="classopenage_1_1_building_producer_1a3b9addd50944e9d3537b815b1a12a12d" kindref="member">BuildingProducer::get_accepted_resources</ref>()<sp/>{</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//TODO<sp/>use<sp/>a<sp/>more<sp/>general<sp/>approach<sp/>instead<sp/>of<sp/>hard<sp/>coded<sp/>ids</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>id_in<sp/>=<sp/>[=](std::initializer_list&lt;int&gt;<sp/>ids)<sp/>{</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::any_of(ids.begin(),<sp/>ids.end(),<sp/>[=](</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>n<sp/>==<sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a98e04052b3c7522684bf1cd2e9c7e56f" kindref="member">id</ref>();<sp/>});</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="656"><highlight class="normal"></highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">()<sp/>==<sp/>109)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>Town<sp/>center</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::vector&lt;game_resource&gt;{</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da22811dd94d65037ef86535740b98dec8" kindref="member">game_resource::wood</ref>,</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref>,</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328dae07e81c20cf5935f5225765f0af81755" kindref="member">game_resource::gold</ref>,</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da0a840ef45467fb3932dbf2c2896c5cbf" kindref="member">game_resource::stone</ref></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_in({584,<sp/>585,<sp/>586,<sp/>587}))<sp/>{<sp/></highlight><highlight class="comment">//<sp/>Mine</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::vector&lt;game_resource&gt;{</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328dae07e81c20cf5935f5225765f0af81755" kindref="member">game_resource::gold</ref>,</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da0a840ef45467fb3932dbf2c2896c5cbf" kindref="member">game_resource::stone</ref></highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_in({68,<sp/>129,<sp/>130,<sp/>131}))<sp/>{<sp/></highlight><highlight class="comment">//<sp/>Mill</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::vector&lt;game_resource&gt;{</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da62506be34d574da4a0d158a67253ea99" kindref="member">game_resource::food</ref></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(id_in({562,<sp/>563,<sp/>564,<sp/>565}))<sp/>{<sp/></highlight><highlight class="comment">//<sp/>Lumberjack<sp/>camp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::vector&lt;game_resource&gt;{</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328da22811dd94d65037ef86535740b98dec8" kindref="member">game_resource::wood</ref></highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="678"><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>std::vector&lt;game_resource&gt;();</highlight></codeline>
<codeline lineno="680"><highlight class="normal">}</highlight></codeline>
<codeline lineno="681"><highlight class="normal"></highlight></codeline>
<codeline lineno="682" refid="classopenage_1_1_building_producer_1a4ed90b69cb9398ae0cc40625a1fa36d3" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*<ref refid="classopenage_1_1_building_producer_1a4ed90b69cb9398ae0cc40625a1fa36d3" kindref="member">BuildingProducer::place</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u,<sp/>std::shared_ptr&lt;Terrain&gt;<sp/>terrain,<sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>init_pos)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="683"><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>buildings<sp/>have<sp/>a<sp/>square<sp/>base</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a76a10b9ab26e62d7b712a6c796052ee3" kindref="member">make_location</ref>&lt;<ref refid="classopenage_1_1_square_object" kindref="compound">SquareObject</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_unit_type_1a6cb4b86a37f31b2994d197f43da03ab5" kindref="member">foundation_size</ref>,<sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a7121bba41c5812a7896847765ac31454" kindref="member">terrain_outline</ref>);</highlight></codeline>
<codeline lineno="686"><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="688"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>decide<sp/>what<sp/>terrain<sp/>is<sp/>passable<sp/>using<sp/>this<sp/>lambda</highlight></codeline>
<codeline lineno="689"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>currently<sp/>unit<sp/>avoids<sp/>water<sp/>and<sp/>tiles<sp/>with<sp/>another<sp/>unit</highlight></codeline>
<codeline lineno="690"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>this<sp/>function<sp/>should<sp/>be<sp/>true<sp/>if<sp/>pos<sp/>is<sp/>a<sp/>valid<sp/>position<sp/>of<sp/>the<sp/>object</highlight></codeline>
<codeline lineno="691"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*obj_ptr<sp/>=<sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get();</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>std::weak_ptr&lt;Terrain&gt;<sp/>terrain_ptr<sp/>=<sp/>terrain;</highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>set<sp/>of<sp/>allowed<sp/>terrains</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>std::unordered_set&lt;terrain_t&gt;<sp/>terrains<sp/>=<sp/><ref refid="namespaceopenage_1a012c2c0bdd9534a3d648ada6c608ebf2" kindref="member">allowed_terrains</ref>(this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.terrain_restriction);</highlight></codeline>
<codeline lineno="697"><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;passable<sp/>=<sp/>[obj_ptr,<sp/>terrain_ptr,<sp/>terrains](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;pos)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>terrain<sp/>=<sp/>terrain_ptr.lock();</highlight></codeline>
<codeline lineno="700"><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>look<sp/>at<sp/>all<sp/>tiles<sp/>in<sp/>the<sp/>bases<sp/>range</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>check_pos<sp/>:<sp/><ref refid="namespaceopenage_1a3a0d4d7c2bc234c442c13758d306f60c" kindref="member">tile_list</ref>(obj_ptr-&gt;get_range(pos,<sp/>*terrain)))<sp/>{</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*tc<sp/>=<sp/>terrain-&gt;get_data(check_pos);</highlight></codeline>
<codeline lineno="704"><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>terrains<sp/>are<sp/>suitable<sp/>and<sp/>free<sp/>of<sp/>content</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tc<sp/>||<sp/>!terrains.count(tc-&gt;<ref refid="classopenage_1_1_tile_content_1ac370821023f0c2e78ef4ab0c27c7bf09" kindref="member">terrain_id</ref>)<sp/>||<sp/>tc-&gt;<ref refid="classopenage_1_1_tile_content_1aaeff054a61d61cc0c65cfefcc78de233" kindref="member">obj</ref>.size())<sp/>{</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="713"><highlight class="normal"></highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>drawing<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>draw_outline<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a80e45994ab1985daac98f86b12f9cba9" kindref="member">enable_collisions</ref>;</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;draw<sp/>=<sp/>[u,<sp/>obj_ptr,<sp/>draw_outline](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>&amp;e)<sp/>{</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(u-&gt;<ref refid="classopenage_1_1_unit_1a00fd6387097ed12ae6f6b6ec2ab2939e" kindref="member">selected</ref><sp/>&amp;&amp;<sp/>draw_outline)<sp/>{</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj_ptr-&gt;draw_outline(e.coord);</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1ae422123ecc6a2e930ba86e45bf8a5a37" kindref="member">draw</ref>(e);</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="722"><highlight class="normal"></highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>try<sp/>to<sp/>place<sp/>the<sp/>obj,<sp/>it<sp/>knows<sp/>best<sp/>whether<sp/>it<sp/>will<sp/>fit.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>state<sp/>=<sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465ea374515b23d6f106696387776a6077d17" kindref="member">object_state::floating</ref>;</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;place(terrain,<sp/>init_pos,<sp/>state))<sp/>{</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="728"><highlight class="normal"></highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>annex<sp/>objects</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>4;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>gamedata::building_annex<sp/>&amp;annex<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a8874c490435c8094c093a9f2132c5e6e" kindref="member">unit_data</ref>.building_annex.data[i];</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(annex.unit_id<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="733"><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>objects<sp/>for<sp/>annex</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>a_pos<sp/>=<sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a_pos.ne<sp/>+=<sp/>annex.misplaced0;</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a_pos.se<sp/>+=<sp/>annex.misplaced1;</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a4aeeaaaef4924780b6ee886ea8ffe98e" kindref="member">make_annex</ref>(*u,<sp/>terrain,<sp/>annex.unit_id,<sp/>a_pos,<sp/>i<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="741"><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>play<sp/>sound<sp/>once<sp/>built</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_building_producer_1a974f970953484730236c7f2579fd1c50" kindref="member">on_create</ref>)<sp/>{</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classopenage_1_1_building_producer_1a974f970953484730236c7f2579fd1c50" kindref="member">on_create</ref>-&gt;<ref refid="classopenage_1_1_sound_1a526acd600cd69f6f421a253fc169398b" kindref="member">play</ref>();</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get();</highlight></codeline>
<codeline lineno="747"><highlight class="normal">}</highlight></codeline>
<codeline lineno="748"><highlight class="normal"></highlight></codeline>
<codeline lineno="749" refid="classopenage_1_1_building_producer_1a4aeeaaaef4924780b6ee886ea8ffe98e" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*<ref refid="classopenage_1_1_building_producer_1a4aeeaaaef4924780b6ee886ea8ffe98e" kindref="member">BuildingProducer::make_annex</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>&amp;u,<sp/>std::shared_ptr&lt;Terrain&gt;<sp/>t,</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>annex_id,<sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>annex_pos,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>c)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="751"><highlight class="normal"></highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>use<sp/>in<sp/>lambda<sp/>drawing<sp/>functions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>annex_type<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref>.<ref refid="classopenage_1_1_player_1a67c7f6853d4be5c38d2456169af3d5a1" kindref="member">get_type</ref>(annex_id);</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!annex_type)<sp/>{</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.<ref refid="classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(warn)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>annex<sp/>type<sp/>id<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>annex_id);</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="758"><highlight class="normal"></highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>foundation<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structopenage_1_1coord_1_1tile__delta" kindref="compound">coord::tile_delta</ref><sp/>annex_foundation<sp/>=<sp/>annex_type-&gt;foundation_size;</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>producers<sp/>place<sp/>by<sp/>the<sp/>nw<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>start_tile<sp/>=<sp/>annex_pos;</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/>start_tile.ne<sp/>-=<sp/>annex_foundation.ne<sp/>/<sp/>2.0;</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/>start_tile.se<sp/>-=<sp/>annex_foundation.se<sp/>/<sp/>2.0;</highlight></codeline>
<codeline lineno="766"><highlight class="normal"></highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>and<sp/>place<sp/>on<sp/>terrain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*annex_loc<sp/>=<sp/>u.<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;make_annex&lt;<ref refid="classopenage_1_1_square_object" kindref="compound">SquareObject</ref>&gt;(annex_foundation);</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465e" kindref="member">object_state</ref><sp/>state<sp/>=<sp/>c?<sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465ea6ebb25b39f65cab5efa469977b9479e2" kindref="member">object_state::placed</ref><sp/>:<sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465eac693ee9f8e776555e9625dd624ad5fa3" kindref="member">object_state::placed_no_collision</ref>;</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/>annex_loc-&gt;<ref refid="classopenage_1_1_terrain_object_1a227f50f827d1ae7791f06e323c581bbd" kindref="member">place</ref>(t,<sp/>start_tile,<sp/>state);</highlight></codeline>
<codeline lineno="771"><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>special<sp/>drawing<sp/>functions<sp/>for<sp/>annexes,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/>annex_loc-&gt;<ref refid="classopenage_1_1_terrain_object_1a8eb5bfc64508b790cc77cf2907c51dd6" kindref="member">draw</ref><sp/>=<sp/>[annex_loc,<sp/>annex_type,<sp/>&amp;u,<sp/>c](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>&amp;e)<sp/>{</highlight></codeline>
<codeline lineno="774"><highlight class="normal"></highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>hack<sp/>which<sp/>draws<sp/>the<sp/>outline<sp/>in<sp/>the<sp/>right<sp/>order</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>removable<sp/>once<sp/>rendering<sp/>system<sp/>is<sp/>improved</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;&amp;<sp/>u.selected)<sp/>{</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>annex_loc-&gt;<ref refid="classopenage_1_1_terrain_object_1a1e5c4905f3a581bb96600eef9ca09a0a" kindref="member">get_parent</ref>()-&gt;<ref refid="classopenage_1_1_terrain_object_1a95d5633a7448be10a5e6274351aac959" kindref="member">draw_outline</ref>(e.coord);</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="780"><highlight class="normal"></highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>only<sp/>draw<sp/>if<sp/>building<sp/>is<sp/>completed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(u.has_attribute(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.get_attribute&lt;<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>&gt;().completed<sp/>&gt;=<sp/>1.0f)<sp/>{</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.draw(annex_loc,<sp/>annex_type-&gt;graphics,<sp/>e);</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>annex_loc;</highlight></codeline>
<codeline lineno="788"><highlight class="normal">}</highlight></codeline>
<codeline lineno="789"><highlight class="normal"></highlight></codeline>
<codeline lineno="790" refid="classopenage_1_1_projectile_producer_1aa69d303f46ef957dce93978697c53c59" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_projectile_producer_1aa69d303f46ef957dce93978697c53c59" kindref="member">ProjectileProducer::ProjectileProducer</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;owner,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_game_spec" kindref="compound">GameSpec</ref><sp/>&amp;spec,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>gamedata::missile_unit<sp/>*pd)</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit_type" kindref="compound">UnitType</ref>(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>),</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_data{*pd},</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>tex{spec.get_unit_texture(this-&gt;unit_data.graphic_standing0)},</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/>sh{spec.get_unit_texture(3379)},<sp/></highlight><highlight class="comment">//<sp/>3379<sp/>=<sp/>general<sp/>arrow<sp/>shadow</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/>destroyed{spec.get_unit_texture(this-&gt;unit_data.dying_graphic)}<sp/>{</highlight></codeline>
<codeline lineno="797"><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>copy<sp/>the<sp/>class<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;unit_class<sp/>=<sp/>this-&gt;unit_data.<ref refid="classopenage_1_1_unit_type_1a8f429cad1b7e5c9daedf836bdc8cd1a7" kindref="member">unit_class</ref>;</highlight></codeline>
<codeline lineno="800"><highlight class="normal"></highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>graphic<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>]<sp/>=<sp/>this-&gt;tex;</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba3bf1114a986ba87ed28fc1b5884fc2f8" kindref="member">graphic_type::shadow</ref>]<sp/>=<sp/>this-&gt;sh;</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(destroyed)<sp/>{</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;graphics[<ref refid="namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba564202d4005974a8279609ef0f95d43b" kindref="member">graphic_type::dying</ref>]<sp/>=<sp/>destroyed;</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>outline</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/>terrain_outline<sp/>=<sp/><ref refid="namespaceopenage_1ae2e68c0049a3b6c5671c8006c6a74f84" kindref="member">radial_outline</ref>(pd-&gt;radius_y);</highlight></codeline>
<codeline lineno="810"><highlight class="normal">}</highlight></codeline>
<codeline lineno="811"><highlight class="normal"></highlight></codeline>
<codeline lineno="812" refid="classopenage_1_1_projectile_producer_1aa77ac6a3e99375d669bc6ce8b3a13a57" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_projectile_producer_1aa77ac6a3e99375d669bc6ce8b3a13a57" kindref="member">ProjectileProducer::~ProjectileProducer</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="814" refid="classopenage_1_1_projectile_producer_1a680a3cc3e75719a92ca5e529f840cef5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_projectile_producer_1a680a3cc3e75719a92ca5e529f840cef5" kindref="member">ProjectileProducer::id</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_projectile_producer_1a5a3ae2ec44c6520240d958a78319de35" kindref="member">unit_data</ref>.id0;</highlight></codeline>
<codeline lineno="816"><highlight class="normal">}</highlight></codeline>
<codeline lineno="817"><highlight class="normal"></highlight></codeline>
<codeline lineno="818" refid="classopenage_1_1_projectile_producer_1ac8b3e0a4998857470cae7fb38c618bd0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_projectile_producer_1ac8b3e0a4998857470cae7fb38c618bd0" kindref="member">ProjectileProducer::parent_id</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_projectile_producer_1a5a3ae2ec44c6520240d958a78319de35" kindref="member">unit_data</ref>.id0;</highlight></codeline>
<codeline lineno="820"><highlight class="normal">}</highlight></codeline>
<codeline lineno="821"><highlight class="normal"></highlight></codeline>
<codeline lineno="822" refid="classopenage_1_1_projectile_producer_1afd4025733132150438a1c2e116e61427" refkind="member"><highlight class="normal">std::string<sp/><ref refid="classopenage_1_1_projectile_producer_1afd4025733132150438a1c2e116e61427" kindref="member">ProjectileProducer::name</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="classopenage_1_1_projectile_producer_1a5a3ae2ec44c6520240d958a78319de35" kindref="member">unit_data</ref>.name;</highlight></codeline>
<codeline lineno="824"><highlight class="normal">}</highlight></codeline>
<codeline lineno="825"><highlight class="normal"></highlight></codeline>
<codeline lineno="826" refid="classopenage_1_1_projectile_producer_1aa865d0028f76dfeb134b32c24dc63619" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_projectile_producer_1aa865d0028f76dfeb134b32c24dc63619" kindref="member">ProjectileProducer::initialise</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*unit,<sp/><ref refid="classopenage_1_1_player" kindref="compound">Player</ref><sp/>&amp;player)<sp/>{</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="error_2error_8h_1ae20e8a0a86b80f8211fdf87477524f87" kindref="member">ENSURE</ref>(this-&gt;<ref refid="classopenage_1_1_unit_type_1a8aefb19903db17d9f07cea64ecba76bf" kindref="member">owner</ref><sp/>==<sp/>player,<sp/></highlight><highlight class="stringliteral">&quot;unit<sp/>init<sp/>from<sp/>a<sp/>UnitType<sp/>of<sp/>a<sp/>wrong<sp/>player<sp/>which<sp/>breaks<sp/>tech<sp/>levels&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="828"><highlight class="normal"></highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>initialize<sp/>graphic<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1a2d7da7c7ccd95557e10d54a58a033187" kindref="member">unit_type</ref><sp/>=<sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="831"><highlight class="normal"></highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>player_attr<sp/>=<sp/>std::make_shared&lt;Attribute&lt;attr_type::owner&gt;&gt;(player);</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(player_attr);</highlight></codeline>
<codeline lineno="834"><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>projectile<sp/>speed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>sp<sp/>=<sp/>this-&gt;<ref refid="classopenage_1_1_projectile_producer_1a5a3ae2ec44c6520240d958a78319de35" kindref="member">unit_data</ref>.speed<sp/>/<sp/>666;</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1speed_01_4" kindref="compound">Attribute&lt;attr_type::speed&gt;</ref>&gt;(sp));</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1projectile_01_4" kindref="compound">Attribute&lt;attr_type::projectile&gt;</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_projectile_producer_1a5a3ae2ec44c6520240d958a78319de35" kindref="member">unit_data</ref>.projectile_arc));</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1ab74b08bb7725863fc63839d798f6aedb" kindref="member">add_attribute</ref>(std::make_shared&lt;<ref refid="classopenage_1_1_attribute_3_01attr__type_1_1direction_01_4" kindref="compound">Attribute&lt;attr_type::direction&gt;</ref>&gt;(<ref refid="structopenage_1_1coord_1_1phys3__delta" kindref="compound">coord::phys3_delta</ref>{<sp/>1,<sp/>0,<sp/>0<sp/>}));</highlight></codeline>
<codeline lineno="840"><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>destruction<sp/>graphic<sp/>is<sp/>available</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="classopenage_1_1_projectile_producer_1af56c6c8ab3605c8d63a3052b32f74319" kindref="member">destroyed</ref>)<sp/>{</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit-&gt;<ref refid="classopenage_1_1_unit_1aecd686fafc67487f4df4d3637f2621f4" kindref="member">push_action</ref>(std::make_unique&lt;DeadAction&gt;(unit),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="845"><highlight class="normal">}</highlight></codeline>
<codeline lineno="846"><highlight class="normal"></highlight></codeline>
<codeline lineno="847" refid="classopenage_1_1_projectile_producer_1a02c2dedff8bebf9d036393d8e35b37b3" refkind="member"><highlight class="normal"><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*<ref refid="classopenage_1_1_projectile_producer_1a02c2dedff8bebf9d036393d8e35b37b3" kindref="member">ProjectileProducer::place</ref>(<ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u,<sp/>std::shared_ptr&lt;Terrain&gt;<sp/>terrain,<sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>init_pos)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="849"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>radial<sp/>base<sp/>shape<sp/>without<sp/>collision<sp/>checking</highlight></codeline>
<codeline lineno="850"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a76a10b9ab26e62d7b712a6c796052ee3" kindref="member">make_location</ref>&lt;<ref refid="classopenage_1_1_radial_object" kindref="compound">RadialObject</ref>&gt;(this-&gt;<ref refid="classopenage_1_1_projectile_producer_1a5a3ae2ec44c6520240d958a78319de35" kindref="member">unit_data</ref>.radius_y,<sp/>this-&gt;<ref refid="classopenage_1_1_projectile_producer_1a6adb3a694e881056589835540dff1a0c" kindref="member">terrain_outline</ref>);</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*obj_ptr<sp/>=<sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get();</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/>std::weak_ptr&lt;Terrain&gt;<sp/>terrain_ptr<sp/>=<sp/>terrain;</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;passable<sp/>=<sp/>[obj_ptr,<sp/>u,<sp/>terrain_ptr](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;pos)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pos.up<sp/>&gt;<sp/>64000)<sp/>{</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="859"><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>avoid<sp/>intersections<sp/>with<sp/>launcher</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*launcher<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>terrain<sp/>=<sp/>terrain_ptr.lock();</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(u-&gt;has_attribute(<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">attr_type::projectile</ref>))<sp/>{</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;pr_attr<sp/>=<sp/>u-&gt;<ref refid="classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">attr_type::projectile</ref>&gt;();</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pr_attr.launched<sp/>&amp;&amp;<sp/>pr_attr.launcher.is_valid())<sp/>{</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>launcher<sp/>=<sp/>pr_attr.launcher.get();</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="875"><highlight class="normal"></highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>look<sp/>at<sp/>all<sp/>tiles<sp/>in<sp/>the<sp/>bases<sp/>range</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>check_pos<sp/>:<sp/><ref refid="namespaceopenage_1a3a0d4d7c2bc234c442c13758d306f60c" kindref="member">tile_list</ref>(obj_ptr-&gt;get_range(pos,<sp/>*terrain)))<sp/>{</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*tc<sp/>=<sp/>terrain-&gt;get_data(check_pos);</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tc)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="880"><highlight class="normal"></highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ensure<sp/>no<sp/>intersections<sp/>with<sp/>other<sp/>objects</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>obj_cmp<sp/>:<sp/>tc-&gt;<ref refid="classopenage_1_1_tile_content_1aaeff054a61d61cc0c65cfefcc78de233" kindref="member">obj</ref>)<sp/>{</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(obj_ptr<sp/>!=<sp/>obj_cmp<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;obj_cmp-&gt;unit<sp/>!=<sp/>launcher<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj_cmp-&gt;check_collisions()<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj_ptr-&gt;intersects(*obj_cmp,<sp/>pos))<sp/>{</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="893"><highlight class="normal"></highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>u-&gt;location-&gt;draw<sp/>=<sp/>[u](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>&amp;e)<sp/>{</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u-&gt;draw(e);</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="897"><highlight class="normal"></highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>try<sp/>to<sp/>place<sp/>the<sp/>obj,<sp/>it<sp/>knows<sp/>best<sp/>whether<sp/>it<sp/>will<sp/>fit.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(u-&gt;location-&gt;place(terrain,<sp/>init_pos,<sp/><ref refid="namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465eac693ee9f8e776555e9625dd624ad5fa3" kindref="member">object_state::placed_no_collision</ref>))<sp/>{</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>u-&gt;location.get();</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="903"><highlight class="normal">}</highlight></codeline>
<codeline lineno="904"><highlight class="normal"></highlight></codeline>
<codeline lineno="905"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace<sp/>openage</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="libopenage/unit/producer.cpp"/>
  </compounddef>
</doxygen>
