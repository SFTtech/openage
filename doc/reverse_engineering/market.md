# Market

[Source](https://www.youtube.com/watch?v=NvsM9B4ac2g)

Gold from trading calculation, tribute system, buying/selling resources and the destruction of markets.

## Distance Gold Calculation

The gold you receive from trading with a market depends on the *distance in tiles* (or *distance in tile width*) between the two markets. The further the markets are apart from each other, the more gold is generated by a trade cart.

Generated amount of gold is not linear to the distance in tiles. Instead the algorithm probably uses a 2nd degree function (see below in Section **Math**) to calculate the trade value. Since the market uses 4x4 tiles, the measuring point seems to be in the center of the 4x4 tiling.

Note that the gold value shown when you select the market is rounded but the gold you receive is not. This means that in the case of two markets being placed next to each other, trade carts will still generate a tiny fraction of gold.

### Math

    (gold value) = 0.001 * (distance in tiles)^2 + 0.1353 * (distance in tiles)

or

    (gold value) = 0.001 * (distance in tiles)^2 + e^(-2) * (distance in tiles)

### Diagonal Calculation

AoE2 also takes into account that crossing a tile diagonally takes up to 41 % (for fully diagonal movement) longer. Hence it probably uses trigonometry to calculate the real *distance in tile width* between the two markets.

## Tribute

Tribute can be sent to other players using the tribute menu in the upper right corner. The number of resources you are sending to a player is shown on top of the buttons of the receiving player. On top of that the tributing player has to pay a fee. The amount of resources left *after sending tribute* can be seen in the line with the players name in it:

    (amount of resource) = (current stockpile) - ((tribute amount) + (tribute fee) * (tribute amount))

## Prices

All prices for buying/selling resources are global. Thus every player in a game sees the same price and is affected by price changes. If the market is selected, prices are shown in two rows, with the upper one being the selling price and the lower one being the price for buying. The number that is shown, represents the amount of gold that the player has to spent to buy 100 units of the resource.

Both buying and selling price are calculated from the same *base price*. Buying a resource always costs 30 % *more* gold than the base price. Selling it costs 30 % *less*. The base price at the beginning of a game ist always 100 for wood and food, while being 130 for stone.

    sell price = 70
    base price = 100
    buy  price = 130

Every time any player sells 100 resources of any kind, the base price of this resource decrements by 3. Buying a resource increments the base price by 3.

    sell price = 70  ---> sell price = 68
    base price = 100 ---> base price = 97
    buy  price = 130 ---> buy  price = 127

The lowest the base price can go is 20, while the highest base price is 9999.

    sell price = 70  ---> sell price = 68  ---> ... ---> sell price = 14
    base price = 100 ---> base price = 97  ---> ... ---> base price = 20
    buy  price = 130 ---> buy  price = 127 ---> ... ---> buy  price = 26

## Destroying a market

There are two possible scenarios.

### The trading partners' market is destroyed

Trade Carts will not seek an alternative market to trade with. As soon as the market is destroyed, all of you trade carts that are trading with it return to your own market and stay there. Trade carts that are already on their way back from your ally will still deliver the gold that they are carrying and then stop at your market.

### Your market is destroyed

If you only had one market, trade carts will stop and immediatly lose all carried gold.

If you happen to have more than one market, trade carts will choose the market which is closest *from their current position* as their new trade destination.

## Weird AoE2 Quirks

* You can trade with enemy markets.
* Full trade carts cannot be loaded onto a transport ship. As soon as you give the order to board the ship, they change into an empty cart, dropping all of their gold.
